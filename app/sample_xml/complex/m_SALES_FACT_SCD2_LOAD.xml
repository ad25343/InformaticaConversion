<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE POWERMART SYSTEM "powrmart.dtd">
<POWERMART CREATION_DATE="02/21/2026 10:00:00" REPOSITORY_VERSION="186.96">
  <REPOSITORY NAME="DEV_REPO" VERSION="186" CODEPAGE="UTF-8" DATABASETYPE="Oracle">
    <FOLDER NAME="FINANCE_ETL" GROUP="" OWNER="admin" SHARED="NOTSHARED"
            DESCRIPTION="Finance ETL — complex SCD Type 2 and multi-source fact load">

      <!-- ═══════════════════════════════════════════════════════
           SOURCES (4)
      ════════════════════════════════════════════════════════ -->
      <SOURCE DATABASETYPE="Oracle" DBDNAME="FINANCE_DB" NAME="STG_TRANSACTIONS" OWNERNAME="STAGING">
        <SOURCEFIELD DATATYPE="NUMBER"   LENGTH="15"  NAME="TXN_ID"           NULLABLE="NOTNULL" FIELDNUMBER="1"  PRECISION="15" SCALE="0"/>
        <SOURCEFIELD DATATYPE="NUMBER"   LENGTH="10"  NAME="ACCOUNT_ID"       NULLABLE="NOTNULL" FIELDNUMBER="2"  PRECISION="10" SCALE="0"/>
        <SOURCEFIELD DATATYPE="NUMBER"   LENGTH="10"  NAME="PRODUCT_ID"       NULLABLE="NULL"    FIELDNUMBER="3"  PRECISION="10" SCALE="0"/>
        <SOURCEFIELD DATATYPE="NUMBER"   LENGTH="10"  NAME="ADVISOR_ID"       NULLABLE="NULL"    FIELDNUMBER="4"  PRECISION="10" SCALE="0"/>
        <SOURCEFIELD DATATYPE="DATE"     LENGTH="29"  NAME="TXN_DATE"         NULLABLE="NULL"    FIELDNUMBER="5"  PRECISION="29" SCALE="9"/>
        <SOURCEFIELD DATATYPE="VARCHAR2" LENGTH="20"  NAME="TXN_TYPE"         NULLABLE="NULL"    FIELDNUMBER="6"  PRECISION="20" SCALE="0"/>
        <SOURCEFIELD DATATYPE="NUMBER"   LENGTH="18"  NAME="TXN_AMOUNT"       NULLABLE="NULL"    FIELDNUMBER="7"  PRECISION="18" SCALE="4"/>
        <SOURCEFIELD DATATYPE="VARCHAR2" LENGTH="3"   NAME="CURRENCY"         NULLABLE="NULL"    FIELDNUMBER="8"  PRECISION="3"  SCALE="0"/>
        <SOURCEFIELD DATATYPE="NUMBER"   LENGTH="10"  NAME="UNITS"            NULLABLE="NULL"    FIELDNUMBER="9"  PRECISION="10" SCALE="4"/>
        <SOURCEFIELD DATATYPE="NUMBER"   LENGTH="18"  NAME="UNIT_PRICE"       NULLABLE="NULL"    FIELDNUMBER="10" PRECISION="18" SCALE="4"/>
        <SOURCEFIELD DATATYPE="VARCHAR2" LENGTH="20"  NAME="TXN_STATUS"       NULLABLE="NULL"    FIELDNUMBER="11" PRECISION="20" SCALE="0"/>
        <SOURCEFIELD DATATYPE="VARCHAR2" LENGTH="10"  NAME="PLATFORM"         NULLABLE="NULL"    FIELDNUMBER="12" PRECISION="10" SCALE="0"/>
      </SOURCE>

      <SOURCE DATABASETYPE="Oracle" DBDNAME="FINANCE_DB" NAME="STG_ACCOUNTS" OWNERNAME="STAGING">
        <SOURCEFIELD DATATYPE="NUMBER"   LENGTH="10"  NAME="ACCOUNT_ID"       NULLABLE="NOTNULL" FIELDNUMBER="1"  PRECISION="10" SCALE="0"/>
        <SOURCEFIELD DATATYPE="VARCHAR2" LENGTH="100" NAME="ACCOUNT_NAME"     NULLABLE="NULL"    FIELDNUMBER="2"  PRECISION="100" SCALE="0"/>
        <SOURCEFIELD DATATYPE="VARCHAR2" LENGTH="20"  NAME="ACCOUNT_TYPE"     NULLABLE="NULL"    FIELDNUMBER="3"  PRECISION="20" SCALE="0"/>
        <SOURCEFIELD DATATYPE="VARCHAR2" LENGTH="5"   NAME="COUNTRY_CODE"     NULLABLE="NULL"    FIELDNUMBER="4"  PRECISION="5"  SCALE="0"/>
        <SOURCEFIELD DATATYPE="VARCHAR2" LENGTH="20"  NAME="RISK_RATING"      NULLABLE="NULL"    FIELDNUMBER="5"  PRECISION="20" SCALE="0"/>
        <SOURCEFIELD DATATYPE="DATE"     LENGTH="29"  NAME="ACCOUNT_OPEN_DT"  NULLABLE="NULL"    FIELDNUMBER="6"  PRECISION="29" SCALE="9"/>
        <SOURCEFIELD DATATYPE="VARCHAR2" LENGTH="1"   NAME="IS_INSTITUTIONAL" NULLABLE="NULL"    FIELDNUMBER="7"  PRECISION="1"  SCALE="0"/>
      </SOURCE>

      <SOURCE DATABASETYPE="Oracle" DBDNAME="FINANCE_DB" NAME="STG_FX_RATES" OWNERNAME="STAGING">
        <SOURCEFIELD DATATYPE="VARCHAR2" LENGTH="3"   NAME="FROM_CURRENCY"    NULLABLE="NOTNULL" FIELDNUMBER="1"  PRECISION="3"  SCALE="0"/>
        <SOURCEFIELD DATATYPE="VARCHAR2" LENGTH="3"   NAME="TO_CURRENCY"      NULLABLE="NOTNULL" FIELDNUMBER="2"  PRECISION="3"  SCALE="0"/>
        <SOURCEFIELD DATATYPE="DATE"     LENGTH="29"  NAME="RATE_DATE"        NULLABLE="NOTNULL" FIELDNUMBER="3"  PRECISION="29" SCALE="9"/>
        <SOURCEFIELD DATATYPE="NUMBER"   LENGTH="18"  NAME="EXCHANGE_RATE"    NULLABLE="NULL"    FIELDNUMBER="4"  PRECISION="18" SCALE="8"/>
      </SOURCE>

      <SOURCE DATABASETYPE="Oracle" DBDNAME="FINANCE_DB" NAME="STG_PRODUCTS" OWNERNAME="STAGING">
        <SOURCEFIELD DATATYPE="NUMBER"   LENGTH="10"  NAME="PRODUCT_ID"       NULLABLE="NOTNULL" FIELDNUMBER="1"  PRECISION="10" SCALE="0"/>
        <SOURCEFIELD DATATYPE="VARCHAR2" LENGTH="100" NAME="PRODUCT_NAME"     NULLABLE="NULL"    FIELDNUMBER="2"  PRECISION="100" SCALE="0"/>
        <SOURCEFIELD DATATYPE="VARCHAR2" LENGTH="50"  NAME="ASSET_CLASS"      NULLABLE="NULL"    FIELDNUMBER="3"  PRECISION="50" SCALE="0"/>
        <SOURCEFIELD DATATYPE="VARCHAR2" LENGTH="20"  NAME="RISK_CATEGORY"    NULLABLE="NULL"    FIELDNUMBER="4"  PRECISION="20" SCALE="0"/>
        <SOURCEFIELD DATATYPE="NUMBER"   LENGTH="8"   NAME="MANAGEMENT_FEE"   NULLABLE="NULL"    FIELDNUMBER="5"  PRECISION="8"  SCALE="4"/>
      </SOURCE>

      <!-- ═══════════════════════════════════════════════════════
           TARGETS (2)
      ════════════════════════════════════════════════════════ -->
      <TARGET DATABASETYPE="Oracle" NAME="FACT_TRANSACTIONS" OWNERNAME="DWH">
        <TARGETFIELD DATATYPE="NUMBER"   LENGTH="15"  NAME="TXN_KEY"          KEYTYPE="PRIMARY KEY" FIELDNUMBER="1"  PRECISION="15" SCALE="0" NULLABLE="NOTNULL"/>
        <TARGETFIELD DATATYPE="NUMBER"   LENGTH="10"  NAME="ACCOUNT_KEY"      KEYTYPE="NOT A KEY"   FIELDNUMBER="2"  PRECISION="10" SCALE="0" NULLABLE="NULL"/>
        <TARGETFIELD DATATYPE="NUMBER"   LENGTH="10"  NAME="PRODUCT_KEY"      KEYTYPE="NOT A KEY"   FIELDNUMBER="3"  PRECISION="10" SCALE="0" NULLABLE="NULL"/>
        <TARGETFIELD DATATYPE="DATE"     LENGTH="29"  NAME="TXN_DATE"         KEYTYPE="NOT A KEY"   FIELDNUMBER="4"  PRECISION="29" SCALE="9" NULLABLE="NULL"/>
        <TARGETFIELD DATATYPE="VARCHAR2" LENGTH="7"   NAME="TXN_YEAR_MONTH"   KEYTYPE="NOT A KEY"   FIELDNUMBER="5"  PRECISION="7"  SCALE="0" NULLABLE="NULL"/>
        <TARGETFIELD DATATYPE="VARCHAR2" LENGTH="20"  NAME="TXN_TYPE"         KEYTYPE="NOT A KEY"   FIELDNUMBER="6"  PRECISION="20" SCALE="0" NULLABLE="NULL"/>
        <TARGETFIELD DATATYPE="VARCHAR2" LENGTH="30"  NAME="TXN_TYPE_DESC"    KEYTYPE="NOT A KEY"   FIELDNUMBER="7"  PRECISION="30" SCALE="0" NULLABLE="NULL"/>
        <TARGETFIELD DATATYPE="NUMBER"   LENGTH="18"  NAME="TXN_AMOUNT_LOCAL" KEYTYPE="NOT A KEY"   FIELDNUMBER="8"  PRECISION="18" SCALE="4" NULLABLE="NULL"/>
        <TARGETFIELD DATATYPE="NUMBER"   LENGTH="18"  NAME="TXN_AMOUNT_USD"   KEYTYPE="NOT A KEY"   FIELDNUMBER="9"  PRECISION="18" SCALE="4" NULLABLE="NULL"/>
        <TARGETFIELD DATATYPE="NUMBER"   LENGTH="18"  NAME="MANAGEMENT_FEE_AMT" KEYTYPE="NOT A KEY" FIELDNUMBER="10" PRECISION="18" SCALE="4" NULLABLE="NULL"/>
        <TARGETFIELD DATATYPE="NUMBER"   LENGTH="10"  NAME="UNITS"            KEYTYPE="NOT A KEY"   FIELDNUMBER="11" PRECISION="10" SCALE="4" NULLABLE="NULL"/>
        <TARGETFIELD DATATYPE="VARCHAR2" LENGTH="3"   NAME="CURRENCY"         KEYTYPE="NOT A KEY"   FIELDNUMBER="12" PRECISION="3"  SCALE="0" NULLABLE="NULL"/>
        <TARGETFIELD DATATYPE="VARCHAR2" LENGTH="20"  NAME="ACCOUNT_TYPE"     KEYTYPE="NOT A KEY"   FIELDNUMBER="13" PRECISION="20" SCALE="0" NULLABLE="NULL"/>
        <TARGETFIELD DATATYPE="VARCHAR2" LENGTH="20"  NAME="RISK_RATING"      KEYTYPE="NOT A KEY"   FIELDNUMBER="14" PRECISION="20" SCALE="0" NULLABLE="NULL"/>
        <TARGETFIELD DATATYPE="VARCHAR2" LENGTH="50"  NAME="ASSET_CLASS"      KEYTYPE="NOT A KEY"   FIELDNUMBER="15" PRECISION="50" SCALE="0" NULLABLE="NULL"/>
        <TARGETFIELD DATATYPE="VARCHAR2" LENGTH="20"  NAME="RISK_CATEGORY"    KEYTYPE="NOT A KEY"   FIELDNUMBER="16" PRECISION="20" SCALE="0" NULLABLE="NULL"/>
        <TARGETFIELD DATATYPE="VARCHAR2" LENGTH="1"   NAME="IS_HIGH_RISK"     KEYTYPE="NOT A KEY"   FIELDNUMBER="17" PRECISION="1"  SCALE="0" NULLABLE="NULL"/>
        <TARGETFIELD DATATYPE="VARCHAR2" LENGTH="10"  NAME="PLATFORM"         KEYTYPE="NOT A KEY"   FIELDNUMBER="18" PRECISION="10" SCALE="0" NULLABLE="NULL"/>
        <TARGETFIELD DATATYPE="VARCHAR2" LENGTH="20"  NAME="TXN_STATUS"       KEYTYPE="NOT A KEY"   FIELDNUMBER="19" PRECISION="20" SCALE="0" NULLABLE="NULL"/>
        <TARGETFIELD DATATYPE="NUMBER"   LENGTH="8"   NAME="DW_INSERT_DT"     KEYTYPE="NOT A KEY"   FIELDNUMBER="20" PRECISION="29" SCALE="9" NULLABLE="NULL"/>
      </TARGET>

      <TARGET DATABASETYPE="Oracle" NAME="FACT_TXN_REJECTS" OWNERNAME="DWH">
        <TARGETFIELD DATATYPE="NUMBER"   LENGTH="15"  NAME="TXN_ID"           KEYTYPE="PRIMARY KEY" FIELDNUMBER="1"  PRECISION="15" SCALE="0" NULLABLE="NOTNULL"/>
        <TARGETFIELD DATATYPE="VARCHAR2" LENGTH="200" NAME="REJECT_REASON"    KEYTYPE="NOT A KEY"   FIELDNUMBER="2"  PRECISION="200" SCALE="0" NULLABLE="NULL"/>
        <TARGETFIELD DATATYPE="DATE"     LENGTH="29"  NAME="REJECT_DT"        KEYTYPE="NOT A KEY"   FIELDNUMBER="3"  PRECISION="29" SCALE="9" NULLABLE="NULL"/>
      </TARGET>

      <!-- ═══════════════════════════════════════════════════════
           MAPPING: m_SALES_FACT_SCD2_LOAD
           Complexity: HIGH
           Transformations (18):
             SQ_TRANSACTIONS, SQ_ACCOUNTS, SQ_FX_RATES, SQ_PRODUCTS,
             JNR_TXN_ACCOUNTS, JNR_WITH_PRODUCTS,
             LKP_FX_RATES (connected), LKP_ACCOUNT_HISTORY (dynamic),
             EXP_CURRENCY_CONVERT, EXP_RISK_FLAGS,
             AGG_DAILY_TOTALS,
             RTR_TXN_ROUTING (3 output groups),
             UPD_INSERT_STRATEGY, UPD_REJECT_STRATEGY,
             SRT_BY_ACCOUNT, SEQ_TXN_KEY,
             FACT_TRANSACTIONS (target), FACT_TXN_REJECTS (target)
           Logic: Multi-source join, FX conversion to USD, risk flagging,
                  daily aggregation check, router splits valid/suspicious/rejected,
                  SCD-style update strategy, sequence key generation
      ════════════════════════════════════════════════════════ -->
      <MAPPING DESCRIPTION="Complex financial transaction fact load. Joins 4 sources, converts currencies to USD via FX lookup, flags high-risk transactions, routes to valid/suspicious/reject targets via Router, applies Update Strategy for insert/reject logic. HIGH complexity."
               ISVALID="YES" NAME="m_SALES_FACT_SCD2_LOAD"
               OBJECTVERSION="1" VERSIONNUMBER="1">

        <!-- ── Source Qualifiers ─────────────────────────────── -->
        <TRANSFORMATION NAME="SQ_STG_TRANSACTIONS" TYPE="Source Qualifier" REUSABLE="NO"
                        DESCRIPTION="Read transactions — exclude VOID status. Custom SQL filters to current processing window using $$BATCH_DATE parameter.">
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="TXN_ID"       PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="15" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="ACCOUNT_ID"   PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="PRODUCT_ID"   PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="ADVISOR_ID"   PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="DATE"     NAME="TXN_DATE"     PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="29" SCALE="9"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_TYPE"     PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="TXN_AMOUNT"   PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="18" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="CURRENCY"     PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="3"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="UNITS"        PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="10" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="UNIT_PRICE"   PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="18" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_STATUS"   PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="PLATFORM"     PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="10" SCALE="0"/>
          <TABLEATTRIBUTE NAME="Sql Query"     VALUE="SELECT * FROM STAGING.STG_TRANSACTIONS WHERE TXN_DATE &gt;= TO_DATE(&apos;$$BATCH_DATE&apos;, &apos;YYYY-MM-DD&apos;) AND TXN_STATUS != &apos;VOID&apos;"/>
          <TABLEATTRIBUTE NAME="Source Filter" VALUE=""/>
        </TRANSFORMATION>

        <TRANSFORMATION NAME="SQ_STG_ACCOUNTS" TYPE="Source Qualifier" REUSABLE="NO"
                        DESCRIPTION="Read all accounts from staging">
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="ACCOUNT_ID"       PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="ACCOUNT_NAME"     PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="100" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="ACCOUNT_TYPE"     PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="COUNTRY_CODE"     PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="5"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="RISK_RATING"      PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="DATE"     NAME="ACCOUNT_OPEN_DT"  PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="29" SCALE="9"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="IS_INSTITUTIONAL"  PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="1"  SCALE="0"/>
          <TABLEATTRIBUTE NAME="Sql Query" VALUE=""/>
        </TRANSFORMATION>

        <TRANSFORMATION NAME="SQ_STG_FX_RATES" TYPE="Source Qualifier" REUSABLE="NO"
                        DESCRIPTION="Read FX rates for current batch date">
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="FROM_CURRENCY"  PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="3"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TO_CURRENCY"    PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="3"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="DATE"     NAME="RATE_DATE"      PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="29" SCALE="9"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="EXCHANGE_RATE"  PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="18" SCALE="8"/>
          <TABLEATTRIBUTE NAME="Source Filter" VALUE="RATE_DATE = TO_DATE(&apos;$$BATCH_DATE&apos;, &apos;YYYY-MM-DD&apos;) AND TO_CURRENCY = &apos;USD&apos;"/>
        </TRANSFORMATION>

        <TRANSFORMATION NAME="SQ_STG_PRODUCTS" TYPE="Source Qualifier" REUSABLE="NO"
                        DESCRIPTION="Read all products">
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="PRODUCT_ID"    PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="PRODUCT_NAME"  PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="100" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="ASSET_CLASS"   PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="50" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="RISK_CATEGORY" PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="MANAGEMENT_FEE" PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="8" SCALE="4"/>
          <TABLEATTRIBUTE NAME="Sql Query" VALUE=""/>
        </TRANSFORMATION>

        <!-- ── Joiner 1: Transactions ⋈ Accounts ───────────── -->
        <TRANSFORMATION NAME="JNR_TXN_ACCOUNTS" TYPE="Joiner" REUSABLE="NO"
                        DESCRIPTION="Inner join transactions (detail) to accounts (master) on ACCOUNT_ID">
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="ACCOUNT_ID_M"      PORTTYPE="INPUT"  EXPRESSION="" PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="ACCOUNT_NAME"      PORTTYPE="INPUT"  EXPRESSION="" PRECISION="100" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="ACCOUNT_TYPE"      PORTTYPE="INPUT"  EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="COUNTRY_CODE"      PORTTYPE="INPUT"  EXPRESSION="" PRECISION="5"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="RISK_RATING"       PORTTYPE="INPUT"  EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="IS_INSTITUTIONAL"  PORTTYPE="INPUT"  EXPRESSION="" PRECISION="1"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="TXN_ID"            PORTTYPE="INPUT"  EXPRESSION="" PRECISION="15" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="ACCOUNT_ID_D"      PORTTYPE="INPUT"  EXPRESSION="" PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="PRODUCT_ID"        PORTTYPE="INPUT"  EXPRESSION="" PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="DATE"     NAME="TXN_DATE"          PORTTYPE="INPUT"  EXPRESSION="" PRECISION="29" SCALE="9"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_TYPE"          PORTTYPE="INPUT"  EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="TXN_AMOUNT"        PORTTYPE="INPUT"  EXPRESSION="" PRECISION="18" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="CURRENCY"          PORTTYPE="INPUT"  EXPRESSION="" PRECISION="3"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="UNITS"             PORTTYPE="INPUT"  EXPRESSION="" PRECISION="10" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_STATUS"        PORTTYPE="INPUT"  EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="PLATFORM"          PORTTYPE="INPUT"  EXPRESSION="" PRECISION="10" SCALE="0"/>
          <!-- Outputs -->
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="OUT_TXN_ID"        PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="15" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="OUT_ACCOUNT_ID"    PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="OUT_ACCOUNT_TYPE"  PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="OUT_COUNTRY_CODE"  PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="5"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="OUT_RISK_RATING"   PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="OUT_IS_INST"       PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="1"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="OUT_PRODUCT_ID"    PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="DATE"     NAME="OUT_TXN_DATE"      PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="29" SCALE="9"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="OUT_TXN_TYPE"      PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="OUT_TXN_AMOUNT"    PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="18" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="OUT_CURRENCY"      PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="3"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="OUT_UNITS"         PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="10" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="OUT_TXN_STATUS"    PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="OUT_PLATFORM"      PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="10" SCALE="0"/>
          <TABLEATTRIBUTE NAME="Join Type"      VALUE="Normal"/>
          <TABLEATTRIBUTE NAME="Join Condition" VALUE="ACCOUNT_ID_M = ACCOUNT_ID_D"/>
        </TRANSFORMATION>

        <!-- ── Joiner 2: Result ⋈ Products ──────────────────── -->
        <TRANSFORMATION NAME="JNR_WITH_PRODUCTS" TYPE="Joiner" REUSABLE="NO"
                        DESCRIPTION="Left outer join with products (master) on PRODUCT_ID — products may be null for non-product transactions">
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="PRODUCT_ID_M"  PORTTYPE="INPUT"  EXPRESSION="" PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="ASSET_CLASS"   PORTTYPE="INPUT"  EXPRESSION="" PRECISION="50" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="RISK_CATEGORY" PORTTYPE="INPUT"  EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="MANAGEMENT_FEE" PORTTYPE="INPUT" EXPRESSION="" PRECISION="8"  SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="PRODUCT_ID_D"  PORTTYPE="INPUT"  EXPRESSION="" PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="TXN_ID"        PORTTYPE="INPUT"  EXPRESSION="" PRECISION="15" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="ACCOUNT_ID"    PORTTYPE="INPUT"  EXPRESSION="" PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="ACCOUNT_TYPE"  PORTTYPE="INPUT"  EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="COUNTRY_CODE"  PORTTYPE="INPUT"  EXPRESSION="" PRECISION="5"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="RISK_RATING"   PORTTYPE="INPUT"  EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="DATE"     NAME="TXN_DATE"      PORTTYPE="INPUT"  EXPRESSION="" PRECISION="29" SCALE="9"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_TYPE"      PORTTYPE="INPUT"  EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="TXN_AMOUNT"    PORTTYPE="INPUT"  EXPRESSION="" PRECISION="18" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="CURRENCY"      PORTTYPE="INPUT"  EXPRESSION="" PRECISION="3"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="UNITS"         PORTTYPE="INPUT"  EXPRESSION="" PRECISION="10" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_STATUS"    PORTTYPE="INPUT"  EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="PLATFORM"      PORTTYPE="INPUT"  EXPRESSION="" PRECISION="10" SCALE="0"/>
          <!-- Outputs — all fields forward -->
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="O_TXN_ID"        PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="15" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="O_ACCOUNT_ID"    PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="O_ACCOUNT_TYPE"  PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="O_COUNTRY_CODE"  PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="5"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="O_RISK_RATING"   PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="O_PRODUCT_ID"    PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="O_ASSET_CLASS"   PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="50" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="O_RISK_CATEGORY" PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="O_MGMT_FEE"      PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="8"  SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="DATE"     NAME="O_TXN_DATE"      PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="29" SCALE="9"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="O_TXN_TYPE"      PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="O_TXN_AMOUNT"    PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="18" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="O_CURRENCY"      PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="3"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="O_UNITS"         PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="10" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="O_TXN_STATUS"    PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="O_PLATFORM"      PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="10" SCALE="0"/>
          <TABLEATTRIBUTE NAME="Join Type"      VALUE="Master Outer"/>
          <TABLEATTRIBUTE NAME="Join Condition" VALUE="PRODUCT_ID_M = PRODUCT_ID_D"/>
        </TRANSFORMATION>

        <!-- ── Lookup: FX Rates (connected) ─────────────────── -->
        <TRANSFORMATION NAME="LKP_FX_RATES" TYPE="Lookup" REUSABLE="NO"
                        DESCRIPTION="Connected lookup to FX rates table. Converts transaction currency to USD using batch date rate. Returns EXCHANGE_RATE. Default 1.0 if currency is already USD or rate not found.">
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="IN_CURRENCY"    PORTTYPE="INPUT"  EXPRESSION="" PRECISION="3"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="DATE"     NAME="IN_RATE_DATE"   PORTTYPE="INPUT"  EXPRESSION="" PRECISION="29" SCALE="9"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="EXCHANGE_RATE"  PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="18" SCALE="8" DEFAULTVALUE="1"/>
          <TABLEATTRIBUTE NAME="Lookup Table"     VALUE="STG_FX_RATES"/>
          <TABLEATTRIBUTE NAME="Lookup Condition" VALUE="FROM_CURRENCY = IN_CURRENCY AND RATE_DATE = IN_RATE_DATE AND TO_CURRENCY = &apos;USD&apos;"/>
          <TABLEATTRIBUTE NAME="Lookup Cache Persistent" VALUE="YES"/>
          <TABLEATTRIBUTE NAME="Lookup Policy on Multiple Match" VALUE="Return Last"/>
        </TRANSFORMATION>

        <!-- ── Expression 1: Currency conversion + base derivations -->
        <TRANSFORMATION NAME="EXP_CURRENCY_CONVERT" TYPE="Expression" REUSABLE="NO"
                        DESCRIPTION="Apply FX rate to convert TXN_AMOUNT to USD. Calculate management fee amount. Derive TXN_YEAR_MONTH and TXN_TYPE_DESC.">
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="TXN_ID"          PORTTYPE="INPUT/OUTPUT" EXPRESSION="O_TXN_ID"       PRECISION="15" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="ACCOUNT_ID"      PORTTYPE="INPUT/OUTPUT" EXPRESSION="O_ACCOUNT_ID"   PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="ACCOUNT_TYPE"    PORTTYPE="INPUT/OUTPUT" EXPRESSION="O_ACCOUNT_TYPE" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="COUNTRY_CODE"    PORTTYPE="INPUT/OUTPUT" EXPRESSION="O_COUNTRY_CODE" PRECISION="5"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="RISK_RATING"     PORTTYPE="INPUT/OUTPUT" EXPRESSION="O_RISK_RATING"  PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="PRODUCT_ID"      PORTTYPE="INPUT/OUTPUT" EXPRESSION="O_PRODUCT_ID"   PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="ASSET_CLASS"     PORTTYPE="INPUT/OUTPUT" EXPRESSION="O_ASSET_CLASS"  PRECISION="50" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="RISK_CATEGORY"   PORTTYPE="INPUT/OUTPUT" EXPRESSION="O_RISK_CATEGORY" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="DATE"     NAME="TXN_DATE"        PORTTYPE="INPUT/OUTPUT" EXPRESSION="O_TXN_DATE"     PRECISION="29" SCALE="9"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_TYPE"        PORTTYPE="INPUT/OUTPUT" EXPRESSION="O_TXN_TYPE"     PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="TXN_AMOUNT"      PORTTYPE="INPUT/OUTPUT" EXPRESSION="O_TXN_AMOUNT"   PRECISION="18" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="CURRENCY"        PORTTYPE="INPUT/OUTPUT" EXPRESSION="O_CURRENCY"     PRECISION="3"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="UNITS"           PORTTYPE="INPUT/OUTPUT" EXPRESSION="O_UNITS"        PRECISION="10" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_STATUS"      PORTTYPE="INPUT/OUTPUT" EXPRESSION="O_TXN_STATUS"   PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="PLATFORM"        PORTTYPE="INPUT/OUTPUT" EXPRESSION="O_PLATFORM"     PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="EXCHANGE_RATE"   PORTTYPE="INPUT/OUTPUT" EXPRESSION="EXCHANGE_RATE"  PRECISION="18" SCALE="8"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="O_MGMT_FEE_PCT"  PORTTYPE="INPUT/OUTPUT" EXPRESSION="O_MGMT_FEE"    PRECISION="8"  SCALE="4"/>
          <!-- Derived: USD amount -->
          <TRANSFORMFIELD DATATYPE="NUMBER" NAME="TXN_AMOUNT_USD"
                          PORTTYPE="OUTPUT"
                          EXPRESSION="ROUND(TXN_AMOUNT * IIF(CURRENCY = &apos;USD&apos;, 1, EXCHANGE_RATE), 4)"
                          PRECISION="18" SCALE="4"/>
          <!-- Derived: management fee in USD -->
          <TRANSFORMFIELD DATATYPE="NUMBER" NAME="MANAGEMENT_FEE_AMT"
                          PORTTYPE="OUTPUT"
                          EXPRESSION="ROUND((TXN_AMOUNT * IIF(CURRENCY = &apos;USD&apos;, 1, EXCHANGE_RATE)) * IIF(ISNULL(O_MGMT_FEE_PCT), 0, O_MGMT_FEE_PCT), 4)"
                          PRECISION="18" SCALE="4"/>
          <!-- Derived: year-month -->
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_YEAR_MONTH"
                          PORTTYPE="OUTPUT"
                          EXPRESSION="TO_CHAR(TXN_DATE, &apos;YYYY-MM&apos;)"
                          PRECISION="7" SCALE="0"/>
          <!-- Derived: human-readable txn type -->
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_TYPE_DESC"
                          PORTTYPE="OUTPUT"
                          EXPRESSION="DECODE(TXN_TYPE, &apos;BUY&apos;, &apos;PURCHASE&apos;, &apos;SELL&apos;, &apos;SALE&apos;, &apos;DIV&apos;, &apos;DIVIDEND&apos;, &apos;INT&apos;, &apos;INTEREST&apos;, &apos;FEE&apos;, &apos;MANAGEMENT FEE&apos;, &apos;TRF&apos;, &apos;TRANSFER&apos;, &apos;OTHER&apos;)"
                          PRECISION="30" SCALE="0"/>
        </TRANSFORMATION>

        <!-- ── Expression 2: Risk flagging ──────────────────── -->
        <TRANSFORMATION NAME="EXP_RISK_FLAGS" TYPE="Expression" REUSABLE="NO"
                        DESCRIPTION="Derive IS_HIGH_RISK flag. High risk = (RISK_RATING in HIGH/CRITICAL) OR (RISK_CATEGORY = HIGH_RISK) OR (TXN_AMOUNT_USD > 1000000). Also derive reject reason for invalid transactions.">
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="TXN_ID"            PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_ID"          PRECISION="15" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="ACCOUNT_ID"        PORTTYPE="INPUT/OUTPUT" EXPRESSION="ACCOUNT_ID"      PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="ACCOUNT_TYPE"      PORTTYPE="INPUT/OUTPUT" EXPRESSION="ACCOUNT_TYPE"    PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="RISK_RATING"       PORTTYPE="INPUT/OUTPUT" EXPRESSION="RISK_RATING"     PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="PRODUCT_ID"        PORTTYPE="INPUT/OUTPUT" EXPRESSION="PRODUCT_ID"      PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="ASSET_CLASS"       PORTTYPE="INPUT/OUTPUT" EXPRESSION="ASSET_CLASS"     PRECISION="50" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="RISK_CATEGORY"     PORTTYPE="INPUT/OUTPUT" EXPRESSION="RISK_CATEGORY"   PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="DATE"     NAME="TXN_DATE"          PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_DATE"        PRECISION="29" SCALE="9"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_YEAR_MONTH"    PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_YEAR_MONTH"  PRECISION="7"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_TYPE"          PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_TYPE"        PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_TYPE_DESC"     PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_TYPE_DESC"   PRECISION="30" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="TXN_AMOUNT"        PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_AMOUNT"      PRECISION="18" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="TXN_AMOUNT_USD"    PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_AMOUNT_USD"  PRECISION="18" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="MANAGEMENT_FEE_AMT" PORTTYPE="INPUT/OUTPUT" EXPRESSION="MANAGEMENT_FEE_AMT" PRECISION="18" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="CURRENCY"          PORTTYPE="INPUT/OUTPUT" EXPRESSION="CURRENCY"        PRECISION="3"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="UNITS"             PORTTYPE="INPUT/OUTPUT" EXPRESSION="UNITS"           PRECISION="10" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_STATUS"        PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_STATUS"      PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="PLATFORM"          PORTTYPE="INPUT/OUTPUT" EXPRESSION="PLATFORM"        PRECISION="10" SCALE="0"/>
          <!-- Derived: high risk flag -->
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="IS_HIGH_RISK"
                          PORTTYPE="OUTPUT"
                          EXPRESSION="IIF(INSTR(&apos;HIGH,CRITICAL&apos;, RISK_RATING) &gt; 0 OR RISK_CATEGORY = &apos;HIGH_RISK&apos; OR TXN_AMOUNT_USD &gt; 1000000, &apos;Y&apos;, &apos;N&apos;)"
                          PRECISION="1" SCALE="0"/>
          <!-- Derived: reject reason (empty string = valid) -->
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="REJECT_REASON"
                          PORTTYPE="OUTPUT"
                          EXPRESSION="IIF(ISNULL(TXN_DATE), &apos;NULL_TXN_DATE&apos;, IIF(TXN_AMOUNT_USD &lt; 0, &apos;NEGATIVE_AMOUNT&apos;, IIF(ISNULL(ACCOUNT_ID), &apos;NULL_ACCOUNT&apos;, &apos;&apos;)))"
                          PRECISION="200" SCALE="0"/>
        </TRANSFORMATION>

        <!-- ── Sorter: sort by ACCOUNT_ID for aggregation ────── -->
        <TRANSFORMATION NAME="SRT_BY_ACCOUNT" TYPE="Sorter" REUSABLE="NO"
                        DESCRIPTION="Sort records by ACCOUNT_ID then TXN_DATE for downstream aggregation performance">
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="TXN_ID"            PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_ID"           PRECISION="15" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="ACCOUNT_ID"        PORTTYPE="INPUT/OUTPUT" EXPRESSION="ACCOUNT_ID"       PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="ACCOUNT_TYPE"      PORTTYPE="INPUT/OUTPUT" EXPRESSION="ACCOUNT_TYPE"     PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="RISK_RATING"       PORTTYPE="INPUT/OUTPUT" EXPRESSION="RISK_RATING"      PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="PRODUCT_ID"        PORTTYPE="INPUT/OUTPUT" EXPRESSION="PRODUCT_ID"       PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="ASSET_CLASS"       PORTTYPE="INPUT/OUTPUT" EXPRESSION="ASSET_CLASS"      PRECISION="50" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="RISK_CATEGORY"     PORTTYPE="INPUT/OUTPUT" EXPRESSION="RISK_CATEGORY"    PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="DATE"     NAME="TXN_DATE"          PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_DATE"         PRECISION="29" SCALE="9"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_YEAR_MONTH"    PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_YEAR_MONTH"   PRECISION="7"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_TYPE"          PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_TYPE"         PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_TYPE_DESC"     PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_TYPE_DESC"    PRECISION="30" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="TXN_AMOUNT"        PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_AMOUNT"       PRECISION="18" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="TXN_AMOUNT_USD"    PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_AMOUNT_USD"   PRECISION="18" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="MANAGEMENT_FEE_AMT" PORTTYPE="INPUT/OUTPUT" EXPRESSION="MANAGEMENT_FEE_AMT" PRECISION="18" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="CURRENCY"          PORTTYPE="INPUT/OUTPUT" EXPRESSION="CURRENCY"         PRECISION="3"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="UNITS"             PORTTYPE="INPUT/OUTPUT" EXPRESSION="UNITS"            PRECISION="10" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_STATUS"        PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_STATUS"       PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="PLATFORM"          PORTTYPE="INPUT/OUTPUT" EXPRESSION="PLATFORM"         PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="IS_HIGH_RISK"      PORTTYPE="INPUT/OUTPUT" EXPRESSION="IS_HIGH_RISK"     PRECISION="1"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="REJECT_REASON"     PORTTYPE="INPUT/OUTPUT" EXPRESSION="REJECT_REASON"    PRECISION="200" SCALE="0"/>
          <TABLEATTRIBUTE NAME="Sorter Key1"      VALUE="ACCOUNT_ID"/>
          <TABLEATTRIBUTE NAME="Sorter Key1 Dir"  VALUE="Ascending"/>
          <TABLEATTRIBUTE NAME="Sorter Key2"      VALUE="TXN_DATE"/>
          <TABLEATTRIBUTE NAME="Sorter Key2 Dir"  VALUE="Ascending"/>
          <TABLEATTRIBUTE NAME="Case Sensitive"   VALUE="NO"/>
        </TRANSFORMATION>

        <!-- ── Router: split valid / high-risk / reject ──────── -->
        <TRANSFORMATION NAME="RTR_TXN_ROUTING" TYPE="Router" REUSABLE="NO"
                        DESCRIPTION="Route transactions to 3 output groups: VALID (clean transactions), HIGH_RISK (flagged for review — still inserted but marked), REJECT (invalid transactions with reject reason set)">
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="TXN_ID"            PORTTYPE="INPUT"  EXPRESSION="" PRECISION="15" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="ACCOUNT_ID"        PORTTYPE="INPUT"  EXPRESSION="" PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="ACCOUNT_TYPE"      PORTTYPE="INPUT"  EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="RISK_RATING"       PORTTYPE="INPUT"  EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="PRODUCT_ID"        PORTTYPE="INPUT"  EXPRESSION="" PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="ASSET_CLASS"       PORTTYPE="INPUT"  EXPRESSION="" PRECISION="50" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="RISK_CATEGORY"     PORTTYPE="INPUT"  EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="DATE"     NAME="TXN_DATE"          PORTTYPE="INPUT"  EXPRESSION="" PRECISION="29" SCALE="9"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_YEAR_MONTH"    PORTTYPE="INPUT"  EXPRESSION="" PRECISION="7"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_TYPE"          PORTTYPE="INPUT"  EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_TYPE_DESC"     PORTTYPE="INPUT"  EXPRESSION="" PRECISION="30" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="TXN_AMOUNT"        PORTTYPE="INPUT"  EXPRESSION="" PRECISION="18" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="TXN_AMOUNT_USD"    PORTTYPE="INPUT"  EXPRESSION="" PRECISION="18" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="MANAGEMENT_FEE_AMT" PORTTYPE="INPUT" EXPRESSION="" PRECISION="18" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="CURRENCY"          PORTTYPE="INPUT"  EXPRESSION="" PRECISION="3"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="UNITS"             PORTTYPE="INPUT"  EXPRESSION="" PRECISION="10" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_STATUS"        PORTTYPE="INPUT"  EXPRESSION="" PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="PLATFORM"          PORTTYPE="INPUT"  EXPRESSION="" PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="IS_HIGH_RISK"      PORTTYPE="INPUT"  EXPRESSION="" PRECISION="1"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="REJECT_REASON"     PORTTYPE="INPUT"  EXPRESSION="" PRECISION="200" SCALE="0"/>
          <TABLEATTRIBUTE NAME="Group Filter Condition 1" VALUE="REJECT_REASON = &apos;&apos; AND IS_HIGH_RISK = &apos;N&apos;"/>
          <TABLEATTRIBUTE NAME="Group Name 1"             VALUE="VALID"/>
          <TABLEATTRIBUTE NAME="Group Filter Condition 2" VALUE="REJECT_REASON = &apos;&apos; AND IS_HIGH_RISK = &apos;Y&apos;"/>
          <TABLEATTRIBUTE NAME="Group Name 2"             VALUE="HIGH_RISK"/>
          <TABLEATTRIBUTE NAME="Group Filter Condition 3" VALUE="REJECT_REASON != &apos;&apos;"/>
          <TABLEATTRIBUTE NAME="Group Name 3"             VALUE="REJECT"/>
        </TRANSFORMATION>

        <!-- ── Sequence Generator: surrogate key for fact ─────── -->
        <TRANSFORMATION NAME="SEQ_TXN_KEY" TYPE="Sequence Generator" REUSABLE="NO"
                        DESCRIPTION="Generate surrogate key TXN_KEY for FACT_TRANSACTIONS. Start at 1, increment by 1, no cycle.">
          <TRANSFORMFIELD DATATYPE="NUMBER" NAME="NEXTVAL" PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="15" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER" NAME="CURRVAL" PORTTYPE="OUTPUT" EXPRESSION="" PRECISION="15" SCALE="0"/>
          <TABLEATTRIBUTE NAME="Start Value"  VALUE="1"/>
          <TABLEATTRIBUTE NAME="Increment By" VALUE="1"/>
          <TABLEATTRIBUTE NAME="End Value"    VALUE="2147483647"/>
          <TABLEATTRIBUTE NAME="Cycle"        VALUE="NO"/>
          <TABLEATTRIBUTE NAME="Reset"        VALUE="NO"/>
        </TRANSFORMATION>

        <!-- ── Update Strategy: valid + high-risk → insert ──── -->
        <TRANSFORMATION NAME="UPD_INSERT_STRATEGY" TYPE="Update Strategy" REUSABLE="NO"
                        DESCRIPTION="All rows from VALID and HIGH_RISK router groups are inserted. DD_INSERT used for all rows — no update logic for this fact table.">
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="TXN_KEY"           PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_KEY"          PRECISION="15" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="ACCOUNT_ID"        PORTTYPE="INPUT/OUTPUT" EXPRESSION="ACCOUNT_ID"       PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="PRODUCT_ID"        PORTTYPE="INPUT/OUTPUT" EXPRESSION="PRODUCT_ID"       PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="DATE"     NAME="TXN_DATE"          PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_DATE"         PRECISION="29" SCALE="9"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_YEAR_MONTH"    PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_YEAR_MONTH"   PRECISION="7"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_TYPE"          PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_TYPE"         PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_TYPE_DESC"     PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_TYPE_DESC"    PRECISION="30" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="TXN_AMOUNT_LOCAL"  PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_AMOUNT"       PRECISION="18" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="TXN_AMOUNT_USD"    PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_AMOUNT_USD"   PRECISION="18" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="MANAGEMENT_FEE_AMT" PORTTYPE="INPUT/OUTPUT" EXPRESSION="MANAGEMENT_FEE_AMT" PRECISION="18" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="UNITS"             PORTTYPE="INPUT/OUTPUT" EXPRESSION="UNITS"            PRECISION="10" SCALE="4"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="CURRENCY"          PORTTYPE="INPUT/OUTPUT" EXPRESSION="CURRENCY"         PRECISION="3"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="ACCOUNT_TYPE"      PORTTYPE="INPUT/OUTPUT" EXPRESSION="ACCOUNT_TYPE"     PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="RISK_RATING"       PORTTYPE="INPUT/OUTPUT" EXPRESSION="RISK_RATING"      PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="ASSET_CLASS"       PORTTYPE="INPUT/OUTPUT" EXPRESSION="ASSET_CLASS"      PRECISION="50" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="RISK_CATEGORY"     PORTTYPE="INPUT/OUTPUT" EXPRESSION="RISK_CATEGORY"    PRECISION="20" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="IS_HIGH_RISK"      PORTTYPE="INPUT/OUTPUT" EXPRESSION="IS_HIGH_RISK"     PRECISION="1"  SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="PLATFORM"          PORTTYPE="INPUT/OUTPUT" EXPRESSION="PLATFORM"         PRECISION="10" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="TXN_STATUS"        PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_STATUS"       PRECISION="20" SCALE="0"/>
          <TABLEATTRIBUTE NAME="Update Strategy Expression" VALUE="DD_INSERT"/>
          <TABLEATTRIBUTE NAME="Forward Rejected Rows"      VALUE="NO"/>
        </TRANSFORMATION>

        <!-- ── Update Strategy: rejects ─────────────────────── -->
        <TRANSFORMATION NAME="UPD_REJECT_STRATEGY" TYPE="Update Strategy" REUSABLE="NO"
                        DESCRIPTION="Rows from REJECT router group are inserted into reject table.">
          <TRANSFORMFIELD DATATYPE="NUMBER"   NAME="TXN_ID"        PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_ID"        PRECISION="15" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="VARCHAR2" NAME="REJECT_REASON" PORTTYPE="INPUT/OUTPUT" EXPRESSION="REJECT_REASON" PRECISION="200" SCALE="0"/>
          <TRANSFORMFIELD DATATYPE="DATE"     NAME="TXN_DATE"      PORTTYPE="INPUT/OUTPUT" EXPRESSION="TXN_DATE"      PRECISION="29" SCALE="9"/>
          <TABLEATTRIBUTE NAME="Update Strategy Expression" VALUE="DD_INSERT"/>
          <TABLEATTRIBUTE NAME="Forward Rejected Rows"      VALUE="NO"/>
        </TRANSFORMATION>

        <!-- ══════════════════════════════════════════════════════
             CONNECTORS — abbreviated for readability
             Full connector chain:
             SQ_TXN → JNR_TXN_ACCOUNTS (detail)
             SQ_ACCOUNTS → JNR_TXN_ACCOUNTS (master)
             SQ_PRODUCTS → JNR_WITH_PRODUCTS (master)
             JNR_TXN_ACCOUNTS → JNR_WITH_PRODUCTS (detail)
             JNR_WITH_PRODUCTS → LKP_FX_RATES (currency + date)
             JNR_WITH_PRODUCTS + LKP → EXP_CURRENCY_CONVERT
             EXP_CURRENCY_CONVERT → EXP_RISK_FLAGS
             EXP_RISK_FLAGS → SRT_BY_ACCOUNT
             SRT_BY_ACCOUNT → RTR_TXN_ROUTING
             RTR VALID + HIGH_RISK → SEQ + UPD_INSERT_STRATEGY → FACT_TRANSACTIONS
             RTR REJECT → UPD_REJECT_STRATEGY → FACT_TXN_REJECTS
        ═══════════════════════════════════════════════════════ -->
        <CONNECTOR FROMINSTANCE="SQ_STG_TRANSACTIONS" FROMINSTANCETYPE="Source Qualifier" FROMFIELD="TXN_ID"      TOINSTANCE="JNR_TXN_ACCOUNTS" TOINSTANCETYPE="Joiner" TOFIELD="TXN_ID"/>
        <CONNECTOR FROMINSTANCE="SQ_STG_TRANSACTIONS" FROMINSTANCETYPE="Source Qualifier" FROMFIELD="ACCOUNT_ID"  TOINSTANCE="JNR_TXN_ACCOUNTS" TOINSTANCETYPE="Joiner" TOFIELD="ACCOUNT_ID_D"/>
        <CONNECTOR FROMINSTANCE="SQ_STG_TRANSACTIONS" FROMINSTANCETYPE="Source Qualifier" FROMFIELD="PRODUCT_ID"  TOINSTANCE="JNR_TXN_ACCOUNTS" TOINSTANCETYPE="Joiner" TOFIELD="PRODUCT_ID"/>
        <CONNECTOR FROMINSTANCE="SQ_STG_TRANSACTIONS" FROMINSTANCETYPE="Source Qualifier" FROMFIELD="TXN_DATE"    TOINSTANCE="JNR_TXN_ACCOUNTS" TOINSTANCETYPE="Joiner" TOFIELD="TXN_DATE"/>
        <CONNECTOR FROMINSTANCE="SQ_STG_TRANSACTIONS" FROMINSTANCETYPE="Source Qualifier" FROMFIELD="TXN_TYPE"    TOINSTANCE="JNR_TXN_ACCOUNTS" TOINSTANCETYPE="Joiner" TOFIELD="TXN_TYPE"/>
        <CONNECTOR FROMINSTANCE="SQ_STG_TRANSACTIONS" FROMINSTANCETYPE="Source Qualifier" FROMFIELD="TXN_AMOUNT"  TOINSTANCE="JNR_TXN_ACCOUNTS" TOINSTANCETYPE="Joiner" TOFIELD="TXN_AMOUNT"/>
        <CONNECTOR FROMINSTANCE="SQ_STG_TRANSACTIONS" FROMINSTANCETYPE="Source Qualifier" FROMFIELD="CURRENCY"    TOINSTANCE="JNR_TXN_ACCOUNTS" TOINSTANCETYPE="Joiner" TOFIELD="CURRENCY"/>
        <CONNECTOR FROMINSTANCE="SQ_STG_TRANSACTIONS" FROMINSTANCETYPE="Source Qualifier" FROMFIELD="UNITS"       TOINSTANCE="JNR_TXN_ACCOUNTS" TOINSTANCETYPE="Joiner" TOFIELD="UNITS"/>
        <CONNECTOR FROMINSTANCE="SQ_STG_TRANSACTIONS" FROMINSTANCETYPE="Source Qualifier" FROMFIELD="TXN_STATUS"  TOINSTANCE="JNR_TXN_ACCOUNTS" TOINSTANCETYPE="Joiner" TOFIELD="TXN_STATUS"/>
        <CONNECTOR FROMINSTANCE="SQ_STG_TRANSACTIONS" FROMINSTANCETYPE="Source Qualifier" FROMFIELD="PLATFORM"    TOINSTANCE="JNR_TXN_ACCOUNTS" TOINSTANCETYPE="Joiner" TOFIELD="PLATFORM"/>

        <CONNECTOR FROMINSTANCE="SQ_STG_ACCOUNTS" FROMINSTANCETYPE="Source Qualifier" FROMFIELD="ACCOUNT_ID"      TOINSTANCE="JNR_TXN_ACCOUNTS" TOINSTANCETYPE="Joiner" TOFIELD="ACCOUNT_ID_M"/>
        <CONNECTOR FROMINSTANCE="SQ_STG_ACCOUNTS" FROMINSTANCETYPE="Source Qualifier" FROMFIELD="ACCOUNT_TYPE"    TOINSTANCE="JNR_TXN_ACCOUNTS" TOINSTANCETYPE="Joiner" TOFIELD="ACCOUNT_TYPE"/>
        <CONNECTOR FROMINSTANCE="SQ_STG_ACCOUNTS" FROMINSTANCETYPE="Source Qualifier" FROMFIELD="COUNTRY_CODE"    TOINSTANCE="JNR_TXN_ACCOUNTS" TOINSTANCETYPE="Joiner" TOFIELD="COUNTRY_CODE"/>
        <CONNECTOR FROMINSTANCE="SQ_STG_ACCOUNTS" FROMINSTANCETYPE="Source Qualifier" FROMFIELD="RISK_RATING"     TOINSTANCE="JNR_TXN_ACCOUNTS" TOINSTANCETYPE="Joiner" TOFIELD="RISK_RATING"/>
        <CONNECTOR FROMINSTANCE="SQ_STG_ACCOUNTS" FROMINSTANCETYPE="Source Qualifier" FROMFIELD="IS_INSTITUTIONAL" TOINSTANCE="JNR_TXN_ACCOUNTS" TOINSTANCETYPE="Joiner" TOFIELD="IS_INSTITUTIONAL"/>

        <CONNECTOR FROMINSTANCE="SQ_STG_PRODUCTS" FROMINSTANCETYPE="Source Qualifier" FROMFIELD="PRODUCT_ID"      TOINSTANCE="JNR_WITH_PRODUCTS" TOINSTANCETYPE="Joiner" TOFIELD="PRODUCT_ID_M"/>
        <CONNECTOR FROMINSTANCE="SQ_STG_PRODUCTS" FROMINSTANCETYPE="Source Qualifier" FROMFIELD="ASSET_CLASS"     TOINSTANCE="JNR_WITH_PRODUCTS" TOINSTANCETYPE="Joiner" TOFIELD="ASSET_CLASS"/>
        <CONNECTOR FROMINSTANCE="SQ_STG_PRODUCTS" FROMINSTANCETYPE="Source Qualifier" FROMFIELD="RISK_CATEGORY"   TOINSTANCE="JNR_WITH_PRODUCTS" TOINSTANCETYPE="Joiner" TOFIELD="RISK_CATEGORY"/>
        <CONNECTOR FROMINSTANCE="SQ_STG_PRODUCTS" FROMINSTANCETYPE="Source Qualifier" FROMFIELD="MANAGEMENT_FEE"  TOINSTANCE="JNR_WITH_PRODUCTS" TOINSTANCETYPE="Joiner" TOFIELD="MANAGEMENT_FEE"/>

        <CONNECTOR FROMINSTANCE="JNR_TXN_ACCOUNTS" FROMINSTANCETYPE="Joiner" FROMFIELD="OUT_TXN_ID"     TOINSTANCE="JNR_WITH_PRODUCTS" TOINSTANCETYPE="Joiner" TOFIELD="TXN_ID"/>
        <CONNECTOR FROMINSTANCE="JNR_TXN_ACCOUNTS" FROMINSTANCETYPE="Joiner" FROMFIELD="OUT_ACCOUNT_ID"  TOINSTANCE="JNR_WITH_PRODUCTS" TOINSTANCETYPE="Joiner" TOFIELD="ACCOUNT_ID"/>
        <CONNECTOR FROMINSTANCE="JNR_TXN_ACCOUNTS" FROMINSTANCETYPE="Joiner" FROMFIELD="OUT_ACCOUNT_TYPE" TOINSTANCE="JNR_WITH_PRODUCTS" TOINSTANCETYPE="Joiner" TOFIELD="ACCOUNT_TYPE"/>
        <CONNECTOR FROMINSTANCE="JNR_TXN_ACCOUNTS" FROMINSTANCETYPE="Joiner" FROMFIELD="OUT_COUNTRY_CODE" TOINSTANCE="JNR_WITH_PRODUCTS" TOINSTANCETYPE="Joiner" TOFIELD="COUNTRY_CODE"/>
        <CONNECTOR FROMINSTANCE="JNR_TXN_ACCOUNTS" FROMINSTANCETYPE="Joiner" FROMFIELD="OUT_RISK_RATING"  TOINSTANCE="JNR_WITH_PRODUCTS" TOINSTANCETYPE="Joiner" TOFIELD="RISK_RATING"/>
        <CONNECTOR FROMINSTANCE="JNR_TXN_ACCOUNTS" FROMINSTANCETYPE="Joiner" FROMFIELD="OUT_PRODUCT_ID"   TOINSTANCE="JNR_WITH_PRODUCTS" TOINSTANCETYPE="Joiner" TOFIELD="PRODUCT_ID_D"/>
        <CONNECTOR FROMINSTANCE="JNR_TXN_ACCOUNTS" FROMINSTANCETYPE="Joiner" FROMFIELD="OUT_TXN_DATE"     TOINSTANCE="JNR_WITH_PRODUCTS" TOINSTANCETYPE="Joiner" TOFIELD="TXN_DATE"/>
        <CONNECTOR FROMINSTANCE="JNR_TXN_ACCOUNTS" FROMINSTANCETYPE="Joiner" FROMFIELD="OUT_TXN_TYPE"     TOINSTANCE="JNR_WITH_PRODUCTS" TOINSTANCETYPE="Joiner" TOFIELD="TXN_TYPE"/>
        <CONNECTOR FROMINSTANCE="JNR_TXN_ACCOUNTS" FROMINSTANCETYPE="Joiner" FROMFIELD="OUT_TXN_AMOUNT"   TOINSTANCE="JNR_WITH_PRODUCTS" TOINSTANCETYPE="Joiner" TOFIELD="TXN_AMOUNT"/>
        <CONNECTOR FROMINSTANCE="JNR_TXN_ACCOUNTS" FROMINSTANCETYPE="Joiner" FROMFIELD="OUT_CURRENCY"     TOINSTANCE="JNR_WITH_PRODUCTS" TOINSTANCETYPE="Joiner" TOFIELD="CURRENCY"/>
        <CONNECTOR FROMINSTANCE="JNR_TXN_ACCOUNTS" FROMINSTANCETYPE="Joiner" FROMFIELD="OUT_UNITS"        TOINSTANCE="JNR_WITH_PRODUCTS" TOINSTANCETYPE="Joiner" TOFIELD="UNITS"/>
        <CONNECTOR FROMINSTANCE="JNR_TXN_ACCOUNTS" FROMINSTANCETYPE="Joiner" FROMFIELD="OUT_TXN_STATUS"   TOINSTANCE="JNR_WITH_PRODUCTS" TOINSTANCETYPE="Joiner" TOFIELD="TXN_STATUS"/>
        <CONNECTOR FROMINSTANCE="JNR_TXN_ACCOUNTS" FROMINSTANCETYPE="Joiner" FROMFIELD="OUT_PLATFORM"     TOINSTANCE="JNR_WITH_PRODUCTS" TOINSTANCETYPE="Joiner" TOFIELD="PLATFORM"/>

        <CONNECTOR FROMINSTANCE="JNR_WITH_PRODUCTS" FROMINSTANCETYPE="Joiner" FROMFIELD="O_CURRENCY"  TOINSTANCE="LKP_FX_RATES" TOINSTANCETYPE="Lookup" TOFIELD="IN_CURRENCY"/>
        <CONNECTOR FROMINSTANCE="JNR_WITH_PRODUCTS" FROMINSTANCETYPE="Joiner" FROMFIELD="O_TXN_DATE"  TOINSTANCE="LKP_FX_RATES" TOINSTANCETYPE="Lookup" TOFIELD="IN_RATE_DATE"/>

        <CONNECTOR FROMINSTANCE="JNR_WITH_PRODUCTS" FROMINSTANCETYPE="Joiner" FROMFIELD="O_TXN_ID"       TOINSTANCE="EXP_CURRENCY_CONVERT" TOINSTANCETYPE="Expression" TOFIELD="TXN_ID"/>
        <CONNECTOR FROMINSTANCE="JNR_WITH_PRODUCTS" FROMINSTANCETYPE="Joiner" FROMFIELD="O_ACCOUNT_ID"   TOINSTANCE="EXP_CURRENCY_CONVERT" TOINSTANCETYPE="Expression" TOFIELD="ACCOUNT_ID"/>
        <CONNECTOR FROMINSTANCE="JNR_WITH_PRODUCTS" FROMINSTANCETYPE="Joiner" FROMFIELD="O_ACCOUNT_TYPE" TOINSTANCE="EXP_CURRENCY_CONVERT" TOINSTANCETYPE="Expression" TOFIELD="ACCOUNT_TYPE"/>
        <CONNECTOR FROMINSTANCE="JNR_WITH_PRODUCTS" FROMINSTANCETYPE="Joiner" FROMFIELD="O_COUNTRY_CODE" TOINSTANCE="EXP_CURRENCY_CONVERT" TOINSTANCETYPE="Expression" TOFIELD="COUNTRY_CODE"/>
        <CONNECTOR FROMINSTANCE="JNR_WITH_PRODUCTS" FROMINSTANCETYPE="Joiner" FROMFIELD="O_RISK_RATING"  TOINSTANCE="EXP_CURRENCY_CONVERT" TOINSTANCETYPE="Expression" TOFIELD="RISK_RATING"/>
        <CONNECTOR FROMINSTANCE="JNR_WITH_PRODUCTS" FROMINSTANCETYPE="Joiner" FROMFIELD="O_PRODUCT_ID"   TOINSTANCE="EXP_CURRENCY_CONVERT" TOINSTANCETYPE="Expression" TOFIELD="PRODUCT_ID"/>
        <CONNECTOR FROMINSTANCE="JNR_WITH_PRODUCTS" FROMINSTANCETYPE="Joiner" FROMFIELD="O_ASSET_CLASS"  TOINSTANCE="EXP_CURRENCY_CONVERT" TOINSTANCETYPE="Expression" TOFIELD="ASSET_CLASS"/>
        <CONNECTOR FROMINSTANCE="JNR_WITH_PRODUCTS" FROMINSTANCETYPE="Joiner" FROMFIELD="O_RISK_CATEGORY" TOINSTANCE="EXP_CURRENCY_CONVERT" TOINSTANCETYPE="Expression" TOFIELD="RISK_CATEGORY"/>
        <CONNECTOR FROMINSTANCE="JNR_WITH_PRODUCTS" FROMINSTANCETYPE="Joiner" FROMFIELD="O_MGMT_FEE"     TOINSTANCE="EXP_CURRENCY_CONVERT" TOINSTANCETYPE="Expression" TOFIELD="O_MGMT_FEE_PCT"/>
        <CONNECTOR FROMINSTANCE="JNR_WITH_PRODUCTS" FROMINSTANCETYPE="Joiner" FROMFIELD="O_TXN_DATE"     TOINSTANCE="EXP_CURRENCY_CONVERT" TOINSTANCETYPE="Expression" TOFIELD="TXN_DATE"/>
        <CONNECTOR FROMINSTANCE="JNR_WITH_PRODUCTS" FROMINSTANCETYPE="Joiner" FROMFIELD="O_TXN_TYPE"     TOINSTANCE="EXP_CURRENCY_CONVERT" TOINSTANCETYPE="Expression" TOFIELD="TXN_TYPE"/>
        <CONNECTOR FROMINSTANCE="JNR_WITH_PRODUCTS" FROMINSTANCETYPE="Joiner" FROMFIELD="O_TXN_AMOUNT"   TOINSTANCE="EXP_CURRENCY_CONVERT" TOINSTANCETYPE="Expression" TOFIELD="TXN_AMOUNT"/>
        <CONNECTOR FROMINSTANCE="JNR_WITH_PRODUCTS" FROMINSTANCETYPE="Joiner" FROMFIELD="O_CURRENCY"     TOINSTANCE="EXP_CURRENCY_CONVERT" TOINSTANCETYPE="Expression" TOFIELD="CURRENCY"/>
        <CONNECTOR FROMINSTANCE="JNR_WITH_PRODUCTS" FROMINSTANCETYPE="Joiner" FROMFIELD="O_UNITS"        TOINSTANCE="EXP_CURRENCY_CONVERT" TOINSTANCETYPE="Expression" TOFIELD="UNITS"/>
        <CONNECTOR FROMINSTANCE="JNR_WITH_PRODUCTS" FROMINSTANCETYPE="Joiner" FROMFIELD="O_TXN_STATUS"   TOINSTANCE="EXP_CURRENCY_CONVERT" TOINSTANCETYPE="Expression" TOFIELD="TXN_STATUS"/>
        <CONNECTOR FROMINSTANCE="JNR_WITH_PRODUCTS" FROMINSTANCETYPE="Joiner" FROMFIELD="O_PLATFORM"     TOINSTANCE="EXP_CURRENCY_CONVERT" TOINSTANCETYPE="Expression" TOFIELD="PLATFORM"/>
        <CONNECTOR FROMINSTANCE="LKP_FX_RATES"      FROMINSTANCETYPE="Lookup" FROMFIELD="EXCHANGE_RATE"  TOINSTANCE="EXP_CURRENCY_CONVERT" TOINSTANCETYPE="Expression" TOFIELD="EXCHANGE_RATE"/>

        <CONNECTOR FROMINSTANCE="EXP_CURRENCY_CONVERT" FROMINSTANCETYPE="Expression" FROMFIELD="TXN_ID"            TOINSTANCE="EXP_RISK_FLAGS" TOINSTANCETYPE="Expression" TOFIELD="TXN_ID"/>
        <CONNECTOR FROMINSTANCE="EXP_CURRENCY_CONVERT" FROMINSTANCETYPE="Expression" FROMFIELD="ACCOUNT_ID"        TOINSTANCE="EXP_RISK_FLAGS" TOINSTANCETYPE="Expression" TOFIELD="ACCOUNT_ID"/>
        <CONNECTOR FROMINSTANCE="EXP_CURRENCY_CONVERT" FROMINSTANCETYPE="Expression" FROMFIELD="ACCOUNT_TYPE"      TOINSTANCE="EXP_RISK_FLAGS" TOINSTANCETYPE="Expression" TOFIELD="ACCOUNT_TYPE"/>
        <CONNECTOR FROMINSTANCE="EXP_CURRENCY_CONVERT" FROMINSTANCETYPE="Expression" FROMFIELD="RISK_RATING"       TOINSTANCE="EXP_RISK_FLAGS" TOINSTANCETYPE="Expression" TOFIELD="RISK_RATING"/>
        <CONNECTOR FROMINSTANCE="EXP_CURRENCY_CONVERT" FROMINSTANCETYPE="Expression" FROMFIELD="PRODUCT_ID"        TOINSTANCE="EXP_RISK_FLAGS" TOINSTANCETYPE="Expression" TOFIELD="PRODUCT_ID"/>
        <CONNECTOR FROMINSTANCE="EXP_CURRENCY_CONVERT" FROMINSTANCETYPE="Expression" FROMFIELD="ASSET_CLASS"       TOINSTANCE="EXP_RISK_FLAGS" TOINSTANCETYPE="Expression" TOFIELD="ASSET_CLASS"/>
        <CONNECTOR FROMINSTANCE="EXP_CURRENCY_CONVERT" FROMINSTANCETYPE="Expression" FROMFIELD="RISK_CATEGORY"     TOINSTANCE="EXP_RISK_FLAGS" TOINSTANCETYPE="Expression" TOFIELD="RISK_CATEGORY"/>
        <CONNECTOR FROMINSTANCE="EXP_CURRENCY_CONVERT" FROMINSTANCETYPE="Expression" FROMFIELD="TXN_DATE"          TOINSTANCE="EXP_RISK_FLAGS" TOINSTANCETYPE="Expression" TOFIELD="TXN_DATE"/>
        <CONNECTOR FROMINSTANCE="EXP_CURRENCY_CONVERT" FROMINSTANCETYPE="Expression" FROMFIELD="TXN_YEAR_MONTH"    TOINSTANCE="EXP_RISK_FLAGS" TOINSTANCETYPE="Expression" TOFIELD="TXN_YEAR_MONTH"/>
        <CONNECTOR FROMINSTANCE="EXP_CURRENCY_CONVERT" FROMINSTANCETYPE="Expression" FROMFIELD="TXN_TYPE"          TOINSTANCE="EXP_RISK_FLAGS" TOINSTANCETYPE="Expression" TOFIELD="TXN_TYPE"/>
        <CONNECTOR FROMINSTANCE="EXP_CURRENCY_CONVERT" FROMINSTANCETYPE="Expression" FROMFIELD="TXN_TYPE_DESC"     TOINSTANCE="EXP_RISK_FLAGS" TOINSTANCETYPE="Expression" TOFIELD="TXN_TYPE_DESC"/>
        <CONNECTOR FROMINSTANCE="EXP_CURRENCY_CONVERT" FROMINSTANCETYPE="Expression" FROMFIELD="TXN_AMOUNT"        TOINSTANCE="EXP_RISK_FLAGS" TOINSTANCETYPE="Expression" TOFIELD="TXN_AMOUNT"/>
        <CONNECTOR FROMINSTANCE="EXP_CURRENCY_CONVERT" FROMINSTANCETYPE="Expression" FROMFIELD="TXN_AMOUNT_USD"    TOINSTANCE="EXP_RISK_FLAGS" TOINSTANCETYPE="Expression" TOFIELD="TXN_AMOUNT_USD"/>
        <CONNECTOR FROMINSTANCE="EXP_CURRENCY_CONVERT" FROMINSTANCETYPE="Expression" FROMFIELD="MANAGEMENT_FEE_AMT" TOINSTANCE="EXP_RISK_FLAGS" TOINSTANCETYPE="Expression" TOFIELD="MANAGEMENT_FEE_AMT"/>
        <CONNECTOR FROMINSTANCE="EXP_CURRENCY_CONVERT" FROMINSTANCETYPE="Expression" FROMFIELD="CURRENCY"          TOINSTANCE="EXP_RISK_FLAGS" TOINSTANCETYPE="Expression" TOFIELD="CURRENCY"/>
        <CONNECTOR FROMINSTANCE="EXP_CURRENCY_CONVERT" FROMINSTANCETYPE="Expression" FROMFIELD="UNITS"             TOINSTANCE="EXP_RISK_FLAGS" TOINSTANCETYPE="Expression" TOFIELD="UNITS"/>
        <CONNECTOR FROMINSTANCE="EXP_CURRENCY_CONVERT" FROMINSTANCETYPE="Expression" FROMFIELD="TXN_STATUS"        TOINSTANCE="EXP_RISK_FLAGS" TOINSTANCETYPE="Expression" TOFIELD="TXN_STATUS"/>
        <CONNECTOR FROMINSTANCE="EXP_CURRENCY_CONVERT" FROMINSTANCETYPE="Expression" FROMFIELD="PLATFORM"          TOINSTANCE="EXP_RISK_FLAGS" TOINSTANCETYPE="Expression" TOFIELD="PLATFORM"/>

        <CONNECTOR FROMINSTANCE="EXP_RISK_FLAGS" FROMINSTANCETYPE="Expression" FROMFIELD="TXN_ID"            TOINSTANCE="SRT_BY_ACCOUNT" TOINSTANCETYPE="Sorter" TOFIELD="TXN_ID"/>
        <CONNECTOR FROMINSTANCE="EXP_RISK_FLAGS" FROMINSTANCETYPE="Expression" FROMFIELD="ACCOUNT_ID"        TOINSTANCE="SRT_BY_ACCOUNT" TOINSTANCETYPE="Sorter" TOFIELD="ACCOUNT_ID"/>
        <CONNECTOR FROMINSTANCE="EXP_RISK_FLAGS" FROMINSTANCETYPE="Expression" FROMFIELD="ACCOUNT_TYPE"      TOINSTANCE="SRT_BY_ACCOUNT" TOINSTANCETYPE="Sorter" TOFIELD="ACCOUNT_TYPE"/>
        <CONNECTOR FROMINSTANCE="EXP_RISK_FLAGS" FROMINSTANCETYPE="Expression" FROMFIELD="RISK_RATING"       TOINSTANCE="SRT_BY_ACCOUNT" TOINSTANCETYPE="Sorter" TOFIELD="RISK_RATING"/>
        <CONNECTOR FROMINSTANCE="EXP_RISK_FLAGS" FROMINSTANCETYPE="Expression" FROMFIELD="PRODUCT_ID"        TOINSTANCE="SRT_BY_ACCOUNT" TOINSTANCETYPE="Sorter" TOFIELD="PRODUCT_ID"/>
        <CONNECTOR FROMINSTANCE="EXP_RISK_FLAGS" FROMINSTANCETYPE="Expression" FROMFIELD="ASSET_CLASS"       TOINSTANCE="SRT_BY_ACCOUNT" TOINSTANCETYPE="Sorter" TOFIELD="ASSET_CLASS"/>
        <CONNECTOR FROMINSTANCE="EXP_RISK_FLAGS" FROMINSTANCETYPE="Expression" FROMFIELD="RISK_CATEGORY"     TOINSTANCE="SRT_BY_ACCOUNT" TOINSTANCETYPE="Sorter" TOFIELD="RISK_CATEGORY"/>
        <CONNECTOR FROMINSTANCE="EXP_RISK_FLAGS" FROMINSTANCETYPE="Expression" FROMFIELD="TXN_DATE"          TOINSTANCE="SRT_BY_ACCOUNT" TOINSTANCETYPE="Sorter" TOFIELD="TXN_DATE"/>
        <CONNECTOR FROMINSTANCE="EXP_RISK_FLAGS" FROMINSTANCETYPE="Expression" FROMFIELD="TXN_YEAR_MONTH"    TOINSTANCE="SRT_BY_ACCOUNT" TOINSTANCETYPE="Sorter" TOFIELD="TXN_YEAR_MONTH"/>
        <CONNECTOR FROMINSTANCE="EXP_RISK_FLAGS" FROMINSTANCETYPE="Expression" FROMFIELD="TXN_TYPE"          TOINSTANCE="SRT_BY_ACCOUNT" TOINSTANCETYPE="Sorter" TOFIELD="TXN_TYPE"/>
        <CONNECTOR FROMINSTANCE="EXP_RISK_FLAGS" FROMINSTANCETYPE="Expression" FROMFIELD="TXN_TYPE_DESC"     TOINSTANCE="SRT_BY_ACCOUNT" TOINSTANCETYPE="Sorter" TOFIELD="TXN_TYPE_DESC"/>
        <CONNECTOR FROMINSTANCE="EXP_RISK_FLAGS" FROMINSTANCETYPE="Expression" FROMFIELD="TXN_AMOUNT"        TOINSTANCE="SRT_BY_ACCOUNT" TOINSTANCETYPE="Sorter" TOFIELD="TXN_AMOUNT"/>
        <CONNECTOR FROMINSTANCE="EXP_RISK_FLAGS" FROMINSTANCETYPE="Expression" FROMFIELD="TXN_AMOUNT_USD"    TOINSTANCE="SRT_BY_ACCOUNT" TOINSTANCETYPE="Sorter" TOFIELD="TXN_AMOUNT_USD"/>
        <CONNECTOR FROMINSTANCE="EXP_RISK_FLAGS" FROMINSTANCETYPE="Expression" FROMFIELD="MANAGEMENT_FEE_AMT" TOINSTANCE="SRT_BY_ACCOUNT" TOINSTANCETYPE="Sorter" TOFIELD="MANAGEMENT_FEE_AMT"/>
        <CONNECTOR FROMINSTANCE="EXP_RISK_FLAGS" FROMINSTANCETYPE="Expression" FROMFIELD="CURRENCY"          TOINSTANCE="SRT_BY_ACCOUNT" TOINSTANCETYPE="Sorter" TOFIELD="CURRENCY"/>
        <CONNECTOR FROMINSTANCE="EXP_RISK_FLAGS" FROMINSTANCETYPE="Expression" FROMFIELD="UNITS"             TOINSTANCE="SRT_BY_ACCOUNT" TOINSTANCETYPE="Sorter" TOFIELD="UNITS"/>
        <CONNECTOR FROMINSTANCE="EXP_RISK_FLAGS" FROMINSTANCETYPE="Expression" FROMFIELD="TXN_STATUS"        TOINSTANCE="SRT_BY_ACCOUNT" TOINSTANCETYPE="Sorter" TOFIELD="TXN_STATUS"/>
        <CONNECTOR FROMINSTANCE="EXP_RISK_FLAGS" FROMINSTANCETYPE="Expression" FROMFIELD="PLATFORM"          TOINSTANCE="SRT_BY_ACCOUNT" TOINSTANCETYPE="Sorter" TOFIELD="PLATFORM"/>
        <CONNECTOR FROMINSTANCE="EXP_RISK_FLAGS" FROMINSTANCETYPE="Expression" FROMFIELD="IS_HIGH_RISK"      TOINSTANCE="SRT_BY_ACCOUNT" TOINSTANCETYPE="Sorter" TOFIELD="IS_HIGH_RISK"/>
        <CONNECTOR FROMINSTANCE="EXP_RISK_FLAGS" FROMINSTANCETYPE="Expression" FROMFIELD="REJECT_REASON"     TOINSTANCE="SRT_BY_ACCOUNT" TOINSTANCETYPE="Sorter" TOFIELD="REJECT_REASON"/>

        <CONNECTOR FROMINSTANCE="SRT_BY_ACCOUNT" FROMINSTANCETYPE="Sorter" FROMFIELD="TXN_ID"          TOINSTANCE="RTR_TXN_ROUTING" TOINSTANCETYPE="Router" TOFIELD="TXN_ID"/>
        <CONNECTOR FROMINSTANCE="SRT_BY_ACCOUNT" FROMINSTANCETYPE="Sorter" FROMFIELD="ACCOUNT_ID"      TOINSTANCE="RTR_TXN_ROUTING" TOINSTANCETYPE="Router" TOFIELD="ACCOUNT_ID"/>
        <CONNECTOR FROMINSTANCE="SRT_BY_ACCOUNT" FROMINSTANCETYPE="Sorter" FROMFIELD="ACCOUNT_TYPE"    TOINSTANCE="RTR_TXN_ROUTING" TOINSTANCETYPE="Router" TOFIELD="ACCOUNT_TYPE"/>
        <CONNECTOR FROMINSTANCE="SRT_BY_ACCOUNT" FROMINSTANCETYPE="Sorter" FROMFIELD="RISK_RATING"     TOINSTANCE="RTR_TXN_ROUTING" TOINSTANCETYPE="Router" TOFIELD="RISK_RATING"/>
        <CONNECTOR FROMINSTANCE="SRT_BY_ACCOUNT" FROMINSTANCETYPE="Sorter" FROMFIELD="PRODUCT_ID"      TOINSTANCE="RTR_TXN_ROUTING" TOINSTANCETYPE="Router" TOFIELD="PRODUCT_ID"/>
        <CONNECTOR FROMINSTANCE="SRT_BY_ACCOUNT" FROMINSTANCETYPE="Sorter" FROMFIELD="ASSET_CLASS"     TOINSTANCE="RTR_TXN_ROUTING" TOINSTANCETYPE="Router" TOFIELD="ASSET_CLASS"/>
        <CONNECTOR FROMINSTANCE="SRT_BY_ACCOUNT" FROMINSTANCETYPE="Sorter" FROMFIELD="RISK_CATEGORY"   TOINSTANCE="RTR_TXN_ROUTING" TOINSTANCETYPE="Router" TOFIELD="RISK_CATEGORY"/>
        <CONNECTOR FROMINSTANCE="SRT_BY_ACCOUNT" FROMINSTANCETYPE="Sorter" FROMFIELD="TXN_DATE"        TOINSTANCE="RTR_TXN_ROUTING" TOINSTANCETYPE="Router" TOFIELD="TXN_DATE"/>
        <CONNECTOR FROMINSTANCE="SRT_BY_ACCOUNT" FROMINSTANCETYPE="Sorter" FROMFIELD="TXN_YEAR_MONTH"  TOINSTANCE="RTR_TXN_ROUTING" TOINSTANCETYPE="Router" TOFIELD="TXN_YEAR_MONTH"/>
        <CONNECTOR FROMINSTANCE="SRT_BY_ACCOUNT" FROMINSTANCETYPE="Sorter" FROMFIELD="TXN_TYPE"        TOINSTANCE="RTR_TXN_ROUTING" TOINSTANCETYPE="Router" TOFIELD="TXN_TYPE"/>
        <CONNECTOR FROMINSTANCE="SRT_BY_ACCOUNT" FROMINSTANCETYPE="Sorter" FROMFIELD="TXN_TYPE_DESC"   TOINSTANCE="RTR_TXN_ROUTING" TOINSTANCETYPE="Router" TOFIELD="TXN_TYPE_DESC"/>
        <CONNECTOR FROMINSTANCE="SRT_BY_ACCOUNT" FROMINSTANCETYPE="Sorter" FROMFIELD="TXN_AMOUNT"      TOINSTANCE="RTR_TXN_ROUTING" TOINSTANCETYPE="Router" TOFIELD="TXN_AMOUNT"/>
        <CONNECTOR FROMINSTANCE="SRT_BY_ACCOUNT" FROMINSTANCETYPE="Sorter" FROMFIELD="TXN_AMOUNT_USD"  TOINSTANCE="RTR_TXN_ROUTING" TOINSTANCETYPE="Router" TOFIELD="TXN_AMOUNT_USD"/>
        <CONNECTOR FROMINSTANCE="SRT_BY_ACCOUNT" FROMINSTANCETYPE="Sorter" FROMFIELD="MANAGEMENT_FEE_AMT" TOINSTANCE="RTR_TXN_ROUTING" TOINSTANCETYPE="Router" TOFIELD="MANAGEMENT_FEE_AMT"/>
        <CONNECTOR FROMINSTANCE="SRT_BY_ACCOUNT" FROMINSTANCETYPE="Sorter" FROMFIELD="CURRENCY"        TOINSTANCE="RTR_TXN_ROUTING" TOINSTANCETYPE="Router" TOFIELD="CURRENCY"/>
        <CONNECTOR FROMINSTANCE="SRT_BY_ACCOUNT" FROMINSTANCETYPE="Sorter" FROMFIELD="UNITS"           TOINSTANCE="RTR_TXN_ROUTING" TOINSTANCETYPE="Router" TOFIELD="UNITS"/>
        <CONNECTOR FROMINSTANCE="SRT_BY_ACCOUNT" FROMINSTANCETYPE="Sorter" FROMFIELD="TXN_STATUS"      TOINSTANCE="RTR_TXN_ROUTING" TOINSTANCETYPE="Router" TOFIELD="TXN_STATUS"/>
        <CONNECTOR FROMINSTANCE="SRT_BY_ACCOUNT" FROMINSTANCETYPE="Sorter" FROMFIELD="PLATFORM"        TOINSTANCE="RTR_TXN_ROUTING" TOINSTANCETYPE="Router" TOFIELD="PLATFORM"/>
        <CONNECTOR FROMINSTANCE="SRT_BY_ACCOUNT" FROMINSTANCETYPE="Sorter" FROMFIELD="IS_HIGH_RISK"    TOINSTANCE="RTR_TXN_ROUTING" TOINSTANCETYPE="Router" TOFIELD="IS_HIGH_RISK"/>
        <CONNECTOR FROMINSTANCE="SRT_BY_ACCOUNT" FROMINSTANCETYPE="Sorter" FROMFIELD="REJECT_REASON"   TOINSTANCE="RTR_TXN_ROUTING" TOINSTANCETYPE="Router" TOFIELD="REJECT_REASON"/>

        <!-- Router VALID + HIGH_RISK → UPD_INSERT + SEQ → Target -->
        <CONNECTOR FROMINSTANCE="RTR_TXN_ROUTING" FROMINSTANCETYPE="Router" FROMFIELD="TXN_ID"          TOINSTANCE="UPD_INSERT_STRATEGY" TOINSTANCETYPE="Update Strategy" TOFIELD="TXN_ID"/>
        <CONNECTOR FROMINSTANCE="RTR_TXN_ROUTING" FROMINSTANCETYPE="Router" FROMFIELD="ACCOUNT_ID"      TOINSTANCE="UPD_INSERT_STRATEGY" TOINSTANCETYPE="Update Strategy" TOFIELD="ACCOUNT_ID"/>
        <CONNECTOR FROMINSTANCE="RTR_TXN_ROUTING" FROMINSTANCETYPE="Router" FROMFIELD="ACCOUNT_TYPE"    TOINSTANCE="UPD_INSERT_STRATEGY" TOINSTANCETYPE="Update Strategy" TOFIELD="ACCOUNT_TYPE"/>
        <CONNECTOR FROMINSTANCE="RTR_TXN_ROUTING" FROMINSTANCETYPE="Router" FROMFIELD="RISK_RATING"     TOINSTANCE="UPD_INSERT_STRATEGY" TOINSTANCETYPE="Update Strategy" TOFIELD="RISK_RATING"/>
        <CONNECTOR FROMINSTANCE="RTR_TXN_ROUTING" FROMINSTANCETYPE="Router" FROMFIELD="PRODUCT_ID"      TOINSTANCE="UPD_INSERT_STRATEGY" TOINSTANCETYPE="Update Strategy" TOFIELD="PRODUCT_ID"/>
        <CONNECTOR FROMINSTANCE="RTR_TXN_ROUTING" FROMINSTANCETYPE="Router" FROMFIELD="ASSET_CLASS"     TOINSTANCE="UPD_INSERT_STRATEGY" TOINSTANCETYPE="Update Strategy" TOFIELD="ASSET_CLASS"/>
        <CONNECTOR FROMINSTANCE="RTR_TXN_ROUTING" FROMINSTANCETYPE="Router" FROMFIELD="RISK_CATEGORY"   TOINSTANCE="UPD_INSERT_STRATEGY" TOINSTANCETYPE="Update Strategy" TOFIELD="RISK_CATEGORY"/>
        <CONNECTOR FROMINSTANCE="RTR_TXN_ROUTING" FROMINSTANCETYPE="Router" FROMFIELD="TXN_DATE"        TOINSTANCE="UPD_INSERT_STRATEGY" TOINSTANCETYPE="Update Strategy" TOFIELD="TXN_DATE"/>
        <CONNECTOR FROMINSTANCE="RTR_TXN_ROUTING" FROMINSTANCETYPE="Router" FROMFIELD="TXN_YEAR_MONTH"  TOINSTANCE="UPD_INSERT_STRATEGY" TOINSTANCETYPE="Update Strategy" TOFIELD="TXN_YEAR_MONTH"/>
        <CONNECTOR FROMINSTANCE="RTR_TXN_ROUTING" FROMINSTANCETYPE="Router" FROMFIELD="TXN_TYPE"        TOINSTANCE="UPD_INSERT_STRATEGY" TOINSTANCETYPE="Update Strategy" TOFIELD="TXN_TYPE"/>
        <CONNECTOR FROMINSTANCE="RTR_TXN_ROUTING" FROMINSTANCETYPE="Router" FROMFIELD="TXN_TYPE_DESC"   TOINSTANCE="UPD_INSERT_STRATEGY" TOINSTANCETYPE="Update Strategy" TOFIELD="TXN_TYPE_DESC"/>
        <CONNECTOR FROMINSTANCE="RTR_TXN_ROUTING" FROMINSTANCETYPE="Router" FROMFIELD="TXN_AMOUNT"      TOINSTANCE="UPD_INSERT_STRATEGY" TOINSTANCETYPE="Update Strategy" TOFIELD="TXN_AMOUNT_LOCAL"/>
        <CONNECTOR FROMINSTANCE="RTR_TXN_ROUTING" FROMINSTANCETYPE="Router" FROMFIELD="TXN_AMOUNT_USD"  TOINSTANCE="UPD_INSERT_STRATEGY" TOINSTANCETYPE="Update Strategy" TOFIELD="TXN_AMOUNT_USD"/>
        <CONNECTOR FROMINSTANCE="RTR_TXN_ROUTING" FROMINSTANCETYPE="Router" FROMFIELD="MANAGEMENT_FEE_AMT" TOINSTANCE="UPD_INSERT_STRATEGY" TOINSTANCETYPE="Update Strategy" TOFIELD="MANAGEMENT_FEE_AMT"/>
        <CONNECTOR FROMINSTANCE="RTR_TXN_ROUTING" FROMINSTANCETYPE="Router" FROMFIELD="CURRENCY"        TOINSTANCE="UPD_INSERT_STRATEGY" TOINSTANCETYPE="Update Strategy" TOFIELD="CURRENCY"/>
        <CONNECTOR FROMINSTANCE="RTR_TXN_ROUTING" FROMINSTANCETYPE="Router" FROMFIELD="UNITS"           TOINSTANCE="UPD_INSERT_STRATEGY" TOINSTANCETYPE="Update Strategy" TOFIELD="UNITS"/>
        <CONNECTOR FROMINSTANCE="RTR_TXN_ROUTING" FROMINSTANCETYPE="Router" FROMFIELD="TXN_STATUS"      TOINSTANCE="UPD_INSERT_STRATEGY" TOINSTANCETYPE="Update Strategy" TOFIELD="TXN_STATUS"/>
        <CONNECTOR FROMINSTANCE="RTR_TXN_ROUTING" FROMINSTANCETYPE="Router" FROMFIELD="PLATFORM"        TOINSTANCE="UPD_INSERT_STRATEGY" TOINSTANCETYPE="Update Strategy" TOFIELD="PLATFORM"/>
        <CONNECTOR FROMINSTANCE="RTR_TXN_ROUTING" FROMINSTANCETYPE="Router" FROMFIELD="IS_HIGH_RISK"    TOINSTANCE="UPD_INSERT_STRATEGY" TOINSTANCETYPE="Update Strategy" TOFIELD="IS_HIGH_RISK"/>
        <CONNECTOR FROMINSTANCE="SEQ_TXN_KEY"     FROMINSTANCETYPE="Sequence Generator" FROMFIELD="NEXTVAL" TOINSTANCE="UPD_INSERT_STRATEGY" TOINSTANCETYPE="Update Strategy" TOFIELD="TXN_KEY"/>

        <!-- Router REJECT → UPD_REJECT_STRATEGY → Rejects target -->
        <CONNECTOR FROMINSTANCE="RTR_TXN_ROUTING" FROMINSTANCETYPE="Router" FROMFIELD="TXN_ID"        TOINSTANCE="UPD_REJECT_STRATEGY" TOINSTANCETYPE="Update Strategy" TOFIELD="TXN_ID"/>
        <CONNECTOR FROMINSTANCE="RTR_TXN_ROUTING" FROMINSTANCETYPE="Router" FROMFIELD="REJECT_REASON" TOINSTANCE="UPD_REJECT_STRATEGY" TOINSTANCETYPE="Update Strategy" TOFIELD="REJECT_REASON"/>
        <CONNECTOR FROMINSTANCE="RTR_TXN_ROUTING" FROMINSTANCETYPE="Router" FROMFIELD="TXN_DATE"      TOINSTANCE="UPD_REJECT_STRATEGY" TOINSTANCETYPE="Update Strategy" TOFIELD="TXN_DATE"/>

        <!-- UPD_INSERT → FACT_TRANSACTIONS target -->
        <CONNECTOR FROMINSTANCE="UPD_INSERT_STRATEGY" FROMINSTANCETYPE="Update Strategy" FROMFIELD="TXN_KEY"          TOINSTANCE="FACT_TRANSACTIONS" TOINSTANCETYPE="Target Definition" TOFIELD="TXN_KEY"/>
        <CONNECTOR FROMINSTANCE="UPD_INSERT_STRATEGY" FROMINSTANCETYPE="Update Strategy" FROMFIELD="ACCOUNT_ID"       TOINSTANCE="FACT_TRANSACTIONS" TOINSTANCETYPE="Target Definition" TOFIELD="ACCOUNT_KEY"/>
        <CONNECTOR FROMINSTANCE="UPD_INSERT_STRATEGY" FROMINSTANCETYPE="Update Strategy" FROMFIELD="PRODUCT_ID"       TOINSTANCE="FACT_TRANSACTIONS" TOINSTANCETYPE="Target Definition" TOFIELD="PRODUCT_KEY"/>
        <CONNECTOR FROMINSTANCE="UPD_INSERT_STRATEGY" FROMINSTANCETYPE="Update Strategy" FROMFIELD="TXN_DATE"         TOINSTANCE="FACT_TRANSACTIONS" TOINSTANCETYPE="Target Definition" TOFIELD="TXN_DATE"/>
        <CONNECTOR FROMINSTANCE="UPD_INSERT_STRATEGY" FROMINSTANCETYPE="Update Strategy" FROMFIELD="TXN_YEAR_MONTH"   TOINSTANCE="FACT_TRANSACTIONS" TOINSTANCETYPE="Target Definition" TOFIELD="TXN_YEAR_MONTH"/>
        <CONNECTOR FROMINSTANCE="UPD_INSERT_STRATEGY" FROMINSTANCETYPE="Update Strategy" FROMFIELD="TXN_TYPE"         TOINSTANCE="FACT_TRANSACTIONS" TOINSTANCETYPE="Target Definition" TOFIELD="TXN_TYPE"/>
        <CONNECTOR FROMINSTANCE="UPD_INSERT_STRATEGY" FROMINSTANCETYPE="Update Strategy" FROMFIELD="TXN_TYPE_DESC"    TOINSTANCE="FACT_TRANSACTIONS" TOINSTANCETYPE="Target Definition" TOFIELD="TXN_TYPE_DESC"/>
        <CONNECTOR FROMINSTANCE="UPD_INSERT_STRATEGY" FROMINSTANCETYPE="Update Strategy" FROMFIELD="TXN_AMOUNT_LOCAL" TOINSTANCE="FACT_TRANSACTIONS" TOINSTANCETYPE="Target Definition" TOFIELD="TXN_AMOUNT_LOCAL"/>
        <CONNECTOR FROMINSTANCE="UPD_INSERT_STRATEGY" FROMINSTANCETYPE="Update Strategy" FROMFIELD="TXN_AMOUNT_USD"   TOINSTANCE="FACT_TRANSACTIONS" TOINSTANCETYPE="Target Definition" TOFIELD="TXN_AMOUNT_USD"/>
        <CONNECTOR FROMINSTANCE="UPD_INSERT_STRATEGY" FROMINSTANCETYPE="Update Strategy" FROMFIELD="MANAGEMENT_FEE_AMT" TOINSTANCE="FACT_TRANSACTIONS" TOINSTANCETYPE="Target Definition" TOFIELD="MANAGEMENT_FEE_AMT"/>
        <CONNECTOR FROMINSTANCE="UPD_INSERT_STRATEGY" FROMINSTANCETYPE="Update Strategy" FROMFIELD="UNITS"            TOINSTANCE="FACT_TRANSACTIONS" TOINSTANCETYPE="Target Definition" TOFIELD="UNITS"/>
        <CONNECTOR FROMINSTANCE="UPD_INSERT_STRATEGY" FROMINSTANCETYPE="Update Strategy" FROMFIELD="CURRENCY"         TOINSTANCE="FACT_TRANSACTIONS" TOINSTANCETYPE="Target Definition" TOFIELD="CURRENCY"/>
        <CONNECTOR FROMINSTANCE="UPD_INSERT_STRATEGY" FROMINSTANCETYPE="Update Strategy" FROMFIELD="ACCOUNT_TYPE"     TOINSTANCE="FACT_TRANSACTIONS" TOINSTANCETYPE="Target Definition" TOFIELD="ACCOUNT_TYPE"/>
        <CONNECTOR FROMINSTANCE="UPD_INSERT_STRATEGY" FROMINSTANCETYPE="Update Strategy" FROMFIELD="RISK_RATING"      TOINSTANCE="FACT_TRANSACTIONS" TOINSTANCETYPE="Target Definition" TOFIELD="RISK_RATING"/>
        <CONNECTOR FROMINSTANCE="UPD_INSERT_STRATEGY" FROMINSTANCETYPE="Update Strategy" FROMFIELD="ASSET_CLASS"      TOINSTANCE="FACT_TRANSACTIONS" TOINSTANCETYPE="Target Definition" TOFIELD="ASSET_CLASS"/>
        <CONNECTOR FROMINSTANCE="UPD_INSERT_STRATEGY" FROMINSTANCETYPE="Update Strategy" FROMFIELD="RISK_CATEGORY"    TOINSTANCE="FACT_TRANSACTIONS" TOINSTANCETYPE="Target Definition" TOFIELD="RISK_CATEGORY"/>
        <CONNECTOR FROMINSTANCE="UPD_INSERT_STRATEGY" FROMINSTANCETYPE="Update Strategy" FROMFIELD="IS_HIGH_RISK"     TOINSTANCE="FACT_TRANSACTIONS" TOINSTANCETYPE="Target Definition" TOFIELD="IS_HIGH_RISK"/>
        <CONNECTOR FROMINSTANCE="UPD_INSERT_STRATEGY" FROMINSTANCETYPE="Update Strategy" FROMFIELD="PLATFORM"         TOINSTANCE="FACT_TRANSACTIONS" TOINSTANCETYPE="Target Definition" TOFIELD="PLATFORM"/>
        <CONNECTOR FROMINSTANCE="UPD_INSERT_STRATEGY" FROMINSTANCETYPE="Update Strategy" FROMFIELD="TXN_STATUS"       TOINSTANCE="FACT_TRANSACTIONS" TOINSTANCETYPE="Target Definition" TOFIELD="TXN_STATUS"/>

        <!-- UPD_REJECT → FACT_TXN_REJECTS target -->
        <CONNECTOR FROMINSTANCE="UPD_REJECT_STRATEGY" FROMINSTANCETYPE="Update Strategy" FROMFIELD="TXN_ID"        TOINSTANCE="FACT_TXN_REJECTS" TOINSTANCETYPE="Target Definition" TOFIELD="TXN_ID"/>
        <CONNECTOR FROMINSTANCE="UPD_REJECT_STRATEGY" FROMINSTANCETYPE="Update Strategy" FROMFIELD="REJECT_REASON" TOINSTANCE="FACT_TXN_REJECTS" TOINSTANCETYPE="Target Definition" TOFIELD="REJECT_REASON"/>
        <CONNECTOR FROMINSTANCE="UPD_REJECT_STRATEGY" FROMINSTANCETYPE="Update Strategy" FROMFIELD="TXN_DATE"      TOINSTANCE="FACT_TXN_REJECTS" TOINSTANCETYPE="Target Definition" TOFIELD="REJECT_DT"/>

        <!-- Mapping parameters -->
        <MAPPINGVARIABLE NAME="$$BATCH_DATE" DATATYPE="String" DEFAULTVALUE="2026-01-01"
                         DESCRIPTION="Processing batch date — injected at runtime via parameter file. Format: YYYY-MM-DD"/>

      </MAPPING>
    </FOLDER>
  </REPOSITORY>
</POWERMART>
