<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE POWERMART SYSTEM "powrmart.dtd">
<!--
  Mapping  : m_PAYMENT_HISTORY_NORMALIZE
  Purpose  : Unpack FNMA loan payment history from wide format (12 monthly status
             columns per row) into a normalised long format (one row per loan per month).
  Complexity: MEDIUM  →  dbt target
  Sources  :
    1. FNMA_PAYMENT_HISTORY.csv  — monthly delivery extract, comma-delimited with header.
       Each row = 1 loan × reporting period, with columns PAY_STATUS_M01…PAY_STATUS_M12
       representing the payment status for each of the prior 12 months.
  Transformations:
    SQ_PAYMENT_HISTORY → NRM_MONTHLY_STATUS → EXP_DERIVE → FIL_VALID →
      TGT_FACT_LOAN_PAYMENT_HISTORY
  Key pattern — NORMALIZER:
    The Normalizer reads the 12 PAY_STATUS_Mnn columns as a repeating group and
    emits one output row per occurrence (12 rows per input row). The GK port provides
    the occurrence index (1-12) which is translated to the calendar month.
  Target   : FACT_LOAN_PAYMENT_HISTORY (Snowflake)
-->
<POWERMART CREATION_DATE="02/15/2026 10:00:00" REPOSITORY_VERSION="186.94">
<REPOSITORY NAME="MORTGAGE_DW" VERSION="186.94" CODEPAGE="UTF-8" DATABASETYPE="Oracle">

<FOLDER NAME="FNMA_DELIVERY" GROUP="" DESCRIPTION="Fannie Mae payment history normalizer" PERMISSIONS="rwx---r--" SHARED="SHARED">

<!-- ═══════════════════════════════════════════════════════════
     SOURCE DEFINITION
═══════════════════════════════════════════════════════════ -->

<SOURCE BUSINESSNAME="FNMA Payment History Wide File"
        DATABASETYPE="FLAT FILE"
        DBDNAME=""
        DESCRIPTION="Monthly FNMA payment history extract in wide format. Each row contains the loan identifier, reporting period, and 12 columns (PAY_STATUS_M01 through PAY_STATUS_M12) representing the payment performance code for each of the 12 months prior to the reporting period. Codes: 0=Current, 1-9=Months DPD, X=Unknown, B=No Payment Due."
        NAME="FNMA_PAYMENT_HISTORY"
        OBJECTVERSION="1"
        OWNERNAME=""
        VERSIONNUMBER="1">
  <TABLEATTRIBUTE NAME="File Type" VALUE="Delimited"/>
  <TABLEATTRIBUTE NAME="Delimiter" VALUE=","/>
  <TABLEATTRIBUTE NAME="Row Delimiter" VALUE="LF"/>
  <TABLEATTRIBUTE NAME="Quote Character" VALUE="Double Quote"/>
  <TABLEATTRIBUTE NAME="Skip Rows" VALUE="1"/>
  <TABLEATTRIBUTE NAME="Import Column Names" VALUE="YES"/>
  <TABLEATTRIBUTE NAME="Code Page" VALUE="UTF-8"/>
  <SOURCEFIELD BUSINESSNAME="" DATATYPE="string" DESCRIPTION="FNMA 13-digit loan identifier" FIELDNUMBER="1"  FIELDPROPERTY="0" LENGTH="13" NAME="LOAN_IDENTIFIER"  NULLABLE="NOTNULL" PRECISION="13" SCALE="0"/>
  <SOURCEFIELD BUSINESSNAME="" DATATYPE="string" DESCRIPTION="Reporting period YYYYMM (the anchor month)" FIELDNUMBER="2"  FIELDPROPERTY="0" LENGTH="6"  NAME="REPORTING_PERIOD" NULLABLE="NOTNULL" PRECISION="6"  SCALE="0"/>
  <SOURCEFIELD BUSINESSNAME="" DATATYPE="string" DESCRIPTION="Servicer NMLS ID" FIELDNUMBER="3"  FIELDPROPERTY="0" LENGTH="12" NAME="SERVICER_ID"       NULLABLE="NULLABLE" PRECISION="12" SCALE="0"/>
  <SOURCEFIELD BUSINESSNAME="" DATATYPE="decimal" DESCRIPTION="Current unpaid principal balance" FIELDNUMBER="4"  FIELDPROPERTY="0" LENGTH="12" NAME="CURRENT_UPB"       NULLABLE="NOTNULL" PRECISION="12" SCALE="2"/>
  <SOURCEFIELD BUSINESSNAME="" DATATYPE="string" DESCRIPTION="Payment status 1 month prior to reporting period (most recent)" FIELDNUMBER="5"  FIELDPROPERTY="0" LENGTH="2"  NAME="PAY_STATUS_M01"   NULLABLE="NULLABLE" PRECISION="2"  SCALE="0"/>
  <SOURCEFIELD BUSINESSNAME="" DATATYPE="string" DESCRIPTION="Payment status 2 months prior to reporting period" FIELDNUMBER="6"  FIELDPROPERTY="0" LENGTH="2"  NAME="PAY_STATUS_M02"   NULLABLE="NULLABLE" PRECISION="2"  SCALE="0"/>
  <SOURCEFIELD BUSINESSNAME="" DATATYPE="string" DESCRIPTION="Payment status 3 months prior" FIELDNUMBER="7"  FIELDPROPERTY="0" LENGTH="2"  NAME="PAY_STATUS_M03"   NULLABLE="NULLABLE" PRECISION="2"  SCALE="0"/>
  <SOURCEFIELD BUSINESSNAME="" DATATYPE="string" DESCRIPTION="Payment status 4 months prior" FIELDNUMBER="8"  FIELDPROPERTY="0" LENGTH="2"  NAME="PAY_STATUS_M04"   NULLABLE="NULLABLE" PRECISION="2"  SCALE="0"/>
  <SOURCEFIELD BUSINESSNAME="" DATATYPE="string" DESCRIPTION="Payment status 5 months prior" FIELDNUMBER="9"  FIELDPROPERTY="0" LENGTH="2"  NAME="PAY_STATUS_M05"   NULLABLE="NULLABLE" PRECISION="2"  SCALE="0"/>
  <SOURCEFIELD BUSINESSNAME="" DATATYPE="string" DESCRIPTION="Payment status 6 months prior" FIELDNUMBER="10" FIELDPROPERTY="0" LENGTH="2"  NAME="PAY_STATUS_M06"   NULLABLE="NULLABLE" PRECISION="2"  SCALE="0"/>
  <SOURCEFIELD BUSINESSNAME="" DATATYPE="string" DESCRIPTION="Payment status 7 months prior" FIELDNUMBER="11" FIELDPROPERTY="0" LENGTH="2"  NAME="PAY_STATUS_M07"   NULLABLE="NULLABLE" PRECISION="2"  SCALE="0"/>
  <SOURCEFIELD BUSINESSNAME="" DATATYPE="string" DESCRIPTION="Payment status 8 months prior" FIELDNUMBER="12" FIELDPROPERTY="0" LENGTH="2"  NAME="PAY_STATUS_M08"   NULLABLE="NULLABLE" PRECISION="2"  SCALE="0"/>
  <SOURCEFIELD BUSINESSNAME="" DATATYPE="string" DESCRIPTION="Payment status 9 months prior" FIELDNUMBER="13" FIELDPROPERTY="0" LENGTH="2"  NAME="PAY_STATUS_M09"   NULLABLE="NULLABLE" PRECISION="2"  SCALE="0"/>
  <SOURCEFIELD BUSINESSNAME="" DATATYPE="string" DESCRIPTION="Payment status 10 months prior" FIELDNUMBER="14" FIELDPROPERTY="0" LENGTH="2"  NAME="PAY_STATUS_M10"   NULLABLE="NULLABLE" PRECISION="2"  SCALE="0"/>
  <SOURCEFIELD BUSINESSNAME="" DATATYPE="string" DESCRIPTION="Payment status 11 months prior" FIELDNUMBER="15" FIELDPROPERTY="0" LENGTH="2"  NAME="PAY_STATUS_M11"   NULLABLE="NULLABLE" PRECISION="2"  SCALE="0"/>
  <SOURCEFIELD BUSINESSNAME="" DATATYPE="string" DESCRIPTION="Payment status 12 months prior (oldest)" FIELDNUMBER="16" FIELDPROPERTY="0" LENGTH="2"  NAME="PAY_STATUS_M12"   NULLABLE="NULLABLE" PRECISION="2"  SCALE="0"/>
</SOURCE>

<!-- ═══════════════════════════════════════════════════════════
     TARGET DEFINITION
═══════════════════════════════════════════════════════════ -->

<TARGET BUSINESSNAME="Loan Payment History Fact (Long Format)"
        CONSTRAINT=""
        DATABASETYPE="Snowflake"
        DESCRIPTION="Normalised payment history: one row per loan per calendar month. PAYMENT_MONTH is the actual calendar YYYYMM derived from REPORTING_PERIOD minus the occurrence offset. MONTHS_PRIOR indicates how many months before the reporting period this row represents (1=most recent)."
        NAME="FACT_LOAN_PAYMENT_HISTORY"
        OBJECTVERSION="1"
        TABLEOPTIONS=""
        VERSIONNUMBER="1">
  <TARGETFIELD BUSINESSNAME="" DATATYPE="integer" DESCRIPTION="Surrogate key" FIELDNUMBER="1"  KEYTYPE="PRIMARY KEY" LENGTH="10" NAME="PAYMENT_HIST_KEY"  NULLABLE="NOTNULL" PRECISION="10" SCALE="0"/>
  <TARGETFIELD BUSINESSNAME="" DATATYPE="string"  FIELDNUMBER="2"  KEYTYPE="NOT A KEY" LENGTH="13" NAME="LOAN_IDENTIFIER"   NULLABLE="NOTNULL" PRECISION="13" SCALE="0"/>
  <TARGETFIELD BUSINESSNAME="" DATATYPE="string"  DESCRIPTION="The actual calendar month this payment status applies to (YYYYMM)" FIELDNUMBER="3"  KEYTYPE="NOT A KEY" LENGTH="6"  NAME="PAYMENT_MONTH"     NULLABLE="NOTNULL" PRECISION="6"  SCALE="0"/>
  <TARGETFIELD BUSINESSNAME="" DATATYPE="string"  DESCRIPTION="Anchor reporting period from which this row was derived" FIELDNUMBER="4"  KEYTYPE="NOT A KEY" LENGTH="6"  NAME="REPORTING_PERIOD"  NULLABLE="NOTNULL" PRECISION="6"  SCALE="0"/>
  <TARGETFIELD BUSINESSNAME="" DATATYPE="integer" DESCRIPTION="1=most recent month, 12=oldest month relative to reporting period" FIELDNUMBER="5"  KEYTYPE="NOT A KEY" LENGTH="2"  NAME="MONTHS_PRIOR"       NULLABLE="NOTNULL" PRECISION="2"  SCALE="0"/>
  <TARGETFIELD BUSINESSNAME="" DATATYPE="string"  DESCRIPTION="Raw payment status code from FNMA file: 0=Current, 1-9=DPD buckets, X=Unknown, B=No Payment Due" FIELDNUMBER="6"  KEYTYPE="NOT A KEY" LENGTH="2"  NAME="PAYMENT_STATUS"    NULLABLE="NULLABLE" PRECISION="2"  SCALE="0"/>
  <TARGETFIELD BUSINESSNAME="" DATATYPE="string"  DESCRIPTION="Human-readable status description" FIELDNUMBER="7"  KEYTYPE="NOT A KEY" LENGTH="30" NAME="PAYMENT_STATUS_DESC" NULLABLE="NOTNULL" PRECISION="30" SCALE="0"/>
  <TARGETFIELD BUSINESSNAME="" DATATYPE="string"  DESCRIPTION="Performance band: CURRENT, EARLY_DPD (1-2), LATE_DPD (3-5), SERIOUSLY_DPD (6+), NO_PAYMENT_DUE, UNKNOWN" FIELDNUMBER="8"  KEYTYPE="NOT A KEY" LENGTH="20" NAME="PERFORMANCE_BAND"   NULLABLE="NOTNULL" PRECISION="20" SCALE="0"/>
  <TARGETFIELD BUSINESSNAME="" DATATYPE="string"  FIELDNUMBER="9"  KEYTYPE="NOT A KEY" LENGTH="12" NAME="SERVICER_ID"        NULLABLE="NULLABLE" PRECISION="12" SCALE="0"/>
  <TARGETFIELD BUSINESSNAME="" DATATYPE="decimal" FIELDNUMBER="10" KEYTYPE="NOT A KEY" LENGTH="12" NAME="CURRENT_UPB"         NULLABLE="NOTNULL" PRECISION="12" SCALE="2"/>
  <TARGETFIELD BUSINESSNAME="" DATATYPE="timestamp" FIELDNUMBER="11" KEYTYPE="NOT A KEY" LENGTH="29" NAME="LOAD_TIMESTAMP"    NULLABLE="NOTNULL" PRECISION="29" SCALE="9"/>
</TARGET>

<!-- ═══════════════════════════════════════════════════════════
     MAPPING
═══════════════════════════════════════════════════════════ -->
<MAPPING DESCRIPTION="Reads FNMA wide payment history (12 monthly status columns per row), uses a Normalizer to pivot them into one row per month per loan, derives calendar PAYMENT_MONTH, status description, and performance band."
         ISVALID="YES"
         NAME="m_PAYMENT_HISTORY_NORMALIZE"
         OBJECTVERSION="1"
         VERSIONNUMBER="1">

  <!-- ── Source Qualifier ── -->
  <TRANSFORMATION DESCRIPTION="Read all columns from FNMA payment history flat file. No filter — all rows passed to Normalizer."
                  NAME="SQ_PAYMENT_HISTORY"
                  OBJECTVERSION="1"
                  REUSABLE="NO"
                  TYPE="Source Qualifier"
                  VERSIONNUMBER="1">
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="13" NAME="LOAN_IDENTIFIER"  PORTTYPE="INPUT/OUTPUT" PRECISION="13" SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="6"  NAME="REPORTING_PERIOD" PORTTYPE="INPUT/OUTPUT" PRECISION="6"  SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="12" NAME="SERVICER_ID"       PORTTYPE="INPUT/OUTPUT" PRECISION="12" SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="decimal" LENGTH="12" NAME="CURRENT_UPB"       PORTTYPE="INPUT/OUTPUT" PRECISION="12" SCALE="2"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="2"  NAME="PAY_STATUS_M01"   PORTTYPE="INPUT/OUTPUT" PRECISION="2"  SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="2"  NAME="PAY_STATUS_M02"   PORTTYPE="INPUT/OUTPUT" PRECISION="2"  SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="2"  NAME="PAY_STATUS_M03"   PORTTYPE="INPUT/OUTPUT" PRECISION="2"  SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="2"  NAME="PAY_STATUS_M04"   PORTTYPE="INPUT/OUTPUT" PRECISION="2"  SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="2"  NAME="PAY_STATUS_M05"   PORTTYPE="INPUT/OUTPUT" PRECISION="2"  SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="2"  NAME="PAY_STATUS_M06"   PORTTYPE="INPUT/OUTPUT" PRECISION="2"  SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="2"  NAME="PAY_STATUS_M07"   PORTTYPE="INPUT/OUTPUT" PRECISION="2"  SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="2"  NAME="PAY_STATUS_M08"   PORTTYPE="INPUT/OUTPUT" PRECISION="2"  SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="2"  NAME="PAY_STATUS_M09"   PORTTYPE="INPUT/OUTPUT" PRECISION="2"  SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="2"  NAME="PAY_STATUS_M10"   PORTTYPE="INPUT/OUTPUT" PRECISION="2"  SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="2"  NAME="PAY_STATUS_M11"   PORTTYPE="INPUT/OUTPUT" PRECISION="2"  SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="2"  NAME="PAY_STATUS_M12"   PORTTYPE="INPUT/OUTPUT" PRECISION="2"  SCALE="0"/>
  </TRANSFORMATION>

  <!-- ── Normalizer: pivot 12 monthly columns into rows ── -->
  <TRANSFORMATION DESCRIPTION="Normalizer pivots the 12 PAY_STATUS_Mnn columns (a repeating group of width=12) into individual rows. For each input row the Normalizer emits 12 output rows. The GK (Generated Key) port MONTHS_PRIOR_GK contains the occurrence index (1-12). Non-repeating ports (LOAN_IDENTIFIER, REPORTING_PERIOD, SERVICER_ID, CURRENT_UPB) are replicated unchanged across all 12 output rows."
                  NAME="NRM_MONTHLY_STATUS"
                  OBJECTVERSION="1"
                  REUSABLE="NO"
                  TYPE="Normalizer"
                  VERSIONNUMBER="1">
    <!-- Non-repeating (pass-through) ports -->
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="13" NAME="LOAN_IDENTIFIER"    PORTTYPE="INPUT/OUTPUT" PRECISION="13" SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="6"  NAME="REPORTING_PERIOD"   PORTTYPE="INPUT/OUTPUT" PRECISION="6"  SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="12" NAME="SERVICER_ID"         PORTTYPE="INPUT/OUTPUT" PRECISION="12" SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="decimal" LENGTH="12" NAME="CURRENT_UPB"         PORTTYPE="INPUT/OUTPUT" PRECISION="12" SCALE="2"/>
    <!-- Repeating group: 12 occurrences of PAY_STATUS -->
    <TRANSFORMFIELD DATATYPE="string"
                    LENGTH="2"
                    NAME="PAY_STATUS"
                    PORTTYPE="INPUT/OUTPUT"
                    PRECISION="2"
                    SCALE="0"
                    OCCURSTIMES="12"
                    DESCRIPTION="Repeating group — one occurrence per month (M01 through M12). Normalizer emits one output row per occurrence."/>
    <!-- GK (Generated Key) port — occurrence index 1-12 -->
    <TRANSFORMFIELD DATATYPE="integer"
                    LENGTH="2"
                    NAME="MONTHS_PRIOR_GK"
                    PORTTYPE="OUTPUT"
                    PRECISION="2"
                    SCALE="0"
                    DESCRIPTION="System-generated occurrence index: 1 = PAY_STATUS_M01 (most recent), 12 = PAY_STATUS_M12 (oldest). Used to derive PAYMENT_MONTH."/>
    <TABLEATTRIBUTE NAME="Occurrence" VALUE="12"/>
  </TRANSFORMATION>

  <!-- ── Expression: derive PAYMENT_MONTH, descriptions, performance band ── -->
  <TRANSFORMATION DESCRIPTION="Post-normalizer derivations: (1) PAYMENT_MONTH = subtract MONTHS_PRIOR_GK months from REPORTING_PERIOD to get the actual calendar month. (2) Decode PAY_STATUS to a readable description. (3) Assign PERFORMANCE_BAND."
                  NAME="EXP_DERIVE"
                  OBJECTVERSION="1"
                  REUSABLE="NO"
                  TYPE="Expression"
                  VERSIONNUMBER="1">
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="13" NAME="LOAN_IDENTIFIER"   PORTTYPE="INPUT" PRECISION="13" SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="6"  NAME="REPORTING_PERIOD"  PORTTYPE="INPUT" PRECISION="6"  SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="12" NAME="SERVICER_ID"        PORTTYPE="INPUT" PRECISION="12" SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="decimal" LENGTH="12" NAME="CURRENT_UPB"        PORTTYPE="INPUT" PRECISION="12" SCALE="2"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="2"  NAME="PAY_STATUS"         PORTTYPE="INPUT" PRECISION="2"  SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="integer" LENGTH="2"  NAME="MONTHS_PRIOR_GK"    PORTTYPE="INPUT" PRECISION="2"  SCALE="0"/>

    <!-- Derive the actual calendar month this row represents -->
    <TRANSFORMFIELD DATATYPE="string"
                    DEFAULTVALUE=""
                    DESCRIPTION="Subtract MONTHS_PRIOR_GK months from REPORTING_PERIOD (parsed as YYYYMM) to get the actual calendar month this payment status applies to. Example: REPORTING_PERIOD=202401, MONTHS_PRIOR_GK=3 → PAYMENT_MONTH=202310."
                    EXPRESSION="TO_CHAR(ADD_TO_DATE(TO_DATE(REPORTING_PERIOD,'YYYYMM'),'MM', -MONTHS_PRIOR_GK),'YYYYMM')"
                    LENGTH="6"
                    NAME="PAYMENT_MONTH"
                    PORTTYPE="OUTPUT"
                    PRECISION="6"
                    SCALE="0"/>

    <!-- Pass-through MONTHS_PRIOR (renamed from GK port) -->
    <TRANSFORMFIELD DATATYPE="integer"
                    DEFAULTVALUE=""
                    DESCRIPTION="How many months before the reporting period this row represents"
                    EXPRESSION="MONTHS_PRIOR_GK"
                    LENGTH="2"
                    NAME="MONTHS_PRIOR"
                    PORTTYPE="OUTPUT"
                    PRECISION="2"
                    SCALE="0"/>

    <!-- Decode payment status code -->
    <TRANSFORMFIELD DATATYPE="string"
                    DEFAULTVALUE=""
                    DESCRIPTION="Human-readable payment status description"
                    EXPRESSION="IIF(PAY_STATUS = '0', 'Current', IIF(PAY_STATUS = '1', '30 Days Delinquent', IIF(PAY_STATUS = '2', '60 Days Delinquent', IIF(PAY_STATUS = '3', '90 Days Delinquent', IIF(PAY_STATUS = '4', '120 Days Delinquent', IIF(PAY_STATUS = '5', '150 Days Delinquent', IIF(PAY_STATUS = '6', '180+ Days Delinquent', IIF(PAY_STATUS = 'B', 'No Payment Due', IIF(PAY_STATUS = 'X', 'Unknown / Not Reported', 'Other')))))))))"
                    LENGTH="30"
                    NAME="PAYMENT_STATUS_DESC"
                    PORTTYPE="OUTPUT"
                    PRECISION="30"
                    SCALE="0"/>

    <!-- Performance band — FNMA standard delinquency groupings -->
    <TRANSFORMFIELD DATATYPE="string"
                    DEFAULTVALUE=""
                    DESCRIPTION="Aggregate performance band: CURRENT, EARLY_DPD (1-2 months), LATE_DPD (3-5 months), SERIOUSLY_DPD (6+), NO_PAYMENT_DUE, UNKNOWN"
                    EXPRESSION="IIF(PAY_STATUS = '0', 'CURRENT', IIF(PAY_STATUS IN ('1','2'), 'EARLY_DPD', IIF(PAY_STATUS IN ('3','4','5'), 'LATE_DPD', IIF(PAY_STATUS IN ('6','7','8','9'), 'SERIOUSLY_DPD', IIF(PAY_STATUS = 'B', 'NO_PAYMENT_DUE', 'UNKNOWN')))))"
                    LENGTH="20"
                    NAME="PERFORMANCE_BAND"
                    PORTTYPE="OUTPUT"
                    PRECISION="20"
                    SCALE="0"/>

    <!-- Pass-throughs -->
    <TRANSFORMFIELD DATATYPE="string"  DEFAULTVALUE="" EXPRESSION="LOAN_IDENTIFIER"  LENGTH="13" NAME="o_LOAN_IDENTIFIER"  PORTTYPE="OUTPUT" PRECISION="13" SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  DEFAULTVALUE="" EXPRESSION="REPORTING_PERIOD" LENGTH="6"  NAME="o_REPORTING_PERIOD" PORTTYPE="OUTPUT" PRECISION="6"  SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  DEFAULTVALUE="" EXPRESSION="SERVICER_ID"       LENGTH="12" NAME="o_SERVICER_ID"       PORTTYPE="OUTPUT" PRECISION="12" SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="decimal" DEFAULTVALUE="" EXPRESSION="CURRENT_UPB"        LENGTH="12" NAME="o_CURRENT_UPB"        PORTTYPE="OUTPUT" PRECISION="12" SCALE="2"/>
    <TRANSFORMFIELD DATATYPE="string"  DEFAULTVALUE="" EXPRESSION="PAY_STATUS"         LENGTH="2"  NAME="o_PAY_STATUS"         PORTTYPE="OUTPUT" PRECISION="2"  SCALE="0"/>
  </TRANSFORMATION>

  <!-- ── Filter: drop rows where PAY_STATUS is null (no history for that month) ── -->
  <TRANSFORMATION DESCRIPTION="Discard rows where PAY_STATUS is null — these represent months with no data in the FNMA file (e.g., loans that have not yet reached 12 months of history)."
                  NAME="FIL_VALID"
                  OBJECTVERSION="1"
                  REUSABLE="NO"
                  TYPE="Filter"
                  VERSIONNUMBER="1">
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="13" NAME="LOAN_IDENTIFIER"    PORTTYPE="INPUT/OUTPUT" PRECISION="13" SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="6"  NAME="PAYMENT_MONTH"      PORTTYPE="INPUT/OUTPUT" PRECISION="6"  SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="6"  NAME="REPORTING_PERIOD"   PORTTYPE="INPUT/OUTPUT" PRECISION="6"  SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="integer" LENGTH="2"  NAME="MONTHS_PRIOR"       PORTTYPE="INPUT/OUTPUT" PRECISION="2"  SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="2"  NAME="PAY_STATUS"         PORTTYPE="INPUT/OUTPUT" PRECISION="2"  SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="30" NAME="PAYMENT_STATUS_DESC" PORTTYPE="INPUT/OUTPUT" PRECISION="30" SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="20" NAME="PERFORMANCE_BAND"   PORTTYPE="INPUT/OUTPUT" PRECISION="20" SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="string"  LENGTH="12" NAME="SERVICER_ID"         PORTTYPE="INPUT/OUTPUT" PRECISION="12" SCALE="0"/>
    <TRANSFORMFIELD DATATYPE="decimal" LENGTH="12" NAME="CURRENT_UPB"         PORTTYPE="INPUT/OUTPUT" PRECISION="12" SCALE="2"/>
    <TABLEATTRIBUTE NAME="Filter Condition" VALUE="NOT ISNULL(PAY_STATUS) AND PAY_STATUS != ''"/>
  </TRANSFORMATION>

  <!-- ═══════════════════════════════════════════════════════════
       CONNECTORS
  ═══════════════════════════════════════════════════════════ -->

  <!-- SQ → NRM -->
  <CONNECTOR FROMFIELD="LOAN_IDENTIFIER"  FROMINSTANCE="SQ_PAYMENT_HISTORY" FROMINSTANCETYPE="Source Qualifier" TOFIELD="LOAN_IDENTIFIER"  TOINSTANCE="NRM_MONTHLY_STATUS" TOINSTANCETYPE="Normalizer"/>
  <CONNECTOR FROMFIELD="REPORTING_PERIOD" FROMINSTANCE="SQ_PAYMENT_HISTORY" FROMINSTANCETYPE="Source Qualifier" TOFIELD="REPORTING_PERIOD" TOINSTANCE="NRM_MONTHLY_STATUS" TOINSTANCETYPE="Normalizer"/>
  <CONNECTOR FROMFIELD="SERVICER_ID"       FROMINSTANCE="SQ_PAYMENT_HISTORY" FROMINSTANCETYPE="Source Qualifier" TOFIELD="SERVICER_ID"       TOINSTANCE="NRM_MONTHLY_STATUS" TOINSTANCETYPE="Normalizer"/>
  <CONNECTOR FROMFIELD="CURRENT_UPB"       FROMINSTANCE="SQ_PAYMENT_HISTORY" FROMINSTANCETYPE="Source Qualifier" TOFIELD="CURRENT_UPB"       TOINSTANCE="NRM_MONTHLY_STATUS" TOINSTANCETYPE="Normalizer"/>
  <CONNECTOR FROMFIELD="PAY_STATUS_M01"   FROMINSTANCE="SQ_PAYMENT_HISTORY" FROMINSTANCETYPE="Source Qualifier" TOFIELD="PAY_STATUS[1]"     TOINSTANCE="NRM_MONTHLY_STATUS" TOINSTANCETYPE="Normalizer"/>
  <CONNECTOR FROMFIELD="PAY_STATUS_M02"   FROMINSTANCE="SQ_PAYMENT_HISTORY" FROMINSTANCETYPE="Source Qualifier" TOFIELD="PAY_STATUS[2]"     TOINSTANCE="NRM_MONTHLY_STATUS" TOINSTANCETYPE="Normalizer"/>
  <CONNECTOR FROMFIELD="PAY_STATUS_M03"   FROMINSTANCE="SQ_PAYMENT_HISTORY" FROMINSTANCETYPE="Source Qualifier" TOFIELD="PAY_STATUS[3]"     TOINSTANCE="NRM_MONTHLY_STATUS" TOINSTANCETYPE="Normalizer"/>
  <CONNECTOR FROMFIELD="PAY_STATUS_M04"   FROMINSTANCE="SQ_PAYMENT_HISTORY" FROMINSTANCETYPE="Source Qualifier" TOFIELD="PAY_STATUS[4]"     TOINSTANCE="NRM_MONTHLY_STATUS" TOINSTANCETYPE="Normalizer"/>
  <CONNECTOR FROMFIELD="PAY_STATUS_M05"   FROMINSTANCE="SQ_PAYMENT_HISTORY" FROMINSTANCETYPE="Source Qualifier" TOFIELD="PAY_STATUS[5]"     TOINSTANCE="NRM_MONTHLY_STATUS" TOINSTANCETYPE="Normalizer"/>
  <CONNECTOR FROMFIELD="PAY_STATUS_M06"   FROMINSTANCE="SQ_PAYMENT_HISTORY" FROMINSTANCETYPE="Source Qualifier" TOFIELD="PAY_STATUS[6]"     TOINSTANCE="NRM_MONTHLY_STATUS" TOINSTANCETYPE="Normalizer"/>
  <CONNECTOR FROMFIELD="PAY_STATUS_M07"   FROMINSTANCE="SQ_PAYMENT_HISTORY" FROMINSTANCETYPE="Source Qualifier" TOFIELD="PAY_STATUS[7]"     TOINSTANCE="NRM_MONTHLY_STATUS" TOINSTANCETYPE="Normalizer"/>
  <CONNECTOR FROMFIELD="PAY_STATUS_M08"   FROMINSTANCE="SQ_PAYMENT_HISTORY" FROMINSTANCETYPE="Source Qualifier" TOFIELD="PAY_STATUS[8]"     TOINSTANCE="NRM_MONTHLY_STATUS" TOINSTANCETYPE="Normalizer"/>
  <CONNECTOR FROMFIELD="PAY_STATUS_M09"   FROMINSTANCE="SQ_PAYMENT_HISTORY" FROMINSTANCETYPE="Source Qualifier" TOFIELD="PAY_STATUS[9]"     TOINSTANCE="NRM_MONTHLY_STATUS" TOINSTANCETYPE="Normalizer"/>
  <CONNECTOR FROMFIELD="PAY_STATUS_M10"   FROMINSTANCE="SQ_PAYMENT_HISTORY" FROMINSTANCETYPE="Source Qualifier" TOFIELD="PAY_STATUS[10]"    TOINSTANCE="NRM_MONTHLY_STATUS" TOINSTANCETYPE="Normalizer"/>
  <CONNECTOR FROMFIELD="PAY_STATUS_M11"   FROMINSTANCE="SQ_PAYMENT_HISTORY" FROMINSTANCETYPE="Source Qualifier" TOFIELD="PAY_STATUS[11]"    TOINSTANCE="NRM_MONTHLY_STATUS" TOINSTANCETYPE="Normalizer"/>
  <CONNECTOR FROMFIELD="PAY_STATUS_M12"   FROMINSTANCE="SQ_PAYMENT_HISTORY" FROMINSTANCETYPE="Source Qualifier" TOFIELD="PAY_STATUS[12]"    TOINSTANCE="NRM_MONTHLY_STATUS" TOINSTANCETYPE="Normalizer"/>

  <!-- NRM → EXP -->
  <CONNECTOR FROMFIELD="LOAN_IDENTIFIER"  FROMINSTANCE="NRM_MONTHLY_STATUS" FROMINSTANCETYPE="Normalizer" TOFIELD="LOAN_IDENTIFIER"  TOINSTANCE="EXP_DERIVE" TOINSTANCETYPE="Expression"/>
  <CONNECTOR FROMFIELD="REPORTING_PERIOD" FROMINSTANCE="NRM_MONTHLY_STATUS" FROMINSTANCETYPE="Normalizer" TOFIELD="REPORTING_PERIOD" TOINSTANCE="EXP_DERIVE" TOINSTANCETYPE="Expression"/>
  <CONNECTOR FROMFIELD="SERVICER_ID"       FROMINSTANCE="NRM_MONTHLY_STATUS" FROMINSTANCETYPE="Normalizer" TOFIELD="SERVICER_ID"       TOINSTANCE="EXP_DERIVE" TOINSTANCETYPE="Expression"/>
  <CONNECTOR FROMFIELD="CURRENT_UPB"       FROMINSTANCE="NRM_MONTHLY_STATUS" FROMINSTANCETYPE="Normalizer" TOFIELD="CURRENT_UPB"       TOINSTANCE="EXP_DERIVE" TOINSTANCETYPE="Expression"/>
  <CONNECTOR FROMFIELD="PAY_STATUS"        FROMINSTANCE="NRM_MONTHLY_STATUS" FROMINSTANCETYPE="Normalizer" TOFIELD="PAY_STATUS"        TOINSTANCE="EXP_DERIVE" TOINSTANCETYPE="Expression"/>
  <CONNECTOR FROMFIELD="MONTHS_PRIOR_GK"  FROMINSTANCE="NRM_MONTHLY_STATUS" FROMINSTANCETYPE="Normalizer" TOFIELD="MONTHS_PRIOR_GK"  TOINSTANCE="EXP_DERIVE" TOINSTANCETYPE="Expression"/>

  <!-- EXP → FIL -->
  <CONNECTOR FROMFIELD="o_LOAN_IDENTIFIER"   FROMINSTANCE="EXP_DERIVE" FROMINSTANCETYPE="Expression" TOFIELD="LOAN_IDENTIFIER"    TOINSTANCE="FIL_VALID" TOINSTANCETYPE="Filter"/>
  <CONNECTOR FROMFIELD="PAYMENT_MONTH"        FROMINSTANCE="EXP_DERIVE" FROMINSTANCETYPE="Expression" TOFIELD="PAYMENT_MONTH"      TOINSTANCE="FIL_VALID" TOINSTANCETYPE="Filter"/>
  <CONNECTOR FROMFIELD="o_REPORTING_PERIOD"   FROMINSTANCE="EXP_DERIVE" FROMINSTANCETYPE="Expression" TOFIELD="REPORTING_PERIOD"   TOINSTANCE="FIL_VALID" TOINSTANCETYPE="Filter"/>
  <CONNECTOR FROMFIELD="MONTHS_PRIOR"         FROMINSTANCE="EXP_DERIVE" FROMINSTANCETYPE="Expression" TOFIELD="MONTHS_PRIOR"       TOINSTANCE="FIL_VALID" TOINSTANCETYPE="Filter"/>
  <CONNECTOR FROMFIELD="o_PAY_STATUS"         FROMINSTANCE="EXP_DERIVE" FROMINSTANCETYPE="Expression" TOFIELD="PAY_STATUS"         TOINSTANCE="FIL_VALID" TOINSTANCETYPE="Filter"/>
  <CONNECTOR FROMFIELD="PAYMENT_STATUS_DESC"  FROMINSTANCE="EXP_DERIVE" FROMINSTANCETYPE="Expression" TOFIELD="PAYMENT_STATUS_DESC" TOINSTANCE="FIL_VALID" TOINSTANCETYPE="Filter"/>
  <CONNECTOR FROMFIELD="PERFORMANCE_BAND"     FROMINSTANCE="EXP_DERIVE" FROMINSTANCETYPE="Expression" TOFIELD="PERFORMANCE_BAND"   TOINSTANCE="FIL_VALID" TOINSTANCETYPE="Filter"/>
  <CONNECTOR FROMFIELD="o_SERVICER_ID"        FROMINSTANCE="EXP_DERIVE" FROMINSTANCETYPE="Expression" TOFIELD="SERVICER_ID"         TOINSTANCE="FIL_VALID" TOINSTANCETYPE="Filter"/>
  <CONNECTOR FROMFIELD="o_CURRENT_UPB"        FROMINSTANCE="EXP_DERIVE" FROMINSTANCETYPE="Expression" TOFIELD="CURRENT_UPB"         TOINSTANCE="FIL_VALID" TOINSTANCETYPE="Filter"/>

  <!-- FIL → TGT -->
  <CONNECTOR FROMFIELD="LOAN_IDENTIFIER"    FROMINSTANCE="FIL_VALID" FROMINSTANCETYPE="Filter" TOFIELD="LOAN_IDENTIFIER"    TOINSTANCE="FACT_LOAN_PAYMENT_HISTORY" TOINSTANCETYPE="Target Definition"/>
  <CONNECTOR FROMFIELD="PAYMENT_MONTH"      FROMINSTANCE="FIL_VALID" FROMINSTANCETYPE="Filter" TOFIELD="PAYMENT_MONTH"      TOINSTANCE="FACT_LOAN_PAYMENT_HISTORY" TOINSTANCETYPE="Target Definition"/>
  <CONNECTOR FROMFIELD="REPORTING_PERIOD"   FROMINSTANCE="FIL_VALID" FROMINSTANCETYPE="Filter" TOFIELD="REPORTING_PERIOD"   TOINSTANCE="FACT_LOAN_PAYMENT_HISTORY" TOINSTANCETYPE="Target Definition"/>
  <CONNECTOR FROMFIELD="MONTHS_PRIOR"       FROMINSTANCE="FIL_VALID" FROMINSTANCETYPE="Filter" TOFIELD="MONTHS_PRIOR"       TOINSTANCE="FACT_LOAN_PAYMENT_HISTORY" TOINSTANCETYPE="Target Definition"/>
  <CONNECTOR FROMFIELD="PAY_STATUS"         FROMINSTANCE="FIL_VALID" FROMINSTANCETYPE="Filter" TOFIELD="PAYMENT_STATUS"     TOINSTANCE="FACT_LOAN_PAYMENT_HISTORY" TOINSTANCETYPE="Target Definition"/>
  <CONNECTOR FROMFIELD="PAYMENT_STATUS_DESC" FROMINSTANCE="FIL_VALID" FROMINSTANCETYPE="Filter" TOFIELD="PAYMENT_STATUS_DESC" TOINSTANCE="FACT_LOAN_PAYMENT_HISTORY" TOINSTANCETYPE="Target Definition"/>
  <CONNECTOR FROMFIELD="PERFORMANCE_BAND"   FROMINSTANCE="FIL_VALID" FROMINSTANCETYPE="Filter" TOFIELD="PERFORMANCE_BAND"   TOINSTANCE="FACT_LOAN_PAYMENT_HISTORY" TOINSTANCETYPE="Target Definition"/>
  <CONNECTOR FROMFIELD="SERVICER_ID"         FROMINSTANCE="FIL_VALID" FROMINSTANCETYPE="Filter" TOFIELD="SERVICER_ID"         TOINSTANCE="FACT_LOAN_PAYMENT_HISTORY" TOINSTANCETYPE="Target Definition"/>
  <CONNECTOR FROMFIELD="CURRENT_UPB"         FROMINSTANCE="FIL_VALID" FROMINSTANCETYPE="Filter" TOFIELD="CURRENT_UPB"         TOINSTANCE="FACT_LOAN_PAYMENT_HISTORY" TOINSTANCETYPE="Target Definition"/>

  <!-- ── Instance placements ── -->
  <INSTANCE NAME="SQ_PAYMENT_HISTORY"          REUSABLE="NO" TRANSFORMATION="SQ_PAYMENT_HISTORY"   TYPE="Source Qualifier" X="80"  Y="200"/>
  <INSTANCE NAME="NRM_MONTHLY_STATUS"          REUSABLE="NO" TRANSFORMATION="NRM_MONTHLY_STATUS"   TYPE="Normalizer"       X="300" Y="200"/>
  <INSTANCE NAME="EXP_DERIVE"                  REUSABLE="NO" TRANSFORMATION="EXP_DERIVE"           TYPE="Expression"       X="520" Y="200"/>
  <INSTANCE NAME="FIL_VALID"                   REUSABLE="NO" TRANSFORMATION="FIL_VALID"            TYPE="Filter"           X="720" Y="200"/>
  <INSTANCE NAME="FACT_LOAN_PAYMENT_HISTORY"   REUSABLE="NO" TRANSFORMATION="FACT_LOAN_PAYMENT_HISTORY" TYPE="Target Definition" X="940" Y="200"/>

</MAPPING>
</FOLDER>
</REPOSITORY>
</POWERMART>
