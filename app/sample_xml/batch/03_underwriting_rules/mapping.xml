<?xml version="1.0" encoding="UTF-8"?>
<!--
================================================================================
INFORMATICA POWERCENTER MAPPING EXPORT
================================================================================
Project: Mortgage Loan E2E Batch Processing - Stage 3 of 6
Mapping Name: m_LOAN_UNDERWRITING_DECISION
Complexity Level: HIGH
Technology Stack: PySpark Integration via Snowflake & Oracle

PURPOSE:
Joins enriched loan applications with property valuations and underwriting 
guidelines. Applies complex DTI (Debt-to-Income), LTV (Loan-to-Value), and 
credit score rules. Routes approved, referred, declined, and manual review 
loans to their respective target tables.

KEY PROCESSING STEPS:
1. Source Qualification: Filter enriched loan data by LOAD_DATE
2. Join loan applications with completed property appraisals (Master Outer)
3. Join loans+appraisals with latest underwriting guidelines
4. Expression: Calculate DTI, LTV, monthly payment, and rule validations
5. Router: Branch loans to 4 decision outcomes based on rule compliance

SOURCE SYSTEMS:
- Snowflake: STG_LOAN_APPLICATIONS_ENRICHED (enriched loan data)
- Oracle: PROPERTY_VALUATIONS (appraisal system)
- Oracle: UNDERWRITING_GUIDELINES (reference data)

TARGET SYSTEMS:
- Snowflake: TGT_APPROVED_LOANS
- Snowflake: TGT_REFERRED_LOANS
- Snowflake: TGT_DECLINED_LOANS
- Snowflake: TGT_MANUAL_REVIEW_LOANS

VARIABLES REFERENCED:
- $$LOAD_DATE: Current processing date
- $$SRC_CONNECTION: Snowflake source connection
- $$APPRAISAL_CONN: Oracle appraisal system connection
- $$GUIDELINES_CONN: Oracle guidelines reference connection
- $$TGT_CONNECTION: Snowflake target connection
- $$MAX_DTI_OVERRIDE: Optional DTI threshold override
- $$ENV: Environment indicator (DEV/QA/PROD)

LAST MODIFIED: 2026-03-01
AUTHOR: Data Engineering Team
VERSION: 1.0.0
================================================================================
-->

<REPOSITORY>
  <CODEPAGE>UTF-8</CODEPAGE>
  <COLLECTION OBJECTVERSION="1">
    <MAPPING OBJECTID="MAPPING_0001" NAME="m_LOAN_UNDERWRITING_DECISION" DESCRIPTION="Mortgage loan underwriting decision routing" MAPTYPE="DATAMART" ISTRANSACTIONCONTROL="N">
      
      <!-- ================================================================
           SOURCE QUALIFIERS AND SOURCE DEFINITIONS
           ================================================================ -->
      
      <!-- Source Definition: STG_LOAN_APPLICATIONS_ENRICHED -->
      <SOURCE OBJECTID="SRC_0001" NAME="STG_LOAN_APPLICATIONS_ENRICHED" DBTYPE="Snowflake" CONNECTIONNAME="$$SRC_CONNECTION">
        <DATABASEOBJECT>STG_LOAN_APPLICATIONS_ENRICHED</DATABASEOBJECT>
        <FIELD NAME="APPLICATION_ID" DATATYPE="STRING" NULLABLE="N" PRECISION="50"/>
        <FIELD NAME="BORROWER_SSN_HASH" DATATYPE="STRING" NULLABLE="N" PRECISION="64"/>
        <FIELD NAME="LOAN_AMOUNT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <FIELD NAME="LOAN_PURPOSE" DATATYPE="STRING" NULLABLE="Y" PRECISION="50"/>
        <FIELD NAME="LOAN_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
        <FIELD NAME="INTEREST_RATE" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="3"/>
        <FIELD NAME="LOAN_TERM_MONTHS" DATATYPE="INTEGER" NULLABLE="N" PRECISION="5"/>
        <FIELD NAME="DOWN_PAYMENT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <FIELD NAME="LOAN_TO_VALUE_PCT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="2"/>
        <FIELD NAME="DOWN_PAYMENT_PCT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="2"/>
        <FIELD NAME="OCCUPANCY_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
        <FIELD NAME="APPLICATION_DATE" DATATYPE="TIMESTAMP" NULLABLE="N" PRECISION="29"/>
        <FIELD NAME="LOAN_TYPE_DESC" DATATYPE="STRING" NULLABLE="Y" PRECISION="100"/>
        <FIELD NAME="IS_REFI" DATATYPE="STRING" NULLABLE="Y" PRECISION="1"/>
        <FIELD NAME="APP_MONTH" DATATYPE="STRING" NULLABLE="Y" PRECISION="10"/>
        <FIELD NAME="LOAN_OFFICER_ID" DATATYPE="STRING" NULLABLE="Y" PRECISION="20"/>
        <FIELD NAME="BRANCH_CODE" DATATYPE="STRING" NULLABLE="Y" PRECISION="10"/>
        <FIELD NAME="PROPERTY_STATE" DATATYPE="STRING" NULLABLE="Y" PRECISION="2"/>
        <FIELD NAME="BUREAU_SCORE" DATATYPE="INTEGER" NULLABLE="N" PRECISION="4"/>
        <FIELD NAME="CREDIT_TIER" DATATYPE="STRING" NULLABLE="Y" PRECISION="20"/>
        <FIELD NAME="DEROGATORY_MARKS" DATATYPE="INTEGER" NULLABLE="Y" PRECISION="5"/>
        <FIELD NAME="INQUIRIES_6MO" DATATYPE="INTEGER" NULLABLE="Y" PRECISION="5"/>
        <FIELD NAME="BANKRUPTCY_FLAG" DATATYPE="STRING" NULLABLE="Y" PRECISION="1"/>
        <FIELD NAME="FORECLOSURE_FLAG" DATATYPE="STRING" NULLABLE="Y" PRECISION="1"/>
        <FIELD NAME="ANNUAL_INCOME" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <FIELD NAME="MONTHLY_DEBT_PAYMENT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <FIELD NAME="ENRICHMENT_DATE" DATATYPE="DATE" NULLABLE="N" PRECISION="10"/>
      </SOURCE>

      <!-- Source Definition: PROPERTY_VALUATIONS -->
      <SOURCE OBJECTID="SRC_0002" NAME="PROPERTY_VALUATIONS" DBTYPE="Oracle" CONNECTIONNAME="$$APPRAISAL_CONN">
        <DATABASEOBJECT>PROPERTY_VALUATIONS</DATABASEOBJECT>
        <FIELD NAME="APPLICATION_ID" DATATYPE="STRING" NULLABLE="N" PRECISION="50"/>
        <FIELD NAME="APPRAISED_VALUE" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <FIELD NAME="APPRAISAL_DATE" DATATYPE="TIMESTAMP" NULLABLE="N" PRECISION="29"/>
        <FIELD NAME="PROPERTY_TYPE" DATATYPE="STRING" NULLABLE="Y" PRECISION="30"/>
        <FIELD NAME="APPRAISAL_STATUS" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
        <FIELD NAME="APPRAISER_ID" DATATYPE="STRING" NULLABLE="Y" PRECISION="20"/>
      </SOURCE>

      <!-- Source Definition: UNDERWRITING_GUIDELINES -->
      <SOURCE OBJECTID="SRC_0003" NAME="UNDERWRITING_GUIDELINES" DBTYPE="Oracle" CONNECTIONNAME="$$GUIDELINES_CONN">
        <DATABASEOBJECT>UNDERWRITING_GUIDELINES</DATABASEOBJECT>
        <FIELD NAME="LOAN_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
        <FIELD NAME="OCCUPANCY_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
        <FIELD NAME="MAX_LTV_PCT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="2"/>
        <FIELD NAME="MAX_DTI_PCT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="2"/>
        <FIELD NAME="MIN_CREDIT_SCORE" DATATYPE="INTEGER" NULLABLE="N" PRECISION="4"/>
        <FIELD NAME="MAX_LOAN_AMOUNT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <FIELD NAME="REQUIRES_PMI_ABOVE_LTV" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="2"/>
        <FIELD NAME="GUIDELINE_VERSION" DATATYPE="INTEGER" NULLABLE="N" PRECISION="5"/>
        <FIELD NAME="EFFECTIVE_DATE" DATATYPE="DATE" NULLABLE="N" PRECISION="10"/>
      </SOURCE>

      <!-- ================================================================
           SOURCE QUALIFIERS - FILTERED DATA EXTRACTIONS
           ================================================================ -->

      <!-- SQ_LOAN_APPS: Source Qualifier on STG_LOAN_APPLICATIONS_ENRICHED -->
      <TRANSFORMATION OBJECTID="TXN_0001" NAME="SQ_LOAN_APPS" TRANSFORMTYPE="Source Qualifier" SOURCEOBJECTID="SRC_0001">
        <DESCRIPTION>Filter enriched loan applications by current LOAD_DATE to get only recently enriched records</DESCRIPTION>
        <SQLOVERRIDE>SELECT * FROM STG_LOAN_APPLICATIONS_ENRICHED WHERE ENRICHMENT_DATE = $$LOAD_DATE</SQLOVERRIDE>
        <TRANSFORMFIELD NAME="APPLICATION_ID" DATATYPE="STRING" NULLABLE="N" PRECISION="50"/>
        <TRANSFORMFIELD NAME="BORROWER_SSN_HASH" DATATYPE="STRING" NULLABLE="N" PRECISION="64"/>
        <TRANSFORMFIELD NAME="LOAN_AMOUNT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <TRANSFORMFIELD NAME="LOAN_PURPOSE" DATATYPE="STRING" NULLABLE="Y" PRECISION="50"/>
        <TRANSFORMFIELD NAME="LOAN_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
        <TRANSFORMFIELD NAME="INTEREST_RATE" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="3"/>
        <TRANSFORMFIELD NAME="LOAN_TERM_MONTHS" DATATYPE="INTEGER" NULLABLE="N" PRECISION="5"/>
        <TRANSFORMFIELD NAME="DOWN_PAYMENT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <TRANSFORMFIELD NAME="LOAN_TO_VALUE_PCT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="2"/>
        <TRANSFORMFIELD NAME="DOWN_PAYMENT_PCT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="2"/>
        <TRANSFORMFIELD NAME="OCCUPANCY_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
        <TRANSFORMFIELD NAME="APPLICATION_DATE" DATATYPE="TIMESTAMP" NULLABLE="N" PRECISION="29"/>
        <TRANSFORMFIELD NAME="LOAN_TYPE_DESC" DATATYPE="STRING" NULLABLE="Y" PRECISION="100"/>
        <TRANSFORMFIELD NAME="IS_REFI" DATATYPE="STRING" NULLABLE="Y" PRECISION="1"/>
        <TRANSFORMFIELD NAME="APP_MONTH" DATATYPE="STRING" NULLABLE="Y" PRECISION="10"/>
        <TRANSFORMFIELD NAME="LOAN_OFFICER_ID" DATATYPE="STRING" NULLABLE="Y" PRECISION="20"/>
        <TRANSFORMFIELD NAME="BRANCH_CODE" DATATYPE="STRING" NULLABLE="Y" PRECISION="10"/>
        <TRANSFORMFIELD NAME="PROPERTY_STATE" DATATYPE="STRING" NULLABLE="Y" PRECISION="2"/>
        <TRANSFORMFIELD NAME="BUREAU_SCORE" DATATYPE="INTEGER" NULLABLE="N" PRECISION="4"/>
        <TRANSFORMFIELD NAME="CREDIT_TIER" DATATYPE="STRING" NULLABLE="Y" PRECISION="20"/>
        <TRANSFORMFIELD NAME="DEROGATORY_MARKS" DATATYPE="INTEGER" NULLABLE="Y" PRECISION="5"/>
        <TRANSFORMFIELD NAME="INQUIRIES_6MO" DATATYPE="INTEGER" NULLABLE="Y" PRECISION="5"/>
        <TRANSFORMFIELD NAME="BANKRUPTCY_FLAG" DATATYPE="STRING" NULLABLE="Y" PRECISION="1"/>
        <TRANSFORMFIELD NAME="FORECLOSURE_FLAG" DATATYPE="STRING" NULLABLE="Y" PRECISION="1"/>
        <TRANSFORMFIELD NAME="ANNUAL_INCOME" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <TRANSFORMFIELD NAME="MONTHLY_DEBT_PAYMENT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
      </TRANSFORMATION>

      <!-- SQ_PROPERTY_VALUATIONS: Source Qualifier on PROPERTY_VALUATIONS -->
      <TRANSFORMATION OBJECTID="TXN_0002" NAME="SQ_PROPERTY_VALUATIONS" TRANSFORMTYPE="Source Qualifier" SOURCEOBJECTID="SRC_0002">
        <DESCRIPTION>Filter property valuations to include only completed appraisals</DESCRIPTION>
        <SQLOVERRIDE>SELECT * FROM PROPERTY_VALUATIONS WHERE APPRAISAL_STATUS = 'COMPLETE'</SQLOVERRIDE>
        <TRANSFORMFIELD NAME="APPLICATION_ID" DATATYPE="STRING" NULLABLE="N" PRECISION="50"/>
        <TRANSFORMFIELD NAME="APPRAISED_VALUE" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <TRANSFORMFIELD NAME="APPRAISAL_DATE" DATATYPE="TIMESTAMP" NULLABLE="N" PRECISION="29"/>
        <TRANSFORMFIELD NAME="PROPERTY_TYPE" DATATYPE="STRING" NULLABLE="Y" PRECISION="30"/>
        <TRANSFORMFIELD NAME="APPRAISER_ID" DATATYPE="STRING" NULLABLE="Y" PRECISION="20"/>
      </TRANSFORMATION>

      <!-- SQ_UNDERWRITING_GUIDELINES: Source Qualifier on UNDERWRITING_GUIDELINES -->
      <TRANSFORMATION OBJECTID="TXN_0003" NAME="SQ_UNDERWRITING_GUIDELINES" TRANSFORMTYPE="Source Qualifier" SOURCEOBJECTID="SRC_0003">
        <DESCRIPTION>Filter to latest underwriting guidelines effective as of LOAD_DATE, grouped by LOAN_TYPE and OCCUPANCY_TYPE</DESCRIPTION>
        <SQLOVERRIDE>
SELECT LOAN_TYPE, OCCUPANCY_TYPE, MAX_LTV_PCT, MAX_DTI_PCT, MIN_CREDIT_SCORE, 
       MAX_LOAN_AMOUNT, REQUIRES_PMI_ABOVE_LTV, GUIDELINE_VERSION, EFFECTIVE_DATE
FROM UNDERWRITING_GUIDELINES
WHERE EFFECTIVE_DATE &lt;= $$LOAD_DATE
  AND (LOAN_TYPE, OCCUPANCY_TYPE, GUIDELINE_VERSION) IN (
    SELECT LOAN_TYPE, OCCUPANCY_TYPE, MAX(GUIDELINE_VERSION)
    FROM UNDERWRITING_GUIDELINES
    WHERE EFFECTIVE_DATE &lt;= $$LOAD_DATE
    GROUP BY LOAN_TYPE, OCCUPANCY_TYPE
  )
        </SQLOVERRIDE>
        <TRANSFORMFIELD NAME="LOAN_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
        <TRANSFORMFIELD NAME="OCCUPANCY_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
        <TRANSFORMFIELD NAME="MAX_LTV_PCT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="2"/>
        <TRANSFORMFIELD NAME="MAX_DTI_PCT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="2"/>
        <TRANSFORMFIELD NAME="MIN_CREDIT_SCORE" DATATYPE="INTEGER" NULLABLE="N" PRECISION="4"/>
        <TRANSFORMFIELD NAME="MAX_LOAN_AMOUNT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <TRANSFORMFIELD NAME="REQUIRES_PMI_ABOVE_LTV" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="2"/>
        <TRANSFORMFIELD NAME="GUIDELINE_VERSION" DATATYPE="INTEGER" NULLABLE="N" PRECISION="5"/>
        <TRANSFORMFIELD NAME="EFFECTIVE_DATE" DATATYPE="DATE" NULLABLE="N" PRECISION="10"/>
      </TRANSFORMATION>

      <!-- ================================================================
           JOINER TRANSFORMATIONS - JOIN OPERATIONS
           ================================================================ -->

      <!-- JNR_LOANS_PROPERTY: Master Outer Join -->
      <TRANSFORMATION OBJECTID="TXN_0004" NAME="JNR_LOANS_PROPERTY" TRANSFORMTYPE="Joiner">
        <DESCRIPTION>Join enriched loan applications (Master) with completed property appraisals (Detail) on APPLICATION_ID using Master Outer join to preserve loans without appraisals</DESCRIPTION>
        <MASTEROBJECT>TXN_0001</MASTEROBJECT>
        <DETAILOBJECT>TXN_0002</DETAILOBJECT>
        <JOINTYPE>Master Outer</JOINTYPE>
        <JOINCONDITION>
          <CONDITION MASTERFIELD="APPLICATION_ID" DETAILFIELD="APPLICATION_ID" OPERATOR="="/>
        </JOINCONDITION>
        <TRANSFORMFIELD NAME="APPLICATION_ID" DATATYPE="STRING" NULLABLE="N" PRECISION="50"/>
        <TRANSFORMFIELD NAME="BORROWER_SSN_HASH" DATATYPE="STRING" NULLABLE="N" PRECISION="64"/>
        <TRANSFORMFIELD NAME="LOAN_AMOUNT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <TRANSFORMFIELD NAME="LOAN_PURPOSE" DATATYPE="STRING" NULLABLE="Y" PRECISION="50"/>
        <TRANSFORMFIELD NAME="LOAN_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
        <TRANSFORMFIELD NAME="INTEREST_RATE" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="3"/>
        <TRANSFORMFIELD NAME="LOAN_TERM_MONTHS" DATATYPE="INTEGER" NULLABLE="N" PRECISION="5"/>
        <TRANSFORMFIELD NAME="DOWN_PAYMENT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <TRANSFORMFIELD NAME="LOAN_TO_VALUE_PCT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="2"/>
        <TRANSFORMFIELD NAME="DOWN_PAYMENT_PCT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="2"/>
        <TRANSFORMFIELD NAME="OCCUPANCY_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
        <TRANSFORMFIELD NAME="APPLICATION_DATE" DATATYPE="TIMESTAMP" NULLABLE="N" PRECISION="29"/>
        <TRANSFORMFIELD NAME="LOAN_TYPE_DESC" DATATYPE="STRING" NULLABLE="Y" PRECISION="100"/>
        <TRANSFORMFIELD NAME="IS_REFI" DATATYPE="STRING" NULLABLE="Y" PRECISION="1"/>
        <TRANSFORMFIELD NAME="APP_MONTH" DATATYPE="STRING" NULLABLE="Y" PRECISION="10"/>
        <TRANSFORMFIELD NAME="LOAN_OFFICER_ID" DATATYPE="STRING" NULLABLE="Y" PRECISION="20"/>
        <TRANSFORMFIELD NAME="BRANCH_CODE" DATATYPE="STRING" NULLABLE="Y" PRECISION="10"/>
        <TRANSFORMFIELD NAME="PROPERTY_STATE" DATATYPE="STRING" NULLABLE="Y" PRECISION="2"/>
        <TRANSFORMFIELD NAME="BUREAU_SCORE" DATATYPE="INTEGER" NULLABLE="N" PRECISION="4"/>
        <TRANSFORMFIELD NAME="CREDIT_TIER" DATATYPE="STRING" NULLABLE="Y" PRECISION="20"/>
        <TRANSFORMFIELD NAME="DEROGATORY_MARKS" DATATYPE="INTEGER" NULLABLE="Y" PRECISION="5"/>
        <TRANSFORMFIELD NAME="INQUIRIES_6MO" DATATYPE="INTEGER" NULLABLE="Y" PRECISION="5"/>
        <TRANSFORMFIELD NAME="BANKRUPTCY_FLAG" DATATYPE="STRING" NULLABLE="Y" PRECISION="1"/>
        <TRANSFORMFIELD NAME="FORECLOSURE_FLAG" DATATYPE="STRING" NULLABLE="Y" PRECISION="1"/>
        <TRANSFORMFIELD NAME="ANNUAL_INCOME" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <TRANSFORMFIELD NAME="MONTHLY_DEBT_PAYMENT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <TRANSFORMFIELD NAME="APPRAISED_VALUE" DATATYPE="DECIMAL" NULLABLE="Y" PRECISION="15" SCALE="2"/>
        <TRANSFORMFIELD NAME="APPRAISAL_DATE" DATATYPE="TIMESTAMP" NULLABLE="Y" PRECISION="29"/>
        <TRANSFORMFIELD NAME="PROPERTY_TYPE" DATATYPE="STRING" NULLABLE="Y" PRECISION="30"/>
        <TRANSFORMFIELD NAME="APPRAISER_ID" DATATYPE="STRING" NULLABLE="Y" PRECISION="20"/>
      </TRANSFORMATION>

      <!-- JNR_LOANS_GUIDELINES: Master Outer Join -->
      <TRANSFORMATION OBJECTID="TXN_0005" NAME="JNR_LOANS_GUIDELINES" TRANSFORMTYPE="Joiner">
        <DESCRIPTION>Join loans+appraisals (Master) with underwriting guidelines (Detail) on LOAN_TYPE and OCCUPANCY_TYPE using Master Outer join to preserve loans without matching guidelines</DESCRIPTION>
        <MASTEROBJECT>TXN_0004</MASTEROBJECT>
        <DETAILOBJECT>TXN_0003</DETAILOBJECT>
        <JOINTYPE>Master Outer</JOINTYPE>
        <JOINCONDITION>
          <CONDITION MASTERFIELD="LOAN_TYPE" DETAILFIELD="LOAN_TYPE" OPERATOR="="/>
          <CONDITION MASTERFIELD="OCCUPANCY_TYPE" DETAILFIELD="OCCUPANCY_TYPE" OPERATOR="=" LOGICALOPERATOR="AND"/>
        </JOINCONDITION>
        <TRANSFORMFIELD NAME="APPLICATION_ID" DATATYPE="STRING" NULLABLE="N" PRECISION="50"/>
        <TRANSFORMFIELD NAME="BORROWER_SSN_HASH" DATATYPE="STRING" NULLABLE="N" PRECISION="64"/>
        <TRANSFORMFIELD NAME="LOAN_AMOUNT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <TRANSFORMFIELD NAME="LOAN_PURPOSE" DATATYPE="STRING" NULLABLE="Y" PRECISION="50"/>
        <TRANSFORMFIELD NAME="LOAN_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
        <TRANSFORMFIELD NAME="INTEREST_RATE" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="3"/>
        <TRANSFORMFIELD NAME="LOAN_TERM_MONTHS" DATATYPE="INTEGER" NULLABLE="N" PRECISION="5"/>
        <TRANSFORMFIELD NAME="DOWN_PAYMENT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <TRANSFORMFIELD NAME="LOAN_TO_VALUE_PCT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="2"/>
        <TRANSFORMFIELD NAME="DOWN_PAYMENT_PCT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="2"/>
        <TRANSFORMFIELD NAME="OCCUPANCY_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
        <TRANSFORMFIELD NAME="APPLICATION_DATE" DATATYPE="TIMESTAMP" NULLABLE="N" PRECISION="29"/>
        <TRANSFORMFIELD NAME="LOAN_TYPE_DESC" DATATYPE="STRING" NULLABLE="Y" PRECISION="100"/>
        <TRANSFORMFIELD NAME="IS_REFI" DATATYPE="STRING" NULLABLE="Y" PRECISION="1"/>
        <TRANSFORMFIELD NAME="APP_MONTH" DATATYPE="STRING" NULLABLE="Y" PRECISION="10"/>
        <TRANSFORMFIELD NAME="LOAN_OFFICER_ID" DATATYPE="STRING" NULLABLE="Y" PRECISION="20"/>
        <TRANSFORMFIELD NAME="BRANCH_CODE" DATATYPE="STRING" NULLABLE="Y" PRECISION="10"/>
        <TRANSFORMFIELD NAME="PROPERTY_STATE" DATATYPE="STRING" NULLABLE="Y" PRECISION="2"/>
        <TRANSFORMFIELD NAME="BUREAU_SCORE" DATATYPE="INTEGER" NULLABLE="N" PRECISION="4"/>
        <TRANSFORMFIELD NAME="CREDIT_TIER" DATATYPE="STRING" NULLABLE="Y" PRECISION="20"/>
        <TRANSFORMFIELD NAME="DEROGATORY_MARKS" DATATYPE="INTEGER" NULLABLE="Y" PRECISION="5"/>
        <TRANSFORMFIELD NAME="INQUIRIES_6MO" DATATYPE="INTEGER" NULLABLE="Y" PRECISION="5"/>
        <TRANSFORMFIELD NAME="BANKRUPTCY_FLAG" DATATYPE="STRING" NULLABLE="Y" PRECISION="1"/>
        <TRANSFORMFIELD NAME="FORECLOSURE_FLAG" DATATYPE="STRING" NULLABLE="Y" PRECISION="1"/>
        <TRANSFORMFIELD NAME="ANNUAL_INCOME" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <TRANSFORMFIELD NAME="MONTHLY_DEBT_PAYMENT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <TRANSFORMFIELD NAME="APPRAISED_VALUE" DATATYPE="DECIMAL" NULLABLE="Y" PRECISION="15" SCALE="2"/>
        <TRANSFORMFIELD NAME="APPRAISAL_DATE" DATATYPE="TIMESTAMP" NULLABLE="Y" PRECISION="29"/>
        <TRANSFORMFIELD NAME="PROPERTY_TYPE" DATATYPE="STRING" NULLABLE="Y" PRECISION="30"/>
        <TRANSFORMFIELD NAME="APPRAISER_ID" DATATYPE="STRING" NULLABLE="Y" PRECISION="20"/>
        <TRANSFORMFIELD NAME="MAX_LTV_PCT" DATATYPE="DECIMAL" NULLABLE="Y" PRECISION="5" SCALE="2"/>
        <TRANSFORMFIELD NAME="MAX_DTI_PCT" DATATYPE="DECIMAL" NULLABLE="Y" PRECISION="5" SCALE="2"/>
        <TRANSFORMFIELD NAME="MIN_CREDIT_SCORE" DATATYPE="INTEGER" NULLABLE="Y" PRECISION="4"/>
        <TRANSFORMFIELD NAME="MAX_LOAN_AMOUNT" DATATYPE="DECIMAL" NULLABLE="Y" PRECISION="15" SCALE="2"/>
        <TRANSFORMFIELD NAME="REQUIRES_PMI_ABOVE_LTV" DATATYPE="DECIMAL" NULLABLE="Y" PRECISION="5" SCALE="2"/>
        <TRANSFORMFIELD NAME="GUIDELINE_VERSION" DATATYPE="INTEGER" NULLABLE="Y" PRECISION="5"/>
        <TRANSFORMFIELD NAME="EFFECTIVE_DATE" DATATYPE="DATE" NULLABLE="Y" PRECISION="10"/>
      </TRANSFORMATION>

      <!-- ================================================================
           EXPRESSION TRANSFORMATION - COMPLEX UNDERWRITING CALCULATIONS
           ================================================================ -->

      <!-- EXP_UNDERWRITING_RULES: Calculate all rule validation fields -->
      <TRANSFORMATION OBJECTID="TXN_0006" NAME="EXP_UNDERWRITING_RULES" TRANSFORMTYPE="Expression">
        <DESCRIPTION>Complex expression transformation calculating LTV, DTI, monthly payment, credit validation, bankruptcy/foreclosure checks, PMI requirements, and decision reasoning for loan underwriting</DESCRIPTION>
        
        <!-- ACTUAL_LTV calculation: LOAN_AMOUNT / APPRAISED_VALUE * 100 -->
        <TRANSFORMFIELD NAME="ACTUAL_LTV" DATATYPE="DECIMAL" PRECISION="5" SCALE="2">
          <EXPRESSION>IIF(ISNULL(APPRAISED_VALUE) OR APPRAISED_VALUE = 0, NULL, ROUND((LOAN_AMOUNT / APPRAISED_VALUE) * 100, 2))</EXPRESSION>
          <COMMENT>Loan-to-Value ratio as percentage. Null if appraisal missing or zero value.</COMMENT>
        </TRANSFORMFIELD>

        <!-- MONTHLY_PAYMENT calculation: Principal + Interest using amortization formula -->
        <TRANSFORMFIELD NAME="MONTHLY_PAYMENT" DATATYPE="DECIMAL" PRECISION="15" SCALE="2">
          <EXPRESSION>IIF(INTEREST_RATE = 0 OR LOAN_TERM_MONTHS = 0, LOAN_AMOUNT / LOAN_TERM_MONTHS, ROUND(LOAN_AMOUNT * (INTEREST_RATE / 1200) / (1 - POWER(1 + (INTEREST_RATE / 1200), -LOAN_TERM_MONTHS)), 2))</EXPRESSION>
          <COMMENT>Monthly P&amp;I payment using standard amortization. Handles zero interest rate edge case.</COMMENT>
        </TRANSFORMFIELD>

        <!-- DTI_RATIO calculation: (MONTHLY_DEBT + MONTHLY_PAYMENT) / (ANNUAL_INCOME / 12) * 100 -->
        <TRANSFORMFIELD NAME="DTI_RATIO" DATATYPE="DECIMAL" PRECISION="5" SCALE="2">
          <EXPRESSION>IIF(ANNUAL_INCOME = 0, NULL, ROUND(((MONTHLY_DEBT_PAYMENT + MONTHLY_PAYMENT) / (ANNUAL_INCOME / 12)) * 100, 2))</EXPRESSION>
          <COMMENT>Debt-to-Income ratio as percentage. Includes existing debt plus new loan payment.</COMMENT>
        </TRANSFORMFIELD>

        <!-- REQUIRES_PMI flag: Check if LTV exceeds PMI threshold -->
        <TRANSFORMFIELD NAME="REQUIRES_PMI" DATATYPE="STRING" PRECISION="1">
          <EXPRESSION>IIF(ISNULL(ACTUAL_LTV) OR ISNULL(REQUIRES_PMI_ABOVE_LTV), 'U', IIF(ACTUAL_LTV &gt; REQUIRES_PMI_ABOVE_LTV, 'Y', 'N'))</EXPRESSION>
          <COMMENT>Y=Requires PMI, N=PMI not required, U=Unable to determine (missing data)</COMMENT>
        </TRANSFORMFIELD>

        <!-- LTV_PASS: Validate LTV against maximum threshold -->
        <TRANSFORMFIELD NAME="LTV_PASS" DATATYPE="STRING" PRECISION="1">
          <EXPRESSION>IIF(ISNULL(ACTUAL_LTV) OR ISNULL(MAX_LTV_PCT), 'U', IIF(ACTUAL_LTV &lt;= MAX_LTV_PCT, 'Y', 'N'))</EXPRESSION>
          <COMMENT>Y=LTV passes validation, N=LTV exceeds maximum, U=Unable to determine</COMMENT>
        </TRANSFORMFIELD>

        <!-- DTI_PASS: Validate DTI against maximum threshold (with optional override) -->
        <TRANSFORMFIELD NAME="DTI_PASS" DATATYPE="STRING" PRECISION="1">
          <EXPRESSION>IIF(ISNULL(DTI_RATIO), 'U', IIF(DTI_RATIO &lt;= IIF(ISNULL($$MAX_DTI_OVERRIDE), MAX_DTI_PCT, $$MAX_DTI_OVERRIDE), 'Y', 'N'))</EXPRESSION>
          <COMMENT>Y=DTI passes validation, N=DTI exceeds maximum, U=Unable to determine. Uses $$MAX_DTI_OVERRIDE if provided.</COMMENT>
        </TRANSFORMFIELD>

        <!-- CREDIT_PASS: Validate credit score against minimum threshold -->
        <TRANSFORMFIELD NAME="CREDIT_PASS" DATATYPE="STRING" PRECISION="1">
          <EXPRESSION>IIF(ISNULL(BUREAU_SCORE) OR ISNULL(MIN_CREDIT_SCORE), 'U', IIF(BUREAU_SCORE &gt;= MIN_CREDIT_SCORE, 'Y', 'N'))</EXPRESSION>
          <COMMENT>Y=Credit score passes minimum, N=Below minimum credit score, U=Unable to determine</COMMENT>
        </TRANSFORMFIELD>

        <!-- BANKRUPTCY_PASS: Check for bankruptcy flag -->
        <TRANSFORMFIELD NAME="BANKRUPTCY_PASS" DATATYPE="STRING" PRECISION="1">
          <EXPRESSION>IIF(ISNULL(BANKRUPTCY_FLAG), 'U', IIF(BANKRUPTCY_FLAG = 'Y', 'N', 'Y'))</EXPRESSION>
          <COMMENT>Y=No bankruptcy, N=Has bankruptcy flag, U=Unable to determine</COMMENT>
        </TRANSFORMFIELD>

        <!-- FORECLOSURE_PASS: Check for foreclosure flag -->
        <TRANSFORMFIELD NAME="FORECLOSURE_PASS" DATATYPE="STRING" PRECISION="1">
          <EXPRESSION>IIF(ISNULL(FORECLOSURE_FLAG), 'U', IIF(FORECLOSURE_FLAG = 'Y', 'N', 'Y'))</EXPRESSION>
          <COMMENT>Y=No foreclosure, N=Has foreclosure flag, U=Unable to determine</COMMENT>
        </TRANSFORMFIELD>

        <!-- DECISION_REASON: Concatenate all failure reasons for audit trail -->
        <TRANSFORMFIELD NAME="DECISION_REASON" DATATYPE="STRING" PRECISION="500">
          <EXPRESSION>TRIM(CONCAT(
  IIF(LTV_PASS = 'N', 'LTV_EXCEED:' || ACTUAL_LTV || '%_vs_' || MAX_LTV_PCT || '%|', ''),
  IIF(DTI_PASS = 'N', 'DTI_EXCEED:' || DTI_RATIO || '%|', ''),
  IIF(CREDIT_PASS = 'N', 'CREDIT_LOW:' || BUREAU_SCORE || '_vs_' || MIN_CREDIT_SCORE || '|', ''),
  IIF(BANKRUPTCY_PASS = 'N', 'BANKRUPTCY_FLAG|', ''),
  IIF(FORECLOSURE_PASS = 'N', 'FORECLOSURE_FLAG|', ''),
  IIF(LOAN_AMOUNT &gt; MAX_LOAN_AMOUNT, 'LOAN_AMOUNT_EXCEED:' || LOAN_AMOUNT || '|', '')
))</EXPRESSION>
          <COMMENT>Pipe-delimited reason codes for any failed validation rules. Empty string if all pass.</COMMENT>
        </TRANSFORMFIELD>

        <!-- UNDERWRITING_DATE: Set to processing date -->
        <TRANSFORMFIELD NAME="UNDERWRITING_DATE" DATATYPE="DATE">
          <EXPRESSION>$$LOAD_DATE</EXPRESSION>
          <COMMENT>Date underwriting decision was made</COMMENT>
        </TRANSFORMFIELD>

        <!-- Pass-through fields from joined data -->
        <TRANSFORMFIELD NAME="APPLICATION_ID" DATATYPE="STRING" NULLABLE="N" PRECISION="50"/>
        <TRANSFORMFIELD NAME="BORROWER_SSN_HASH" DATATYPE="STRING" NULLABLE="N" PRECISION="64"/>
        <TRANSFORMFIELD NAME="LOAN_AMOUNT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <TRANSFORMFIELD NAME="LOAN_PURPOSE" DATATYPE="STRING" NULLABLE="Y" PRECISION="50"/>
        <TRANSFORMFIELD NAME="LOAN_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
        <TRANSFORMFIELD NAME="INTEREST_RATE" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="3"/>
        <TRANSFORMFIELD NAME="LOAN_TERM_MONTHS" DATATYPE="INTEGER" NULLABLE="N" PRECISION="5"/>
        <TRANSFORMFIELD NAME="DOWN_PAYMENT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <TRANSFORMFIELD NAME="OCCUPANCY_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
        <TRANSFORMFIELD NAME="APPLICATION_DATE" DATATYPE="TIMESTAMP" NULLABLE="N" PRECISION="29"/>
        <TRANSFORMFIELD NAME="LOAN_TYPE_DESC" DATATYPE="STRING" NULLABLE="Y" PRECISION="100"/>
        <TRANSFORMFIELD NAME="IS_REFI" DATATYPE="STRING" NULLABLE="Y" PRECISION="1"/>
        <TRANSFORMFIELD NAME="APP_MONTH" DATATYPE="STRING" NULLABLE="Y" PRECISION="10"/>
        <TRANSFORMFIELD NAME="LOAN_OFFICER_ID" DATATYPE="STRING" NULLABLE="Y" PRECISION="20"/>
        <TRANSFORMFIELD NAME="BRANCH_CODE" DATATYPE="STRING" NULLABLE="Y" PRECISION="10"/>
        <TRANSFORMFIELD NAME="PROPERTY_STATE" DATATYPE="STRING" NULLABLE="Y" PRECISION="2"/>
        <TRANSFORMFIELD NAME="BUREAU_SCORE" DATATYPE="INTEGER" NULLABLE="N" PRECISION="4"/>
        <TRANSFORMFIELD NAME="CREDIT_TIER" DATATYPE="STRING" NULLABLE="Y" PRECISION="20"/>
        <TRANSFORMFIELD NAME="APPRAISED_VALUE" DATATYPE="DECIMAL" NULLABLE="Y" PRECISION="15" SCALE="2"/>
        <TRANSFORMFIELD NAME="PROPERTY_TYPE" DATATYPE="STRING" NULLABLE="Y" PRECISION="30"/>
        <TRANSFORMFIELD NAME="ANNUAL_INCOME" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <TRANSFORMFIELD NAME="MONTHLY_DEBT_PAYMENT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
      </TRANSFORMATION>

      <!-- ================================================================
           ROUTER TRANSFORMATION - DECISION BRANCHING
           ================================================================ -->

      <!-- RTR_LOAN_DECISION: Route loans to 4 decision groups -->
      <TRANSFORMATION OBJECTID="TXN_0007" NAME="RTR_LOAN_DECISION" TRANSFORMTYPE="Router">
        <DESCRIPTION>Router transformation to branch loans into 4 decision categories based on underwriting rule validation results</DESCRIPTION>

        <!-- Group 1: APPROVED -->
        <ROUTERGROUP NAME="APPROVED">
          <DESCRIPTION>Loans that pass all underwriting criteria: LTV, DTI, credit score, no bankruptcy, no foreclosure</DESCRIPTION>
          <CONDITION>LTV_PASS='Y' AND DTI_PASS='Y' AND CREDIT_PASS='Y' AND BANKRUPTCY_PASS='Y' AND FORECLOSURE_PASS='Y'</CONDITION>
          <TRANSFORMFIELD NAME="APPLICATION_ID" DATATYPE="STRING" NULLABLE="N" PRECISION="50"/>
          <TRANSFORMFIELD NAME="BORROWER_SSN_HASH" DATATYPE="STRING" NULLABLE="N" PRECISION="64"/>
          <TRANSFORMFIELD NAME="LOAN_AMOUNT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
          <TRANSFORMFIELD NAME="LOAN_PURPOSE" DATATYPE="STRING" NULLABLE="Y" PRECISION="50"/>
          <TRANSFORMFIELD NAME="LOAN_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
          <TRANSFORMFIELD NAME="INTEREST_RATE" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="3"/>
          <TRANSFORMFIELD NAME="LOAN_TERM_MONTHS" DATATYPE="INTEGER" NULLABLE="N" PRECISION="5"/>
          <TRANSFORMFIELD NAME="LOAN_TYPE_DESC" DATATYPE="STRING" NULLABLE="Y" PRECISION="100"/>
          <TRANSFORMFIELD NAME="OCCUPANCY_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
          <TRANSFORMFIELD NAME="APPLICATION_DATE" DATATYPE="TIMESTAMP" NULLABLE="N" PRECISION="29"/>
          <TRANSFORMFIELD NAME="BRANCH_CODE" DATATYPE="STRING" NULLABLE="Y" PRECISION="10"/>
          <TRANSFORMFIELD NAME="PROPERTY_STATE" DATATYPE="STRING" NULLABLE="Y" PRECISION="2"/>
          <TRANSFORMFIELD NAME="BUREAU_SCORE" DATATYPE="INTEGER" NULLABLE="N" PRECISION="4"/>
          <TRANSFORMFIELD NAME="CREDIT_TIER" DATATYPE="STRING" NULLABLE="Y" PRECISION="20"/>
          <TRANSFORMFIELD NAME="ACTUAL_LTV" DATATYPE="DECIMAL" PRECISION="5" SCALE="2"/>
          <TRANSFORMFIELD NAME="DTI_RATIO" DATATYPE="DECIMAL" PRECISION="5" SCALE="2"/>
          <TRANSFORMFIELD NAME="MONTHLY_PAYMENT" DATATYPE="DECIMAL" PRECISION="15" SCALE="2"/>
          <TRANSFORMFIELD NAME="REQUIRES_PMI" DATATYPE="STRING" PRECISION="1"/>
          <TRANSFORMFIELD NAME="UNDERWRITING_DATE" DATATYPE="DATE"/>
          <TRANSFORMFIELD NAME="DECISION_REASON" DATATYPE="STRING" PRECISION="500"/>
        </ROUTERGROUP>

        <!-- Group 2: MANUAL_REVIEW -->
        <ROUTERGROUP NAME="MANUAL_REVIEW">
          <DESCRIPTION>Fair credit tier borrowers who pass LTV, DTI, and have no bankruptcy/foreclosure. Requires manual underwriter review despite passing automated rules.</DESCRIPTION>
          <CONDITION>CREDIT_TIER='FAIR' AND LTV_PASS='Y' AND DTI_PASS='Y' AND BANKRUPTCY_PASS='Y' AND FORECLOSURE_PASS='Y'</CONDITION>
          <TRANSFORMFIELD NAME="APPLICATION_ID" DATATYPE="STRING" NULLABLE="N" PRECISION="50"/>
          <TRANSFORMFIELD NAME="BORROWER_SSN_HASH" DATATYPE="STRING" NULLABLE="N" PRECISION="64"/>
          <TRANSFORMFIELD NAME="LOAN_AMOUNT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
          <TRANSFORMFIELD NAME="LOAN_PURPOSE" DATATYPE="STRING" NULLABLE="Y" PRECISION="50"/>
          <TRANSFORMFIELD NAME="LOAN_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
          <TRANSFORMFIELD NAME="INTEREST_RATE" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="3"/>
          <TRANSFORMFIELD NAME="LOAN_TERM_MONTHS" DATATYPE="INTEGER" NULLABLE="N" PRECISION="5"/>
          <TRANSFORMFIELD NAME="LOAN_OFFICER_ID" DATATYPE="STRING" NULLABLE="Y" PRECISION="20"/>
          <TRANSFORMFIELD NAME="OCCUPANCY_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
          <TRANSFORMFIELD NAME="APPLICATION_DATE" DATATYPE="TIMESTAMP" NULLABLE="N" PRECISION="29"/>
          <TRANSFORMFIELD NAME="BRANCH_CODE" DATATYPE="STRING" NULLABLE="Y" PRECISION="10"/>
          <TRANSFORMFIELD NAME="PROPERTY_STATE" DATATYPE="STRING" NULLABLE="Y" PRECISION="2"/>
          <TRANSFORMFIELD NAME="BUREAU_SCORE" DATATYPE="INTEGER" NULLABLE="N" PRECISION="4"/>
          <TRANSFORMFIELD NAME="CREDIT_TIER" DATATYPE="STRING" NULLABLE="Y" PRECISION="20"/>
          <TRANSFORMFIELD NAME="DEROGATORY_MARKS" DATATYPE="INTEGER" NULLABLE="Y" PRECISION="5"/>
          <TRANSFORMFIELD NAME="INQUIRIES_6MO" DATATYPE="INTEGER" NULLABLE="Y" PRECISION="5"/>
          <TRANSFORMFIELD NAME="ACTUAL_LTV" DATATYPE="DECIMAL" PRECISION="5" SCALE="2"/>
          <TRANSFORMFIELD NAME="DTI_RATIO" DATATYPE="DECIMAL" PRECISION="5" SCALE="2"/>
          <TRANSFORMFIELD NAME="APPRAISED_VALUE" DATATYPE="DECIMAL" NULLABLE="Y" PRECISION="15" SCALE="2"/>
          <TRANSFORMFIELD NAME="UNDERWRITING_DATE" DATATYPE="DATE"/>
          <TRANSFORMFIELD NAME="DECISION_REASON" DATATYPE="STRING" PRECISION="500"/>
        </ROUTERGROUP>

        <!-- Group 3: REFERRED -->
        <ROUTERGROUP NAME="REFERRED">
          <DESCRIPTION>Loans with DTI or LTV failures that may be reconsidered with manual intervention, but not outright declines</DESCRIPTION>
          <CONDITION>(DTI_PASS='N' OR LTV_PASS='N') AND BANKRUPTCY_PASS='Y' AND FORECLOSURE_PASS='Y' AND CREDIT_PASS='Y'</CONDITION>
          <TRANSFORMFIELD NAME="APPLICATION_ID" DATATYPE="STRING" NULLABLE="N" PRECISION="50"/>
          <TRANSFORMFIELD NAME="BORROWER_SSN_HASH" DATATYPE="STRING" NULLABLE="N" PRECISION="64"/>
          <TRANSFORMFIELD NAME="LOAN_AMOUNT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
          <TRANSFORMFIELD NAME="LOAN_PURPOSE" DATATYPE="STRING" NULLABLE="Y" PRECISION="50"/>
          <TRANSFORMFIELD NAME="LOAN_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
          <TRANSFORMFIELD NAME="INTEREST_RATE" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="3"/>
          <TRANSFORMFIELD NAME="LOAN_TERM_MONTHS" DATATYPE="INTEGER" NULLABLE="N" PRECISION="5"/>
          <TRANSFORMFIELD NAME="LOAN_OFFICER_ID" DATATYPE="STRING" NULLABLE="Y" PRECISION="20"/>
          <TRANSFORMFIELD NAME="OCCUPANCY_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
          <TRANSFORMFIELD NAME="APPLICATION_DATE" DATATYPE="TIMESTAMP" NULLABLE="N" PRECISION="29"/>
          <TRANSFORMFIELD NAME="BRANCH_CODE" DATATYPE="STRING" NULLABLE="Y" PRECISION="10"/>
          <TRANSFORMFIELD NAME="PROPERTY_STATE" DATATYPE="STRING" NULLABLE="Y" PRECISION="2"/>
          <TRANSFORMFIELD NAME="BUREAU_SCORE" DATATYPE="INTEGER" NULLABLE="N" PRECISION="4"/>
          <TRANSFORMFIELD NAME="CREDIT_TIER" DATATYPE="STRING" NULLABLE="Y" PRECISION="20"/>
          <TRANSFORMFIELD NAME="ACTUAL_LTV" DATATYPE="DECIMAL" PRECISION="5" SCALE="2"/>
          <TRANSFORMFIELD NAME="DTI_RATIO" DATATYPE="DECIMAL" PRECISION="5" SCALE="2"/>
          <TRANSFORMFIELD NAME="APPRAISED_VALUE" DATATYPE="DECIMAL" NULLABLE="Y" PRECISION="15" SCALE="2"/>
          <TRANSFORMFIELD NAME="MAX_LTV_PCT" DATATYPE="DECIMAL" NULLABLE="Y" PRECISION="5" SCALE="2"/>
          <TRANSFORMFIELD NAME="MAX_DTI_PCT" DATATYPE="DECIMAL" NULLABLE="Y" PRECISION="5" SCALE="2"/>
          <TRANSFORMFIELD NAME="UNDERWRITING_DATE" DATATYPE="DATE"/>
          <TRANSFORMFIELD NAME="DECISION_REASON" DATATYPE="STRING" PRECISION="500"/>
        </ROUTERGROUP>

        <!-- Group 4: DECLINED (Default) -->
        <ROUTERGROUP NAME="DECLINED">
          <DESCRIPTION>Hard declines: credit failures, bankruptcy, foreclosure, or other disqualifying criteria</DESCRIPTION>
          <CONDITION>DEFAULT</CONDITION>
          <TRANSFORMFIELD NAME="APPLICATION_ID" DATATYPE="STRING" NULLABLE="N" PRECISION="50"/>
          <TRANSFORMFIELD NAME="BORROWER_SSN_HASH" DATATYPE="STRING" NULLABLE="N" PRECISION="64"/>
          <TRANSFORMFIELD NAME="LOAN_AMOUNT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
          <TRANSFORMFIELD NAME="LOAN_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
          <TRANSFORMFIELD NAME="LOAN_PURPOSE" DATATYPE="STRING" NULLABLE="Y" PRECISION="50"/>
          <TRANSFORMFIELD NAME="APPLICATION_DATE" DATATYPE="TIMESTAMP" NULLABLE="N" PRECISION="29"/>
          <TRANSFORMFIELD NAME="BRANCH_CODE" DATATYPE="STRING" NULLABLE="Y" PRECISION="10"/>
          <TRANSFORMFIELD NAME="PROPERTY_STATE" DATATYPE="STRING" NULLABLE="Y" PRECISION="2"/>
          <TRANSFORMFIELD NAME="BUREAU_SCORE" DATATYPE="INTEGER" NULLABLE="N" PRECISION="4"/>
          <TRANSFORMFIELD NAME="BANKRUPTCY_FLAG" DATATYPE="STRING" NULLABLE="Y" PRECISION="1"/>
          <TRANSFORMFIELD NAME="FORECLOSURE_FLAG" DATATYPE="STRING" NULLABLE="Y" PRECISION="1"/>
          <TRANSFORMFIELD NAME="ACTUAL_LTV" DATATYPE="DECIMAL" PRECISION="5" SCALE="2"/>
          <TRANSFORMFIELD NAME="DTI_RATIO" DATATYPE="DECIMAL" PRECISION="5" SCALE="2"/>
          <TRANSFORMFIELD NAME="UNDERWRITING_DATE" DATATYPE="DATE"/>
          <TRANSFORMFIELD NAME="DECISION_REASON" DATATYPE="STRING" PRECISION="500"/>
        </ROUTERGROUP>
      </TRANSFORMATION>

      <!-- ================================================================
           TARGET DEFINITIONS AND CONNECTORS
           ================================================================ -->

      <!-- Target 1: TGT_APPROVED_LOANS -->
      <TARGET OBJECTID="TGT_0001" NAME="TGT_APPROVED_LOANS" DBTYPE="Snowflake" CONNECTIONNAME="$$TGT_CONNECTION">
        <DATABASEOBJECT>TGT_APPROVED_LOANS</DATABASEOBJECT>
        <TARGETFIELD NAME="APPLICATION_ID" DATATYPE="STRING" NULLABLE="N" PRECISION="50"/>
        <TARGETFIELD NAME="BORROWER_SSN_HASH" DATATYPE="STRING" NULLABLE="N" PRECISION="64"/>
        <TARGETFIELD NAME="LOAN_AMOUNT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <TARGETFIELD NAME="LOAN_PURPOSE" DATATYPE="STRING" NULLABLE="Y" PRECISION="50"/>
        <TARGETFIELD NAME="LOAN_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
        <TARGETFIELD NAME="INTEREST_RATE" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="3"/>
        <TARGETFIELD NAME="LOAN_TERM_MONTHS" DATATYPE="INTEGER" NULLABLE="N" PRECISION="5"/>
        <TARGETFIELD NAME="BRANCH_CODE" DATATYPE="STRING" NULLABLE="Y" PRECISION="10"/>
        <TARGETFIELD NAME="PROPERTY_STATE" DATATYPE="STRING" NULLABLE="Y" PRECISION="2"/>
        <TARGETFIELD NAME="BUREAU_SCORE" DATATYPE="INTEGER" NULLABLE="N" PRECISION="4"/>
        <TARGETFIELD NAME="CREDIT_TIER" DATATYPE="STRING" NULLABLE="Y" PRECISION="20"/>
        <TARGETFIELD NAME="ACTUAL_LTV" DATATYPE="DECIMAL" PRECISION="5" SCALE="2"/>
        <TARGETFIELD NAME="DTI_RATIO" DATATYPE="DECIMAL" PRECISION="5" SCALE="2"/>
        <TARGETFIELD NAME="MONTHLY_PAYMENT" DATATYPE="DECIMAL" PRECISION="15" SCALE="2"/>
        <TARGETFIELD NAME="REQUIRES_PMI" DATATYPE="STRING" PRECISION="1"/>
        <TARGETFIELD NAME="APPLICATION_DATE" DATATYPE="TIMESTAMP" NULLABLE="N" PRECISION="29"/>
        <TARGETFIELD NAME="UNDERWRITING_DATE" DATATYPE="DATE"/>
        <TARGETFIELD NAME="DECISION_REASON" DATATYPE="STRING" PRECISION="500"/>
        <TARGETFIELD NAME="LOAD_DATE" DATATYPE="DATE" DEFAULTVALUE="$$LOAD_DATE"/>
        <TARGETFIELD NAME="ETL_LOAD_TIMESTAMP" DATATYPE="TIMESTAMP" DEFAULTVALUE="CURRENT_TIMESTAMP"/>
      </TARGET>

      <!-- Target 2: TGT_REFERRED_LOANS -->
      <TARGET OBJECTID="TGT_0002" NAME="TGT_REFERRED_LOANS" DBTYPE="Snowflake" CONNECTIONNAME="$$TGT_CONNECTION">
        <DATABASEOBJECT>TGT_REFERRED_LOANS</DATABASEOBJECT>
        <TARGETFIELD NAME="APPLICATION_ID" DATATYPE="STRING" NULLABLE="N" PRECISION="50"/>
        <TARGETFIELD NAME="BORROWER_SSN_HASH" DATATYPE="STRING" NULLABLE="N" PRECISION="64"/>
        <TARGETFIELD NAME="LOAN_AMOUNT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <TARGETFIELD NAME="LOAN_PURPOSE" DATATYPE="STRING" NULLABLE="Y" PRECISION="50"/>
        <TARGETFIELD NAME="LOAN_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
        <TARGETFIELD NAME="INTEREST_RATE" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="3"/>
        <TARGETFIELD NAME="LOAN_TERM_MONTHS" DATATYPE="INTEGER" NULLABLE="N" PRECISION="5"/>
        <TARGETFIELD NAME="LOAN_OFFICER_ID" DATATYPE="STRING" NULLABLE="Y" PRECISION="20"/>
        <TARGETFIELD NAME="BRANCH_CODE" DATATYPE="STRING" NULLABLE="Y" PRECISION="10"/>
        <TARGETFIELD NAME="PROPERTY_STATE" DATATYPE="STRING" NULLABLE="Y" PRECISION="2"/>
        <TARGETFIELD NAME="BUREAU_SCORE" DATATYPE="INTEGER" NULLABLE="N" PRECISION="4"/>
        <TARGETFIELD NAME="ACTUAL_LTV" DATATYPE="DECIMAL" PRECISION="5" SCALE="2"/>
        <TARGETFIELD NAME="DTI_RATIO" DATATYPE="DECIMAL" PRECISION="5" SCALE="2"/>
        <TARGETFIELD NAME="APPRAISED_VALUE" DATATYPE="DECIMAL" NULLABLE="Y" PRECISION="15" SCALE="2"/>
        <TARGETFIELD NAME="MAX_LTV_PCT" DATATYPE="DECIMAL" NULLABLE="Y" PRECISION="5" SCALE="2"/>
        <TARGETFIELD NAME="MAX_DTI_PCT" DATATYPE="DECIMAL" NULLABLE="Y" PRECISION="5" SCALE="2"/>
        <TARGETFIELD NAME="APPLICATION_DATE" DATATYPE="TIMESTAMP" NULLABLE="N" PRECISION="29"/>
        <TARGETFIELD NAME="UNDERWRITING_DATE" DATATYPE="DATE"/>
        <TARGETFIELD NAME="DECISION_REASON" DATATYPE="STRING" PRECISION="500"/>
        <TARGETFIELD NAME="REFERRAL_CATEGORY" DATATYPE="STRING" DEFAULTVALUE="'DTI_LTV_REVIEW'"/>
        <TARGETFIELD NAME="LOAD_DATE" DATATYPE="DATE" DEFAULTVALUE="$$LOAD_DATE"/>
        <TARGETFIELD NAME="ETL_LOAD_TIMESTAMP" DATATYPE="TIMESTAMP" DEFAULTVALUE="CURRENT_TIMESTAMP"/>
      </TARGET>

      <!-- Target 3: TGT_DECLINED_LOANS -->
      <TARGET OBJECTID="TGT_0003" NAME="TGT_DECLINED_LOANS" DBTYPE="Snowflake" CONNECTIONNAME="$$TGT_CONNECTION">
        <DATABASEOBJECT>TGT_DECLINED_LOANS</DATABASEOBJECT>
        <TARGETFIELD NAME="APPLICATION_ID" DATATYPE="STRING" NULLABLE="N" PRECISION="50"/>
        <TARGETFIELD NAME="BORROWER_SSN_HASH" DATATYPE="STRING" NULLABLE="N" PRECISION="64"/>
        <TARGETFIELD NAME="LOAN_AMOUNT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <TARGETFIELD NAME="LOAN_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
        <TARGETFIELD NAME="LOAN_PURPOSE" DATATYPE="STRING" NULLABLE="Y" PRECISION="50"/>
        <TARGETFIELD NAME="BUREAU_SCORE" DATATYPE="INTEGER" NULLABLE="N" PRECISION="4"/>
        <TARGETFIELD NAME="BANKRUPTCY_FLAG" DATATYPE="STRING" NULLABLE="Y" PRECISION="1"/>
        <TARGETFIELD NAME="FORECLOSURE_FLAG" DATATYPE="STRING" NULLABLE="Y" PRECISION="1"/>
        <TARGETFIELD NAME="ACTUAL_LTV" DATATYPE="DECIMAL" PRECISION="5" SCALE="2"/>
        <TARGETFIELD NAME="DTI_RATIO" DATATYPE="DECIMAL" PRECISION="5" SCALE="2"/>
        <TARGETFIELD NAME="BRANCH_CODE" DATATYPE="STRING" NULLABLE="Y" PRECISION="10"/>
        <TARGETFIELD NAME="PROPERTY_STATE" DATATYPE="STRING" NULLABLE="Y" PRECISION="2"/>
        <TARGETFIELD NAME="APPLICATION_DATE" DATATYPE="TIMESTAMP" NULLABLE="N" PRECISION="29"/>
        <TARGETFIELD NAME="UNDERWRITING_DATE" DATATYPE="DATE"/>
        <TARGETFIELD NAME="DECISION_REASON" DATATYPE="STRING" PRECISION="500"/>
        <TARGETFIELD NAME="DECLINE_REASON_CODES" DATATYPE="STRING" PRECISION="200"/>
        <TARGETFIELD NAME="LOAD_DATE" DATATYPE="DATE" DEFAULTVALUE="$$LOAD_DATE"/>
        <TARGETFIELD NAME="ETL_LOAD_TIMESTAMP" DATATYPE="TIMESTAMP" DEFAULTVALUE="CURRENT_TIMESTAMP"/>
      </TARGET>

      <!-- Target 4: TGT_MANUAL_REVIEW_LOANS -->
      <TARGET OBJECTID="TGT_0004" NAME="TGT_MANUAL_REVIEW_LOANS" DBTYPE="Snowflake" CONNECTIONNAME="$$TGT_CONNECTION">
        <DATABASEOBJECT>TGT_MANUAL_REVIEW_LOANS</DATABASEOBJECT>
        <TARGETFIELD NAME="APPLICATION_ID" DATATYPE="STRING" NULLABLE="N" PRECISION="50"/>
        <TARGETFIELD NAME="BORROWER_SSN_HASH" DATATYPE="STRING" NULLABLE="N" PRECISION="64"/>
        <TARGETFIELD NAME="LOAN_AMOUNT" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="15" SCALE="2"/>
        <TARGETFIELD NAME="LOAN_PURPOSE" DATATYPE="STRING" NULLABLE="Y" PRECISION="50"/>
        <TARGETFIELD NAME="LOAN_TYPE" DATATYPE="STRING" NULLABLE="N" PRECISION="20"/>
        <TARGETFIELD NAME="INTEREST_RATE" DATATYPE="DECIMAL" NULLABLE="N" PRECISION="5" SCALE="3"/>
        <TARGETFIELD NAME="LOAN_TERM_MONTHS" DATATYPE="INTEGER" NULLABLE="N" PRECISION="5"/>
        <TARGETFIELD NAME="LOAN_OFFICER_ID" DATATYPE="STRING" NULLABLE="Y" PRECISION="20"/>
        <TARGETFIELD NAME="BRANCH_CODE" DATATYPE="STRING" NULLABLE="Y" PRECISION="10"/>
        <TARGETFIELD NAME="PROPERTY_STATE" DATATYPE="STRING" NULLABLE="Y" PRECISION="2"/>
        <TARGETFIELD NAME="BUREAU_SCORE" DATATYPE="INTEGER" NULLABLE="N" PRECISION="4"/>
        <TARGETFIELD NAME="CREDIT_TIER" DATATYPE="STRING" NULLABLE="Y" PRECISION="20"/>
        <TARGETFIELD NAME="DEROGATORY_MARKS" DATATYPE="INTEGER" NULLABLE="Y" PRECISION="5"/>
        <TARGETFIELD NAME="INQUIRIES_6MO" DATATYPE="INTEGER" NULLABLE="Y" PRECISION="5"/>
        <TARGETFIELD NAME="ACTUAL_LTV" DATATYPE="DECIMAL" PRECISION="5" SCALE="2"/>
        <TARGETFIELD NAME="DTI_RATIO" DATATYPE="DECIMAL" PRECISION="5" SCALE="2"/>
        <TARGETFIELD NAME="APPRAISED_VALUE" DATATYPE="DECIMAL" NULLABLE="Y" PRECISION="15" SCALE="2"/>
        <TARGETFIELD NAME="APPLICATION_DATE" DATATYPE="TIMESTAMP" NULLABLE="N" PRECISION="29"/>
        <TARGETFIELD NAME="UNDERWRITING_DATE" DATATYPE="DATE"/>
        <TARGETFIELD NAME="DECISION_REASON" DATATYPE="STRING" PRECISION="500"/>
        <TARGETFIELD NAME="REVIEW_REASON" DATATYPE="STRING" DEFAULTVALUE="'FAIR_CREDIT_TIER'"/>
        <TARGETFIELD NAME="REVIEW_PRIORITY" DATATYPE="STRING" DEFAULTVALUE="'STANDARD'"/>
        <TARGETFIELD NAME="LOAD_DATE" DATATYPE="DATE" DEFAULTVALUE="$$LOAD_DATE"/>
        <TARGETFIELD NAME="ETL_LOAD_TIMESTAMP" DATATYPE="TIMESTAMP" DEFAULTVALUE="CURRENT_TIMESTAMP"/>
      </TARGET>

      <!-- ================================================================
           CONNECTORS - LINK TRANSFORMATIONS AND TARGETS
           ================================================================ -->

      <!-- Connector: TXN_0006 (Expression) to RTR_LOAN_DECISION (Router) -->
      <CONNECTOR SOURCE="TXN_0006" TARGET="TXN_0007" DESCRIPTION="Expression output to Router input"/>

      <!-- Connector: RTR_LOAN_DECISION APPROVED group to TGT_APPROVED_LOANS -->
      <CONNECTOR SOURCE="TXN_0007:APPROVED" TARGET="TGT_0001">
        <SOURCEFIELD NAME="APPLICATION_ID"/>
        <SOURCEFIELD NAME="BORROWER_SSN_HASH"/>
        <SOURCEFIELD NAME="LOAN_AMOUNT"/>
        <SOURCEFIELD NAME="LOAN_PURPOSE"/>
        <SOURCEFIELD NAME="LOAN_TYPE"/>
        <SOURCEFIELD NAME="INTEREST_RATE"/>
        <SOURCEFIELD NAME="LOAN_TERM_MONTHS"/>
        <SOURCEFIELD NAME="BRANCH_CODE"/>
        <SOURCEFIELD NAME="PROPERTY_STATE"/>
        <SOURCEFIELD NAME="BUREAU_SCORE"/>
        <SOURCEFIELD NAME="CREDIT_TIER"/>
        <SOURCEFIELD NAME="ACTUAL_LTV"/>
        <SOURCEFIELD NAME="DTI_RATIO"/>
        <SOURCEFIELD NAME="MONTHLY_PAYMENT"/>
        <SOURCEFIELD NAME="REQUIRES_PMI"/>
        <SOURCEFIELD NAME="APPLICATION_DATE"/>
        <SOURCEFIELD NAME="UNDERWRITING_DATE"/>
        <SOURCEFIELD NAME="DECISION_REASON"/>
        <TARGETFIELD NAME="APPLICATION_ID"/>
        <TARGETFIELD NAME="BORROWER_SSN_HASH"/>
        <TARGETFIELD NAME="LOAN_AMOUNT"/>
        <TARGETFIELD NAME="LOAN_PURPOSE"/>
        <TARGETFIELD NAME="LOAN_TYPE"/>
        <TARGETFIELD NAME="INTEREST_RATE"/>
        <TARGETFIELD NAME="LOAN_TERM_MONTHS"/>
        <TARGETFIELD NAME="BRANCH_CODE"/>
        <TARGETFIELD NAME="PROPERTY_STATE"/>
        <TARGETFIELD NAME="BUREAU_SCORE"/>
        <TARGETFIELD NAME="CREDIT_TIER"/>
        <TARGETFIELD NAME="ACTUAL_LTV"/>
        <TARGETFIELD NAME="DTI_RATIO"/>
        <TARGETFIELD NAME="MONTHLY_PAYMENT"/>
        <TARGETFIELD NAME="REQUIRES_PMI"/>
        <TARGETFIELD NAME="APPLICATION_DATE"/>
        <TARGETFIELD NAME="UNDERWRITING_DATE"/>
        <TARGETFIELD NAME="DECISION_REASON"/>
      </CONNECTOR>

      <!-- Connector: RTR_LOAN_DECISION REFERRED group to TGT_REFERRED_LOANS -->
      <CONNECTOR SOURCE="TXN_0007:REFERRED" TARGET="TGT_0002">
        <SOURCEFIELD NAME="APPLICATION_ID"/>
        <SOURCEFIELD NAME="BORROWER_SSN_HASH"/>
        <SOURCEFIELD NAME="LOAN_AMOUNT"/>
        <SOURCEFIELD NAME="LOAN_PURPOSE"/>
        <SOURCEFIELD NAME="LOAN_TYPE"/>
        <SOURCEFIELD NAME="INTEREST_RATE"/>
        <SOURCEFIELD NAME="LOAN_TERM_MONTHS"/>
        <SOURCEFIELD NAME="LOAN_OFFICER_ID"/>
        <SOURCEFIELD NAME="BRANCH_CODE"/>
        <SOURCEFIELD NAME="PROPERTY_STATE"/>
        <SOURCEFIELD NAME="BUREAU_SCORE"/>
        <SOURCEFIELD NAME="ACTUAL_LTV"/>
        <SOURCEFIELD NAME="DTI_RATIO"/>
        <SOURCEFIELD NAME="APPRAISED_VALUE"/>
        <SOURCEFIELD NAME="MAX_LTV_PCT"/>
        <SOURCEFIELD NAME="MAX_DTI_PCT"/>
        <SOURCEFIELD NAME="APPLICATION_DATE"/>
        <SOURCEFIELD NAME="UNDERWRITING_DATE"/>
        <SOURCEFIELD NAME="DECISION_REASON"/>
        <TARGETFIELD NAME="APPLICATION_ID"/>
        <TARGETFIELD NAME="BORROWER_SSN_HASH"/>
        <TARGETFIELD NAME="LOAN_AMOUNT"/>
        <TARGETFIELD NAME="LOAN_PURPOSE"/>
        <TARGETFIELD NAME="LOAN_TYPE"/>
        <TARGETFIELD NAME="INTEREST_RATE"/>
        <TARGETFIELD NAME="LOAN_TERM_MONTHS"/>
        <TARGETFIELD NAME="LOAN_OFFICER_ID"/>
        <TARGETFIELD NAME="BRANCH_CODE"/>
        <TARGETFIELD NAME="PROPERTY_STATE"/>
        <TARGETFIELD NAME="BUREAU_SCORE"/>
        <TARGETFIELD NAME="ACTUAL_LTV"/>
        <TARGETFIELD NAME="DTI_RATIO"/>
        <TARGETFIELD NAME="APPRAISED_VALUE"/>
        <TARGETFIELD NAME="MAX_LTV_PCT"/>
        <TARGETFIELD NAME="MAX_DTI_PCT"/>
        <TARGETFIELD NAME="APPLICATION_DATE"/>
        <TARGETFIELD NAME="UNDERWRITING_DATE"/>
        <TARGETFIELD NAME="DECISION_REASON"/>
      </CONNECTOR>

      <!-- Connector: RTR_LOAN_DECISION DECLINED group to TGT_DECLINED_LOANS -->
      <CONNECTOR SOURCE="TXN_0007:DECLINED" TARGET="TGT_0003">
        <SOURCEFIELD NAME="APPLICATION_ID"/>
        <SOURCEFIELD NAME="BORROWER_SSN_HASH"/>
        <SOURCEFIELD NAME="LOAN_AMOUNT"/>
        <SOURCEFIELD NAME="LOAN_TYPE"/>
        <SOURCEFIELD NAME="LOAN_PURPOSE"/>
        <SOURCEFIELD NAME="BUREAU_SCORE"/>
        <SOURCEFIELD NAME="BANKRUPTCY_FLAG"/>
        <SOURCEFIELD NAME="FORECLOSURE_FLAG"/>
        <SOURCEFIELD NAME="ACTUAL_LTV"/>
        <SOURCEFIELD NAME="DTI_RATIO"/>
        <SOURCEFIELD NAME="BRANCH_CODE"/>
        <SOURCEFIELD NAME="PROPERTY_STATE"/>
        <SOURCEFIELD NAME="APPLICATION_DATE"/>
        <SOURCEFIELD NAME="UNDERWRITING_DATE"/>
        <SOURCEFIELD NAME="DECISION_REASON"/>
        <TARGETFIELD NAME="APPLICATION_ID"/>
        <TARGETFIELD NAME="BORROWER_SSN_HASH"/>
        <TARGETFIELD NAME="LOAN_AMOUNT"/>
        <TARGETFIELD NAME="LOAN_TYPE"/>
        <TARGETFIELD NAME="LOAN_PURPOSE"/>
        <TARGETFIELD NAME="BUREAU_SCORE"/>
        <TARGETFIELD NAME="BANKRUPTCY_FLAG"/>
        <TARGETFIELD NAME="FORECLOSURE_FLAG"/>
        <TARGETFIELD NAME="ACTUAL_LTV"/>
        <TARGETFIELD NAME="DTI_RATIO"/>
        <TARGETFIELD NAME="BRANCH_CODE"/>
        <TARGETFIELD NAME="PROPERTY_STATE"/>
        <TARGETFIELD NAME="APPLICATION_DATE"/>
        <TARGETFIELD NAME="UNDERWRITING_DATE"/>
        <TARGETFIELD NAME="DECISION_REASON"/>
        <TARGETFIELD NAME="DECLINE_REASON_CODES" VALUE="DECISION_REASON"/>
      </CONNECTOR>

      <!-- Connector: RTR_LOAN_DECISION MANUAL_REVIEW group to TGT_MANUAL_REVIEW_LOANS -->
      <CONNECTOR SOURCE="TXN_0007:MANUAL_REVIEW" TARGET="TGT_0004">
        <SOURCEFIELD NAME="APPLICATION_ID"/>
        <SOURCEFIELD NAME="BORROWER_SSN_HASH"/>
        <SOURCEFIELD NAME="LOAN_AMOUNT"/>
        <SOURCEFIELD NAME="LOAN_PURPOSE"/>
        <SOURCEFIELD NAME="LOAN_TYPE"/>
        <SOURCEFIELD NAME="INTEREST_RATE"/>
        <SOURCEFIELD NAME="LOAN_TERM_MONTHS"/>
        <SOURCEFIELD NAME="LOAN_OFFICER_ID"/>
        <SOURCEFIELD NAME="BRANCH_CODE"/>
        <SOURCEFIELD NAME="PROPERTY_STATE"/>
        <SOURCEFIELD NAME="BUREAU_SCORE"/>
        <SOURCEFIELD NAME="CREDIT_TIER"/>
        <SOURCEFIELD NAME="DEROGATORY_MARKS"/>
        <SOURCEFIELD NAME="INQUIRIES_6MO"/>
        <SOURCEFIELD NAME="ACTUAL_LTV"/>
        <SOURCEFIELD NAME="DTI_RATIO"/>
        <SOURCEFIELD NAME="APPRAISED_VALUE"/>
        <SOURCEFIELD NAME="APPLICATION_DATE"/>
        <SOURCEFIELD NAME="UNDERWRITING_DATE"/>
        <SOURCEFIELD NAME="DECISION_REASON"/>
        <TARGETFIELD NAME="APPLICATION_ID"/>
        <TARGETFIELD NAME="BORROWER_SSN_HASH"/>
        <TARGETFIELD NAME="LOAN_AMOUNT"/>
        <TARGETFIELD NAME="LOAN_PURPOSE"/>
        <TARGETFIELD NAME="LOAN_TYPE"/>
        <TARGETFIELD NAME="INTEREST_RATE"/>
        <TARGETFIELD NAME="LOAN_TERM_MONTHS"/>
        <TARGETFIELD NAME="LOAN_OFFICER_ID"/>
        <TARGETFIELD NAME="BRANCH_CODE"/>
        <TARGETFIELD NAME="PROPERTY_STATE"/>
        <TARGETFIELD NAME="BUREAU_SCORE"/>
        <TARGETFIELD NAME="CREDIT_TIER"/>
        <TARGETFIELD NAME="DEROGATORY_MARKS"/>
        <TARGETFIELD NAME="INQUIRIES_6MO"/>
        <TARGETFIELD NAME="ACTUAL_LTV"/>
        <TARGETFIELD NAME="DTI_RATIO"/>
        <TARGETFIELD NAME="APPRAISED_VALUE"/>
        <TARGETFIELD NAME="APPLICATION_DATE"/>
        <TARGETFIELD NAME="UNDERWRITING_DATE"/>
        <TARGETFIELD NAME="DECISION_REASON"/>
      </CONNECTOR>

    </MAPPING>

    <!-- ================================================================
         MAPPING CONFIGURATION AND SESSION VARIABLES
         ================================================================ -->

    <MAPPINGCONFIG OBJECTID="MAPCONFIG_0001" NAME="m_LOAN_UNDERWRITING_DECISION_CONFIG">
      <DESCRIPTION>Configuration for underwriting decision mapping</DESCRIPTION>
      <VARIABLE NAME="$$LOAD_DATE" DATATYPE="STRING" COMMENT="Current processing date in YYYY-MM-DD format"/>
      <VARIABLE NAME="$$SRC_CONNECTION" DATATYPE="STRING" COMMENT="Snowflake connection for source loan applications"/>
      <VARIABLE NAME="$$APPRAISAL_CONN" DATATYPE="STRING" COMMENT="Oracle connection for property valuations"/>
      <VARIABLE NAME="$$GUIDELINES_CONN" DATATYPE="STRING" COMMENT="Oracle connection for underwriting guidelines"/>
      <VARIABLE NAME="$$TGT_CONNECTION" DATATYPE="STRING" COMMENT="Snowflake connection for target tables"/>
      <VARIABLE NAME="$$MAX_DTI_OVERRIDE" DATATYPE="STRING" COMMENT="Optional DTI threshold override for special programs"/>
      <VARIABLE NAME="$$ENV" DATATYPE="STRING" COMMENT="Environment indicator: DEV, QA, PROD"/>
    </MAPPINGCONFIG>

  </COLLECTION>

</REPOSITORY>
